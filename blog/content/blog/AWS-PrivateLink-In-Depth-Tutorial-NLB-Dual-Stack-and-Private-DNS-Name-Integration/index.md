---
title: 'AWS PrivateLink in Depth Tutorial NLB Dual Stack and Private DNS Name Integration'
date: 2025-01-12T23:41:42+08:00
draft: true
description: ""
tags: ["", ""]
categories: [""]
keywords:
- 
---
# å¦‚ä½•é€é PrivateLink å­˜å– NLB æœå‹™ï¼Œä¸¦åŒæ™‚æ”¯æ´ Dual-stack èˆ‡ Private DNS åç¨±

Tags: AWS ELB, AWS PrivateLink, Dual-stack
Category: AWS, DNS, Networking
Created time: January 8, 2025 9:52 AM
Last edited time: January 12, 2025 11:30 PM

- [x]  Deep dive into PrivateLink â€” [å¦‚ä½•é€é PrivateLink å­˜å– NLB æœå‹™ï¼Œä¸¦åŒæ™‚æ”¯æ´ Dual-stack èˆ‡ Private DNS åç¨±](https://www.notion.so/PrivateLink-NLB-Dual-stack-Private-DNS-175ea7e0d9d080dd8724ea3d8071af9c?pvs=21)

## Q&A

- æ˜¯çš„ï¼Œä½†æˆ‘æƒ³çŸ¥é“ï¼ŒVPC Interface Endpoint æ˜¯å»å•å“ªå° DNS æœå‹™ï¼Ÿç‚ºä»€éº¼æœƒæ˜¯æˆ‘è‡ªå·±è¦è¨­å®š DNS?
    
    é€™æ˜¯ä¸€å€‹éå¸¸å¥½çš„å•é¡Œï¼è®“æˆ‘å€‘ä¸€æ­¥ä¸€æ­¥ä¾†è§£æ **VPC Interface Endpoint** å¦‚ä½•ä½¿ç”¨ **DNS**ï¼Œä»¥åŠç‚ºä»€éº¼éœ€è¦ä½ ä¾†é…ç½®ç›¸é—œçš„ DNS é¸é …ã€‚
    
    ---
    
    ### **VPC Interface Endpoint èˆ‡ DNS çš„é—œä¿‚**
    
    1. **VPC Interface Endpoint çš„ä½œç”¨**ï¼š
        - å®ƒæ˜¯ AWS PrivateLink çš„ä¸€éƒ¨åˆ†ï¼Œå…è¨±ä½ çš„ VPC å…§éƒ¨è³‡æºï¼ˆä¾‹å¦‚ EC2ã€Lambdaï¼‰é€éç§æœ‰ç¶²è·¯ç›´æ¥è¨ªå• AWS æœå‹™ï¼ˆå¦‚ S3ã€DynamoDBï¼‰ï¼Œè€Œä¸éœ€è¦é€šéå…¬é–‹çš„ Internetã€‚
    2. **DNS çš„è§’è‰²**ï¼š
        - ç•¶ä½ åœ¨ VPC ä¸­è¨ªå• AWS æœå‹™æ™‚ï¼ˆä¾‹å¦‚ `s3.amazonaws.com`ï¼‰ï¼Œè©²åŸŸåéœ€è¦è¢«è§£æç‚º **VPC Interface Endpoint çš„ç§æœ‰ IP**ã€‚
        - AWS æä¾›äº†ä¸€å€‹æ©Ÿåˆ¶ï¼Œè®“ä½ å¯ä»¥é€é DNS å°‡é€™äº›åŸŸåè§£æåˆ° VPC å…§éƒ¨çš„ Endpoint IPï¼Œè€Œä¸æ˜¯å…¬é–‹çš„ AWS å…¬ç¶² IPã€‚
    
    ---
    
    ### **é‚£éº¼ï¼ŒVPC Interface Endpoint å•å“ªå° DNS æœå‹™ï¼Ÿ**
    
    1. **Amazon æä¾›çš„å…§å»º DNS æœå‹™**ï¼š
        - ç•¶ä½ åœ¨ AWS VPC ä¸­å‰µå»ºè³‡æºæ™‚ï¼ŒVPC è‡ªå‹•é™„å¸¶äº†ä¸€å€‹å…§å»ºçš„ DNS Resolverï¼ˆé€šå¸¸åœ¨ `x.x.x.2`ï¼ŒVPC çš„ç¬¬ä¸€å€‹å¯ç”¨ IPï¼‰ã€‚
        - **é€™å°å…§å»ºçš„ DNS Server** è² è²¬å°‡ AWS ç‰¹å®šçš„æœå‹™åç¨±è§£æç‚ºç›¸æ‡‰çš„ç§æœ‰ IP åœ°å€ã€‚
    2. **DNS çš„è§£ææµç¨‹**ï¼š
        - ç•¶ä½ çš„æ‡‰ç”¨ç¨‹åºåœ¨ VPC ä¸­ç™¼å‡º DNS æŸ¥è©¢ï¼ˆä¾‹å¦‚æŸ¥è©¢ `s3.amazonaws.com`ï¼‰ï¼ŒVPC çš„å…§å»º DNS Server æœƒï¼š
            1. æª¢æŸ¥ä½ æ˜¯å¦å·²ç¶“é…ç½®äº† Interface Endpointã€‚
            2. å¦‚æœæœ‰ï¼Œå‰‡å°‡åŸŸåè§£æç‚ºè©² Endpoint çš„ç§æœ‰ IP åœ°å€ã€‚
            3. å¦‚æœæ²’æœ‰ï¼Œå‰‡æœƒè§£æç‚ºè©² AWS æœå‹™çš„å…¬é–‹ IP åœ°å€ã€‚
    3. **ç‚ºä»€éº¼ä½ éœ€è¦è¨­å®š DNS**ï¼š
        - AWS æä¾›äº† **é¸é …**ï¼Œè®“ä½ æ§åˆ¶å…§å»º DNS æ˜¯å¦è§£æç‚ºç§æœ‰ IP åœ°å€ã€‚ä¾‹å¦‚ï¼š
            - ä½ å¯ä»¥è®“ DNS å§‹çµ‚è§£æå…¬é–‹åœ°å€ï¼ˆå¦‚æœä½ æƒ³å¼·åˆ¶æµé‡èµ°äº’è¯ç¶²ï¼‰ã€‚
            - æˆ–è€…ï¼Œç¢ºä¿æ‰€æœ‰æŸ¥è©¢çš„åŸŸåéƒ½è§£æåˆ°ç§æœ‰ Endpointï¼ˆä¿è­‰æµé‡ä¿æŒåœ¨ VPC ä¸­ï¼‰ã€‚
    
    ---
    
    ### **ç‚ºä»€éº¼éœ€è¦æ‰‹å‹•è¨­å®š DNS Optionsï¼Ÿ**
    
    1. **è‡ªå®šç¾©ç¶²è·¯éœ€æ±‚**ï¼š
        - ä¸åŒçš„ç¶²è·¯ç’°å¢ƒå¯èƒ½æœ‰ä¸åŒçš„éœ€æ±‚ï¼Œæ¯”å¦‚æ˜¯å¦æ”¯æŒ IPv6ï¼Œæˆ–æ˜¯å¦éœ€è¦åŒæ™‚æ”¯æŒ IPv4 å’Œ IPv6ã€‚
    2. **é«˜å¯ç”¨æ€§èˆ‡å”è­°æ”¯æŒ**ï¼š
        - å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ Dualstackï¼Œä½ éœ€è¦ç¢ºä¿ DNS Options èƒ½è§£æå‡ºæ”¯æŒ IPv4 å’Œ IPv6 çš„åœ°å€ã€‚
    3. **AWS æä¾›éˆæ´»æ€§**ï¼š
        - AWS ç„¡æ³•é æ¸¬ä½ çš„æ¯å€‹ä½¿ç”¨å ´æ™¯ï¼Œå› æ­¤å®ƒå…è¨±ä½ æ‰‹å‹•è¨­å®šé€™äº›é¸é …ï¼Œä¾†æ»¿è¶³ä½ æ‡‰ç”¨ç¨‹åºçš„å…·é«”éœ€æ±‚ã€‚
    
    ---
    
    ### **é‚£ç‚ºä»€éº¼ä¸æ˜¯ç›´æ¥ç”¨ AWS å¹«ä½ è™•ç†æ‰€æœ‰ DNS è¨­å®šï¼Ÿ**
    
    1. **æˆæœ¬èˆ‡æ•ˆç‡è€ƒé‡**ï¼š
        - ä½¿ç”¨ VPC Interface Endpoint æ„å‘³è‘—ä½ æµé‡å®Œå…¨èµ°å…§éƒ¨ç¶²è·¯ï¼Œå¯èƒ½æœ‰ **å¸¶å¯¬æˆæœ¬å„ªåŒ–** çš„éœ€æ±‚ï¼ˆç›¸æ¯”èµ°å…¬ç¶²ï¼‰ã€‚
        - ä½†æœ‰äº›ç”¨æˆ¶å¯èƒ½ä¸éœ€è¦é€™éº¼å¤šç§æœ‰åŒ–çš„åŠŸèƒ½ï¼Œä»–å€‘å¸Œæœ›æµé‡ç›´æ¥èµ°å…¬ç¶²ï¼Œé€™æ¨£å°±éœ€è¦éˆæ´»çš„é…ç½®ã€‚
    2. **æ”¯æŒå¤šå”è­°çš„éœ€æ±‚**ï¼š
        - IPv4 å’Œ IPv6 çš„æ··åˆä½¿ç”¨è¶Šä¾†è¶Šæ™®éï¼Œé€™ç¨®ç’°å¢ƒä¸‹ DNS è¨­å®šéœ€è¦æ ¹æ“šä½ çš„å¯¦éš›ç¶²è·¯æ‹“æ’²éˆæ´»è™•ç†ã€‚
    
    ---
    
    ### **ç¸½çµ**
    
    - **VPC Interface Endpoint å•çš„æ˜¯ AWS å…§å»ºçš„ VPC DNS Resolver**ï¼ˆ`x.x.x.2`ï¼‰ã€‚
    - **ä½ ç‚ºä»€éº¼è¦è¨­å®š DNS Optionsï¼Ÿ**
        - å› ç‚º AWS çµ¦äº†ä½ éˆæ´»é¸æ“‡çš„æ¬Šé™ï¼Œä½ å¯ä»¥æ±ºå®šï¼š
            1. æ˜¯ä½¿ç”¨ IPv4ã€IPv6 é‚„æ˜¯ Dualstackã€‚
            2. æ˜¯å¦å…è¨± AWS è‡ªå‹•å¹«ä½ è™•ç†ï¼ˆé¸æ“‡ Service definedï¼‰ã€‚
        - é€™æ¨£åšæ˜¯ç‚ºäº†æ»¿è¶³ä¸åŒçš„ç¶²è·¯éœ€æ±‚ï¼Œä¸¦å„ªåŒ–ä½ çš„ç§æœ‰ç¶²è·¯æµé‡ã€‚
    
    å¸Œæœ›é€™æ¨£è§£é‡‹å¯ä»¥å¹«åŠ©ä½ æ›´æ¸…æ¥šæ•´å€‹é‚è¼¯ï¼ ğŸ‰
    
- å¦‚æœæˆ‘æ˜¯ Service Providerï¼Œæˆ‘æœ‰ NLBï¼Œæˆ‘å¯ä»¥è‡ªè¡Œé…ç½®æˆ‘å–œæ­¡çš„ Private DNS name å—ï¼Ÿéœ€è¦è³¼è²·åŸŸåå—
    
    æ˜¯çš„ï¼Œèº«ç‚º **Service Provider**ï¼Œå¦‚æœä½ æƒ³è¦ç‚º **VPC Endpoint Service** é…ç½® **Private DNS name**ï¼Œä½ éœ€è¦æ“æœ‰ä¸€å€‹å…¬å…±åŸŸåã€‚ä»¥ä¸‹æ˜¯åŸå› èˆ‡è©³ç´°èªªæ˜ï¼š
    
    ---
    
    ### **ç‚ºä»€éº¼éœ€è¦å…¬å…±åŸŸåï¼Ÿ**
    
    1. **AWS çš„é©—è­‰è¦æ±‚**ï¼š
        - AWS è¦æ±‚ä½ è­‰æ˜ä½ æ“æœ‰è©²åŸŸåçš„æ§åˆ¶æ¬Šï¼Œé€™æ˜¯ç‚ºäº†ç¢ºä¿å®‰å…¨æ€§ä¸¦é¿å…å…¶ä»–äººæ¿«ç”¨æœªæˆæ¬Šçš„åŸŸåã€‚
        - é©—è­‰çš„æ–¹å¼æ˜¯é€éåœ¨è©²åŸŸåçš„ DNS è¨­ç½®ä¸­æ·»åŠ ç‰¹å®šçš„ **TXT è¨˜éŒ„**ã€‚
    2. **Private DNS name çš„é‹ä½œæ–¹å¼**ï¼š
        - Private DNS name æ˜¯ç”± AWS è‡ªå‹•å‰µå»ºçš„ **Private Hosted Zone** æä¾›è§£æï¼Œä½†å®ƒéœ€è¦å°‡ä½ çš„è‡ªå®šç¾©åŸŸåï¼ˆå¦‚ `api.mycompany.com`ï¼‰æ˜ å°„åˆ° VPC Endpoint çš„å€åŸŸæ€§ DNS åç¨±ã€‚
        - æ­¤åŸŸåçš„åŸºç¤å¿…é ˆæ˜¯å…¬å…±åŸŸåï¼Œå³å¯ä»¥åœ¨äº’è¯ç¶²ä¸Šè§£æçš„åŸŸåï¼Œä¾‹å¦‚ `mycompany.com`ã€‚
    
    ---
    
    ### **å…·é«”éœ€æ±‚èˆ‡æ¢ä»¶**
    
    - **éœ€è¦çš„å…¬å…±åŸŸå**ï¼š
        - ä½ å¯ä»¥ä½¿ç”¨ä»»ä½•ä½ æ“æœ‰çš„å…¬å…±åŸŸåï¼ˆä¾‹å¦‚ï¼Œä½ å·²åœ¨ Route 53ã€GoDaddy ç­‰è¨»å†Šçš„åŸŸåï¼‰ã€‚
        - ä¾‹å¦‚ï¼Œå¦‚æœä½ çš„åŸŸåæ˜¯ `example.com`ï¼Œä½ å¯ä»¥å°‡ Private DNS name è¨­å®šç‚º `api.example.com` æˆ–ä»»ä½•å­åŸŸåï¼ˆå¦‚ `service.example.com`ï¼‰ã€‚
    - **é©—è­‰æ–¹å¼**ï¼š
        - AWS æä¾›ä¸€çµ„é©—è­‰å€¼ï¼ˆ`Name` å’Œ `Value`ï¼‰ï¼Œä¾‹å¦‚ï¼š
            
            ```
            Name: _6e86v84tqgqubxbwii1m.example.com
            Value: vpce:l6p0ERxlTt45jevFwOCp
            
            ```
            
        - ä½ éœ€è¦åœ¨åŸŸåçš„ DNS è¨­ç½®ä¸­æ–°å¢é€™äº›å€¼ä½œç‚º **TXT è¨˜éŒ„**ï¼Œå®ŒæˆåŸŸåæ“æœ‰æ¬Šé©—è­‰ã€‚
    
    ---
    
    ### **æ˜¯å¦å¯ä»¥ä¸ä½¿ç”¨å…¬å…±åŸŸåï¼Ÿ**
    
    - **ä¸å¯ä»¥**ï¼š
        - AWS è¦æ±‚ Private DNS name çš„é©—è­‰å¿…é ˆåŸºæ–¼å…¬å…±åŸŸåï¼Œå³ä½¿é€™å€‹åŸŸåå¯¦éš›ä¸Šåƒ…ç”¨æ–¼å…§éƒ¨è§£æã€‚
        - å¦‚æœä½ æ²’æœ‰å…¬å…±åŸŸåï¼Œå‰‡ç„¡æ³•é…ç½® Private DNS nameã€‚
    
    ---
    
    ### **è§£æ±ºæ–¹æ³•**
    
    1. **å¦‚æœä½ å·²æœ‰å…¬å…±åŸŸå**ï¼š
        - ä½¿ç”¨ç¾æœ‰çš„åŸŸåï¼Œæ·»åŠ æ‰€éœ€çš„ **TXT è¨˜éŒ„**ï¼Œå®Œæˆé©—è­‰å³å¯ã€‚
    2. **å¦‚æœä½ æ²’æœ‰å…¬å…±åŸŸå**ï¼š
        - éœ€è¦è³¼è²·ä¸€å€‹å…¬å…±åŸŸåï¼ˆä¾‹å¦‚é€é Route 53ã€GoDaddyã€Namecheap ç­‰ï¼‰ã€‚
        - è¨»å†Šå¾Œï¼Œå°‡è©²åŸŸåæŒ‡å‘ AWS æä¾›çš„ DNS ä¼ºæœå™¨ï¼Œç„¶å¾Œæ–°å¢ AWS è¦æ±‚çš„ TXT è¨˜éŒ„ã€‚
    
    ---
    
    ### **å…¶ä»–æ³¨æ„äº‹é …**
    
    1. **å­åŸŸåæ”¯æŒ**ï¼š
        - å¦‚æœä½ å·²é©—è­‰äº†ä¸»åŸŸåï¼ˆä¾‹å¦‚ `example.com`ï¼‰ï¼Œå‰‡å¯ä»¥ç›´æ¥ä½¿ç”¨ä»»æ„å­åŸŸåï¼ˆå¦‚ `api.example.com` æˆ– `service.api.example.com`ï¼‰ï¼Œè€Œç„¡éœ€å†æ¬¡é©—è­‰å­åŸŸåã€‚
    2. **Domain Ownership Verification çš„å¿…è¦æ€§**ï¼š
        - ç„¡è«–åŸŸåæ˜¯å¦å…¬é–‹ä½¿ç”¨ï¼ŒAWS éƒ½éœ€è¦é©—è­‰åŸŸåæ“æœ‰æ¬Šï¼Œé€™æ˜¯ AWS çš„å®‰å…¨æ©Ÿåˆ¶ã€‚
    3. **èˆ‡ Gateway Load Balancer çš„é™åˆ¶**ï¼š
        - å¦‚æœä½ çš„æœå‹™èƒŒå¾Œæ˜¯ **Gateway Load Balancer**ï¼Œå‰‡ç„¡æ³•ä½¿ç”¨ Private DNS nameã€‚
    
    ---
    
    ### **ç¸½çµ**
    
    - **æ˜¯çš„ï¼Œé…ç½® Private DNS name å¿…é ˆè¦æœ‰ä¸€å€‹å…¬å…±åŸŸåã€‚**
    - é€™æ˜¯å› ç‚º AWS è¦æ±‚é©—è­‰åŸŸåçš„æ“æœ‰æ¬Šï¼Œç¢ºä¿ Private DNS name çš„å®‰å…¨æ€§èˆ‡å”¯ä¸€æ€§ã€‚
    - å¦‚æœä½ é‚„æ²’æœ‰å…¬å…±åŸŸåï¼Œå»ºè­°è³¼è²·ä¸€å€‹ï¼ˆä¾‹å¦‚é€é AWS Route 53ï¼‰ï¼Œç„¶å¾ŒæŒ‰ç…§ AWS çš„æ­¥é©Ÿå®Œæˆé©—è­‰ä¸¦é…ç½® Private DNS nameã€‚
    
    å¦‚æœä½ éœ€è¦æ›´å¤šå¹«åŠ©ï¼Œéš¨æ™‚æå‡ºï¼ ğŸ˜Š
    
- grep -v æ˜¯ä»€éº¼
    
    `grep -v` æ˜¯ Linux ä¸­ **grep å‘½ä»¤**çš„ä¸€å€‹é¸é …ï¼Œç”¨ä¾†**åå‘éæ¿¾**è¡Œã€‚ä¹Ÿå°±æ˜¯èªªï¼Œå®ƒæœƒé¡¯ç¤ºä¸ç¬¦åˆçµ¦å®šæ¨¡å¼ï¼ˆPatternï¼‰çš„è¡Œã€‚
    
    ---
    
    ### **èªæ³•**
    
    ```bash
    grep -v "PATTERN" FILENAME
    
    ```
    
    - `v`ï¼šåå‘éæ¿¾ï¼Œé¡¯ç¤ºä¸åŒ¹é… PATTERN çš„è¡Œã€‚
    - `"PATTERN"`ï¼šä½ è¦éæ¿¾çš„é—œéµå­—æˆ–æ­£å‰‡è¡¨é”å¼ã€‚
    - `FILENAME`ï¼šè¦æœç´¢çš„æª”æ¡ˆåã€‚
    
    ---
    
    ### **ç”¨æ³•ç¤ºä¾‹**
    
    ### **1. åŸºæœ¬ç”¨æ³•**
    
    å‡è¨­æœ‰ä¸€å€‹æª”æ¡ˆ `example.txt`ï¼Œå…§å®¹å¦‚ä¸‹ï¼š
    
    ```
    apple
    banana
    cherry
    apple pie
    grape
    
    ```
    
    å¦‚æœä½ åŸ·è¡Œä»¥ä¸‹å‘½ä»¤ï¼š
    
    ```bash
    grep -v "apple" example.txt
    
    ```
    
    è¼¸å‡ºçµæœï¼š
    
    ```
    banana
    cherry
    grape
    
    ```
    
    - åªæœƒé¡¯ç¤ºä¸åŒ…å« `apple` çš„è¡Œï¼ˆéæ¿¾æ‰å«æœ‰ `apple` çš„è¡Œï¼‰ã€‚
    
    ---
    
    ### **2. èˆ‡ç®¡é“çµåˆ**
    
    å¦‚æœä½ æƒ³éæ¿¾æŸäº›å‘½ä»¤çš„è¼¸å‡ºï¼Œå¯ä»¥å°‡å…¶èˆ‡ç®¡é“ (`|`) çµåˆä½¿ç”¨ã€‚
    
    ä¾‹å¦‚ï¼Œéæ¿¾æ‰ Apache æ—¥èªŒä¸­çš„ `ELB-HealthChecker/2.0`ï¼š
    
    ```bash
    sudo tail -f /var/log/httpd/access_log | grep -v "ELB-HealthChecker/2.0"
    
    ```
    
    - é€™æœƒå¯¦æ™‚é¡¯ç¤ºè¨ªå•æ—¥èªŒï¼Œä½†æœƒéæ¿¾æ‰åŒ…å« `ELB-HealthChecker/2.0` çš„è¡Œã€‚
    
    ---
    
    ### **3. èˆ‡æ­£å‰‡è¡¨é”å¼çµåˆ**
    
    `grep` æ”¯æ´æ­£å‰‡è¡¨é”å¼ï¼Œä½ å¯ä»¥ç”¨æ›´è¤‡é›œçš„æ¨¡å¼ä¾†éæ¿¾ã€‚
    
    ä¾‹å¦‚ï¼Œéæ¿¾æ‰ä»¥æ•¸å­—é–‹é ­çš„è¡Œï¼š
    
    ```bash
    grep -v "^[0-9]" example.txt
    
    ```
    
    ---
    
    ### **å¸¸ç”¨é¸é …**
    
    `grep` æœ‰è¨±å¤šæœ‰ç”¨çš„é¸é …ï¼Œä»¥ä¸‹æ˜¯å¹¾å€‹å¸¸è¦‹çš„ï¼š
    
    - `i`ï¼šå¿½ç•¥å¤§å°å¯«ã€‚
    - `E`ï¼šä½¿ç”¨æ“´å±•æ­£å‰‡è¡¨é”å¼ã€‚
    - `c`ï¼šåªé¡¯ç¤ºåŒ¹é…è¡Œçš„æ•¸é‡ã€‚
    - `n`ï¼šé¡¯ç¤ºåŒ¹é…è¡Œçš„è¡Œè™Ÿã€‚
    
    ---
    
    ### **ç¸½çµ**
    
    - `grep -v` æ˜¯ç”¨ä¾†åå‘éæ¿¾è¡Œçš„å·¥å…·ï¼Œéå¸¸é©åˆç”¨æ–¼æ’é™¤ä¸æƒ³è¦çš„æ•¸æ“šã€‚
    - ä½ å¯ä»¥å°‡å®ƒèˆ‡å…¶ä»–å‘½ä»¤çµ„åˆï¼Œå¯¦ç¾å‹•æ…‹éæ¿¾è¼¸å‡ºã€‚
    
    å¦‚æœä½ æœ‰æ›´å¤šç›¸é—œå•é¡Œï¼Œéš¨æ™‚å•æˆ‘ï¼ ğŸ˜Š
    
- çµ‚æ–¼é©—è­‰æˆåŠŸäº†ï¼Œé‚£æˆ‘å¥½å¥‡ç•¶æˆ‘è¼¸å…¥ä»¥ä¸‹æŒ‡ä»¤ï¼Œæ˜¯èª°å»è§£æ DNS? æ˜¯æœƒå›åˆ°æˆ‘è‡ªå·±çš„ DNS æœå‹™è§£æå—ï¼Ÿcurl -4 [demoprivatelink.shiun.me](http://demoprivatelink.shiun.me/)
    
    ç•¶ä½ åŸ·è¡ŒæŒ‡ä»¤ `curl -4 demoprivatelink.shiun.me` æ™‚ï¼Œ**DNS è§£æçš„å…·é«”éç¨‹**å¦‚ä¸‹ï¼š
    
    ---
    
    ### **èª°è§£æ DNSï¼Ÿ**
    
    1. **ä½ çš„æœ¬åœ°ç³»çµ±ï¼ˆæˆ–æ‡‰ç”¨ç¨‹å¼ï¼‰æœƒå•Ÿå‹• DNS æŸ¥è©¢**
        - `curl` æœƒé€šéç³»çµ±çš„ DNS Resolver å•é¡Œä¾†è§£æåŸŸåï¼ˆå³ `demoprivatelink.shiun.me`ï¼‰ã€‚
        - ç³»çµ±æœƒæ ¹æ“š `/etc/resolv.conf` æˆ–ç¶²è·¯è¨­ç½®ä¸­çš„ **DNS Server é…ç½®**ï¼Œå‘æŒ‡å®šçš„ DNS Server ç™¼é€æŸ¥è©¢è«‹æ±‚ã€‚
    2. **DNS æŸ¥è©¢çš„è·¯å¾‘**
        - **å¦‚æœä½ çš„æ©Ÿå™¨ä½¿ç”¨çš„æ˜¯å…¬å…± DNS ä¼ºæœå™¨ï¼ˆä¾‹å¦‚ Google DNS 8.8.8.8ï¼‰**ï¼š
            - DNS æŸ¥è©¢æœƒè¢«ç™¼é€åˆ°å…¬å…± DNS ä¼ºæœå™¨é€²è¡Œè§£æã€‚
        - **å¦‚æœä½ çš„æ©Ÿå™¨æ˜¯ä½æ–¼ AWS VPC å…§éƒ¨**ï¼š
            - æŸ¥è©¢æœƒè¢«ç™¼é€åˆ° **AWS VPC çš„å…§å»º DNS Resolver**ï¼ˆä½æ–¼ VPC çš„ `.2` åœ°å€ï¼Œä¾‹å¦‚ `x.x.x.2`ï¼‰ã€‚
    3. **AWS çš„è¡Œç‚ºï¼ˆé‡å¯« DNS åç¨±ï¼‰**
        - å¦‚æœä½ çš„ **VPC Endpoint** ä¸­å•Ÿç”¨äº† **Private DNS**ï¼š
            - ç•¶ DNS Resolver å•åˆ° AWS VPC çš„å…§å»º DNS Resolver æ™‚ï¼ŒAWS æœƒå°‡ `demoprivatelink.shiun.me` è§£æç‚º **VPC Endpoint çš„ç§æœ‰ IP**ã€‚
        - å¦‚æœè«‹æ±‚ä¾†è‡ª **VPC å¤–éƒ¨**ï¼ŒDNS Resolver å‰‡æœƒæŸ¥è©¢åˆ°åŸŸåçš„å…¬é–‹ IPï¼ˆä¾‹å¦‚ï¼Œä½ åŸä¾†çš„å…¬é–‹ DNS è¨­å®šï¼‰ã€‚
    
    ---
    
    ### **çµè«–ï¼šæ˜¯å¦æœƒå›åˆ°ä½ è‡ªå·±çš„ DNSï¼Ÿ**
    
    ### **1. ä½ çš„ç’°å¢ƒæ±ºå®š DNS è§£æçš„è¡Œç‚º**
    
    - **åœ¨ AWS VPC å…§éƒ¨**ï¼š
        - å¦‚æœä½ å•Ÿç”¨äº† **Private DNS**ï¼Œé‚£éº¼è«‹æ±‚æœƒè¢« **AWS çš„å…§å»º DNS Resolver** æ””æˆªä¸¦è§£æç‚º VPC Endpoint çš„ç§æœ‰ IPã€‚
    - **åœ¨ VPC å¤–éƒ¨**ï¼š
        - è«‹æ±‚æœƒæ ¹æ“šä½ çš„å…¬å…± DNS æä¾›å•†ï¼ˆä¾‹å¦‚ Cloudflareã€GoDaddyï¼‰è§£æï¼Œè¿”å›å…¬é–‹çš„ IPã€‚
    
    ### **2. DNS é‡å¯«çš„é‚è¼¯**
    
    - **AWS çš„ç§æœ‰ DNS Hosted Zone**ï¼šç•¶ VPC å…§éƒ¨çš„æœå‹™æ¶ˆè²»è€…è«‹æ±‚ `demoprivatelink.shiun.me` æ™‚ï¼ŒAWS çš„å…§å»º DNS Resolver æœƒå„ªå…ˆè§£æç‚º VPC Endpoint çš„ç§æœ‰ IPã€‚
    - **ä½ çš„å…¬å…± DNS è¨­ç½®**ï¼šå¦‚æœæŸ¥è©¢ä¾†è‡ª VPC å¤–éƒ¨ï¼Œå‰‡æœƒæ ¹æ“šä½ åœ¨ DNS æä¾›å•†ä¸­è¨­ç½®çš„è¨˜éŒ„è§£æåŸŸåã€‚
    
    ---
    
    ### **å¦‚ä½•æª¢æŸ¥èª°è§£æäº† DNSï¼Ÿ**
    
    1. **æª¢æŸ¥å¯¦éš› IP**
        - åœ¨åŸ·è¡Œ `curl` å‰ï¼Œå¯ä»¥ç”¨ `dig` æˆ– `nslookup` ç¢ºèªè§£æçš„çµæœï¼š
            
            ```bash
            dig demoprivatelink.shiun.me
            
            ```
            
            - å¦‚æœè¿”å›çš„æ˜¯ VPC Endpoint çš„ç§æœ‰ IPï¼Œå‰‡è§£æç”± AWS VPC çš„ DNS Resolver è™•ç†ã€‚
            - å¦‚æœè¿”å›çš„æ˜¯ä½ çš„å…¬é–‹ IPï¼Œå‰‡è§£æä¾†è‡ªä½ çš„å…¬å…± DNS æä¾›å•†ã€‚
    2. **ä½¿ç”¨ `curl` çš„ `-trace` åƒæ•¸æª¢æŸ¥å¯¦éš› IP**
        
        ```bash
        curl --trace - demoprivatelink.shiun.me
        
        ```
        
        - å¯ä»¥è¿½è¸ªè«‹æ±‚çš„å®Œæ•´è·¯å¾‘ï¼Œç¢ºèªè§£æåˆ°çš„ IP æ˜¯å“ªå€‹ã€‚
    
    ---
    
    ### **æ¨¡æ“¬ä¸åŒå ´æ™¯çš„è§£æè¡Œç‚º**
    
    ### **åœ¨ AWS VPC å…§éƒ¨**
    
    - è§£æåŸŸåæ™‚ï¼ŒAWS çš„å…§å»º DNS Resolver æœƒå°‡å…¶è§£æç‚º VPC Endpoint çš„ç§æœ‰ IPã€‚
    - **è¡Œç‚º**ï¼šè§£ææœƒé‡å¯«åˆ°ä½ çš„ **Interface Endpoint çš„ç§æœ‰ IP åœ°å€**ã€‚
    
    ### **åœ¨ AWS VPC å¤–éƒ¨**
    
    - å¦‚æœæŸ¥è©¢åŸŸåçš„æ©Ÿå™¨ä¸åœ¨ VPC å…§ï¼Œå‰‡æŸ¥è©¢æœƒç™¼é€åˆ°ä½ çš„å…¬å…± DNS æä¾›å•†ï¼ˆå¦‚ Route 53ï¼‰ã€‚
    - **è¡Œç‚º**ï¼šè§£æçµæœæœƒæ˜¯ä½ åœ¨å…¬å…± DNS ä¸­è¨­ç½®çš„å…¬é–‹ IPã€‚
    
    ---
    
    ### **ç¸½çµ**
    
    - ç•¶ä½ åŸ·è¡Œ `curl -4 demoprivatelink.shiun.me` æ™‚ï¼ŒDNS è§£ææ˜¯åŸºæ–¼ä½ çš„ **æœ¬åœ° DNS é…ç½®**ï¼Œè€Œå¯¦éš›çš„è§£æé‚è¼¯æœƒæ ¹æ“šä»¥ä¸‹æƒ…å¢ƒè®ŠåŒ–ï¼š
        1. **VPC å…§éƒ¨**ï¼šç”± AWS VPC çš„å…§å»º DNS Resolver é‡å¯«ç‚ºç§æœ‰ IPã€‚
        2. **VPC å¤–éƒ¨**ï¼šç”±ä½ çš„å…¬å…± DNS æä¾›å•†è§£æç‚ºå…¬é–‹ IPã€‚
    
    å¦‚æœéœ€è¦ç¢ºèª DNS æŸ¥è©¢çš„ä¾†æºå’Œè§£æéç¨‹ï¼Œå¯ä»¥é€šé `dig` æˆ– `nslookup` é€²ä¸€æ­¥åˆ†æã€‚ ğŸ˜Š
    
- æ—¢ç„¶æ˜¯åœ¨å…§éƒ¨ DNS è§£æï¼Œä¸æ˜¯å…¬å…±çš„ï¼Œé‚£ç‚ºä»€éº¼ç•¶åˆé‚„è¦é©—è­‰åŸŸåæ‰€æœ‰æ¬Šï¼Ÿåˆä¸æœƒå½±éŸ¿åˆ°ä»–äºº
    
    é€™æ˜¯ä¸€å€‹éå¸¸å¥½çš„å•é¡Œï¼é›–ç„¶ **Private DNS name** çš„è§£æä¸»è¦ç™¼ç”Ÿåœ¨ **AWS VPC çš„å…§éƒ¨ DNS** ä¸­ï¼Œä½† AWS è¦æ±‚é©—è­‰åŸŸåæ‰€æœ‰æ¬Šï¼ŒèƒŒå¾Œçš„åŸå› ä¸»è¦èˆ‡å®‰å…¨æ€§å’Œé˜²æ­¢èª¤ç”¨æœ‰é—œã€‚ä»¥ä¸‹æ˜¯å…·é«”çš„åŸå› å’ŒèƒŒæ™¯è§£é‡‹ï¼š
    
    ---
    
    ### **1. é˜²æ­¢åŸŸååç¨±è¡çªèˆ‡æ¿«ç”¨**
    
    å¦‚æœ AWS ä¸è¦æ±‚é©—è­‰åŸŸåæ‰€æœ‰æ¬Šï¼Œä»¥ä¸‹é¢¨éšªå¯èƒ½å‡ºç¾ï¼š
    
    1. **åŸŸååç¨±è¡çª**ï¼š
        - å‡è¨­å¦ä¸€å€‹æœå‹™æä¾›è€…ä¹Ÿå¸Œæœ›ä½¿ç”¨ `demoprivatelink.shiun.me` ä½œç‚º Private DNS nameï¼Œè€Œé€™å€‹åŸŸåä¸¦ä¸å±¬æ–¼ä»–å€‘ã€‚
        - å¦‚æœæ²’æœ‰é©—è­‰ï¼ŒAWS ç„¡æ³•åˆ¤æ–·è©²åŸŸåçš„çœŸæ­£æ‰€æœ‰è€…ï¼Œå¯èƒ½å°è‡´åç¨±è¢«æ¿«ç”¨ï¼Œæˆ–è€…è§£æçµæœèˆ‡å¯¦éš›æ“æœ‰è€…çš„é…ç½®ä¸ä¸€è‡´ã€‚
    2. **é˜²æ­¢å‡å†’æœå‹™**ï¼š
        - å¦‚æœæœ‰äººæƒ¡æ„ä½¿ç”¨ä½ åŸŸåçš„åç¨±ï¼ˆä¾‹å¦‚ `demoprivatelink.shiun.me`ï¼‰ï¼Œå°‡å…¶é…ç½®ç‚ºè‡ªå·±çš„ VPC Endpoint Serviceï¼Œå¯èƒ½å°è‡´æµé‡è¢«éŒ¯èª¤åœ°å°å‘ä»–å€‘çš„ç§æœ‰æœå‹™ã€‚
        - é©—è­‰æ‰€æœ‰æ¬Šç¢ºä¿åªæœ‰åŸŸåçš„åˆæ³•æ“æœ‰è€…æ‰èƒ½é…ç½®å’Œä½¿ç”¨é€™å€‹åŸŸåã€‚
    
    ---
    
    ### **2. å¢å¼·æœå‹™æ¶ˆè²»è€…çš„ä¿¡ä»»**
    
    æœå‹™æ¶ˆè²»è€…ï¼ˆService Consumerï¼‰åœ¨ä½¿ç”¨ PrivateLink æ™‚ï¼Œéœ€è¦ä¿¡ä»»ä½ æä¾›çš„ Private DNS name æ˜¯åˆæ³•çš„ã€‚ä¾‹å¦‚ï¼š
    
    - å¦‚æœä½ å®£ç¨± `demoprivatelink.shiun.me` æ˜¯ä½ çš„æœå‹™çš„ Private DNS nameï¼Œä½†å¯¦éš›ä¸Šé€™å€‹åŸŸåæ˜¯å±¬æ–¼å…¶ä»–äººï¼Œä»–å€‘çš„å®¢æˆ¶ç«¯å¯èƒ½æœƒè¢«èª¤å°ã€‚
    - é€šéåŸŸåé©—è­‰ï¼Œæ¶ˆè²»è€…å¯ä»¥æ”¾å¿ƒè©²åŸŸåå±¬æ–¼ä½ ï¼Œé€²è€Œä¿¡ä»»è©²æœå‹™æ˜¯ç”±ä½ æä¾›çš„ã€‚
    
    ---
    
    ### **3. ç¢ºä¿ AWS DNS é‡å¯«çš„æº–ç¢ºæ€§**
    
    åœ¨ VPC ä¸­ï¼ŒAWS çš„å…§å»º DNS Resolver æœƒå„ªå…ˆè§£æ **Private DNS name** åˆ° **VPC Endpoint çš„ç§æœ‰ IP**ï¼Œé€™å€‹è¡Œç‚ºéœ€è¦ç¢ºä¿ä»¥ä¸‹æ¢ä»¶æˆç«‹ï¼š
    
    1. **ä½ æ˜¯è©²åŸŸåçš„åˆæ³•æ“æœ‰è€…**ï¼š
        - å¦‚æœæ²’æœ‰é©—è­‰ï¼ŒAWS ç„¡æ³•ç¢ºå®š `demoprivatelink.shiun.me` æ˜¯å¦å±¬æ–¼ä½ ã€‚
        - åŸŸåé©—è­‰æ˜¯ä¸€ç¨®ä¿è­‰ï¼Œè®“ AWS å¯ä»¥æ­£ç¢ºåœ°å°‡é€™å€‹åŸŸåè§£æåˆ°ä½ çš„ VPC Endpointã€‚
    2. **é¿å…èˆ‡å…¬å…± DNS è§£æçµæœè¡çª**ï¼š
        - å¦‚æœåŒä¸€åŸŸåè¢«ä¸åŒçš„æœå‹™æä¾›è€…ä½¿ç”¨ï¼Œä½† AWS ä¸é€²è¡Œé©—è­‰ï¼Œå¯èƒ½æœƒå°è‡´ VPC å…§éƒ¨å’Œå¤–éƒ¨çš„è§£æçµæœä¸ä¸€è‡´ï¼Œå¾è€Œç”¢ç”ŸéŒ¯èª¤æˆ–ä¸ç©©å®šçš„è¡Œç‚ºã€‚
    
    ---
    
    ### **4. åˆè¦æ€§èˆ‡ AWS çš„è²¬ä»»ç®¡ç†**
    
    AWS é€šéåŸŸåé©—è­‰ç¢ºä¿ä»–å€‘çš„æœå‹™ä¸æœƒå¹«åŠ©ç”¨æˆ¶ä¾µæ¬Šæˆ–æ¿«ç”¨ä»–äººè³‡æºï¼š
    
    1. **é˜²æ­¢åŸŸååŠ«æŒ**ï¼š
        - å¦‚æœæ²’æœ‰é©—è­‰ï¼Œå¯èƒ½æœ‰äººå‡å†’ä»–äººçš„åŸŸåä¾†æä¾›ç§æœ‰æœå‹™ï¼Œé€™æœƒå¸¶ä¾†æ³•å¾‹å’Œåˆè¦é¢¨éšªã€‚
    2. **æå‡å¹³å°çš„å®‰å…¨æ€§èˆ‡å…¬ä¿¡åŠ›**ï¼š
        - é©—è­‰æµç¨‹èƒ½ä¿è­‰åŸŸåçš„åˆæ³•æ€§ï¼Œé€²ä¸€æ­¥å¢å¼· AWS PrivateLink çš„å®‰å…¨æ€§å’Œå¯é æ€§ã€‚
    
    ---
    
    ### **5. é©—è­‰åŸŸåå¸¶ä¾†çš„é¡å¤–å¥½è™•**
    
    é©—è­‰åŸŸåæ‰€æœ‰æ¬Šé™¤äº†æ˜¯å®‰å…¨éœ€æ±‚å¤–ï¼Œä¹Ÿæœ‰å¯¦éš›çš„æŠ€è¡“å¥½è™•ï¼š
    
    1. **æ”¯æŒå…¬å…±èˆ‡ç§æœ‰æœå‹™çš„çµ±ä¸€åç¨±**ï¼š
        - é€éé©—è­‰ï¼Œä½ å¯ä»¥åŒæ™‚è®“ `demoprivatelink.shiun.me` åœ¨ **å…¬é–‹ DNS** å’Œ **AWS Private DNS** ä¸Šä½¿ç”¨ï¼Œé€™æ¨£æœå‹™æ¶ˆè²»è€…åœ¨å…¬ç¶²æˆ– VPC å…§éƒ¨éƒ½å¯ä»¥ç”¨ç›¸åŒçš„ DNS åç¨±è¨ªå•ä½ çš„æœå‹™ã€‚
    2. **è·¨å¸³æˆ¶çš„ä¿¡ä»»é—œä¿‚**ï¼š
        - å¦‚æœä½ çš„æœå‹™æ¶ˆè²»è€…ä¾†è‡ªå¤šå€‹ AWS å¸³æˆ¶ï¼ŒåŸŸåé©—è­‰å¯ä»¥å¢å¼·æ¶ˆè²»è€…å°æœå‹™çš„ä¿¡ä»»ï¼Œç‰¹åˆ¥æ˜¯åœ¨è·¨å¸³æˆ¶ä½¿ç”¨ PrivateLink æ™‚ã€‚
    
    ---
    
    ### **ç¸½çµï¼šç‚ºä»€éº¼éœ€è¦é©—è­‰åŸŸåï¼Ÿ**
    
    1. **é˜²æ­¢åç¨±è¡çªèˆ‡å‡å†’**ï¼š
        - ç¢ºä¿åªæœ‰åŸŸåçš„åˆæ³•æ“æœ‰è€…æ‰èƒ½ä½¿ç”¨é€™å€‹åç¨±ä½œç‚º Private DNS nameï¼Œé¿å…èª¤å°æˆ–æƒ¡æ„æ¿«ç”¨ã€‚
    2. **å¢å¼·ä¿¡ä»»**ï¼š
        - ç¢ºä¿æœå‹™æ¶ˆè²»è€…èƒ½ä¿¡ä»»ä½ çš„æœå‹™æ˜¯çœŸå¯¦ä¸”åˆæ³•çš„ã€‚
    3. **æ”¯æŒ DNS åç¨±ä¸€è‡´æ€§**ï¼š
        - é©—è­‰å¾Œï¼Œä½ å¯ä»¥çµ±ä¸€ç®¡ç†å…¬é–‹èˆ‡ç§æœ‰çš„åŸŸåè§£æï¼Œæ–¹ä¾¿æ¶ˆè²»è€…ç„¡ç¸«è¨ªå•æœå‹™ã€‚
    4. **ç¬¦åˆ AWS çš„åˆè¦æ€§è¦æ±‚**ï¼š
        - AWS é©—è­‰åŸŸåæ‰€æœ‰æ¬Šæ˜¯å…¶æœå‹™çš„åŸºæœ¬å®‰å…¨ä¿è­‰ï¼Œé¿å…æ½›åœ¨çš„æ³•å¾‹èˆ‡å®‰å…¨é¢¨éšªã€‚
    
    ---
    
    å¦‚æœä½ å°åŸŸåé©—è­‰æˆ– PrivateLink çš„å…¶ä»–ç´°ç¯€é‚„æœ‰ç–‘å•ï¼Œæ­¡è¿éš¨æ™‚è¨è«–ï¼ ğŸ˜Š
    
- é‚£æˆ‘å•ä¸€ä¸‹ï¼ŒRoute 53 private hosted zoneï¼Œæ˜¯å¦å°±å¯ä»¥éš¨ä¾¿äº‚å–åå­—ï¼Ÿ
    
    æ˜¯çš„ï¼Œ**Route 53 Private Hosted Zone** æ˜¯å°ˆç‚º **VPC å…§éƒ¨ DNS è§£æ** è¨­è¨ˆçš„ï¼Œå› æ­¤å®ƒçš„å‘½åè¦å‰‡å¯ä»¥æ›´åŠ è‡ªç”±ï¼Œ**ä¸éœ€è¦éµå¾ªå…¬å…± DNS çš„ç´„æŸ**ã€‚é€™æ„å‘³è‘—ä½ å¯ä»¥ä½¿ç”¨ä»»ä½•åç¨±ä½œç‚º Private Hosted Zone çš„åŸŸåï¼Œç”šè‡³æ˜¯ä¸ç¬¦åˆå…¬å…± DNS è¦ç¯„çš„åç¨±ã€‚
    
    ä¸éï¼Œé‚„æ˜¯æœ‰ä¸€äº›è€ƒé‡éœ€è¦æ³¨æ„ï¼š
    
    ---
    
    ### **1. Private Hosted Zone çš„å‘½åè‡ªç”±åº¦**
    
    - **å¯ä»¥éš¨æ„å–åå­—**ï¼š
        - ä½ å¯ä»¥å‰µå»ºé¡ä¼¼ `my.internal.zone` æˆ– `local.test` çš„ Private Hosted Zoneï¼Œç”šè‡³æ˜¯ä¸€äº›ä¸ç¬¦åˆæ¨™æº–çš„åç¨±ï¼ˆä¾‹å¦‚ `mycustomname` æ²’æœ‰ `.com` æˆ–å…¶ä»– TLDï¼‰ã€‚
        - å› ç‚º Private Hosted Zone çš„è§£æåƒ…é™æ–¼èˆ‡å®ƒé—œè¯çš„ VPCï¼Œæ‰€ä»¥é€™äº›åç¨±ä¸æœƒå½±éŸ¿å…¬å…±äº’è¯ç¶²ã€‚
    - **å¯ä»¥èˆ‡å…¬å…±åŸŸåç›¸åŒ**ï¼š
        - ä¾‹å¦‚ï¼Œå¦‚æœä½ æ“æœ‰ `example.com` çš„å…¬å…±åŸŸåï¼Œä½ ä¹Ÿå¯ä»¥å‰µå»ºä¸€å€‹ Private Hosted Zone å« `example.com`ï¼Œç”¨ä¾†è¦†è“‹ VPC å…§éƒ¨å°è©²åŸŸåçš„è§£æã€‚
    
    ---
    
    ### **2. ç§æœ‰åŸŸåä¸éœ€è¦åŸŸåæ‰€æœ‰æ¬Šé©—è­‰**
    
    - **ä¸éœ€è¦é©—è­‰åŸŸåæ‰€æœ‰æ¬Š**ï¼š
        - èˆ‡å…¬å…± DNS ä¸åŒï¼ŒPrivate Hosted Zone æ˜¯ç§æœ‰çš„ï¼ŒAWS ä¸æœƒæª¢æŸ¥ä½ æ˜¯å¦æ“æœ‰è©²åŸŸåçš„å…¬å…±æ‰€æœ‰æ¬Šã€‚
        - ä¾‹å¦‚ï¼Œä½ å¯ä»¥å‰µå»ºä¸€å€‹å« `google.com` çš„ Private Hosted Zoneï¼Œé€™ä¸æœƒå½±éŸ¿çœŸæ­£çš„ Googleï¼Œå› ç‚ºå®ƒåƒ…é™æ–¼ VPC å…§éƒ¨è§£æã€‚
    - **éœ€è¦æ³¨æ„é‡åé¢¨éšª**ï¼š
        - å¦‚æœä½ çš„ Private Hosted Zone åç¨±èˆ‡å…¬å…±åŸŸåé‡åï¼ŒVPC å…§éƒ¨çš„è³‡æºå°‡å„ªå…ˆè§£æ Private Hosted Zone çš„è¨˜éŒ„ã€‚
        - ä¾‹å¦‚ï¼ŒVPC å…§éƒ¨æŸ¥è©¢ `google.com` æ™‚ï¼Œå°‡è§£æåˆ°ä½ åœ¨ Private Hosted Zone ä¸­é…ç½®çš„è¨˜éŒ„ï¼Œè€Œä¸æ˜¯ Google çš„çœŸå¯¦å…¬é–‹è¨˜éŒ„ã€‚
    
    ---
    
    ### **3. Private Hosted Zone çš„å¯¦éš›æ‡‰ç”¨å ´æ™¯**
    
    ### **(1) ç”¨æ–¼å…§éƒ¨æœå‹™å‘½å**
    
    - ä½ å¯ä»¥ç‚ºå…§éƒ¨æœå‹™å‰µå»ºå°ˆå±¬çš„åŸŸåï¼Œæ¯”å¦‚ï¼š
        - `service.internal`
        - `myapp.local`
    - é€™äº›åç¨±ä¸éœ€è¦åœ¨å…¬å…± DNS ä¸­å­˜åœ¨ã€‚
    
    ### **(2) è¦†è“‹å…¬å…±åŸŸåè§£æ**
    
    - å¦‚æœä½ æ“æœ‰ `example.com` çš„å…¬å…±åŸŸåï¼Œä½†å¸Œæœ›åœ¨ VPC å…§éƒ¨æœ‰ä¸åŒçš„è§£æçµæœï¼Œå¯ä»¥å‰µå»ºä¸€å€‹ Private Hosted Zoneï¼Œç„¶å¾Œå®šç¾©å…§éƒ¨è§£æè¨˜éŒ„ã€‚
    
    ### **(3) æ¸¬è©¦ç’°å¢ƒ**
    
    - æ¸¬è©¦æ™‚å¯ä»¥éš¨æ„å‰µå»ºåŸŸåï¼Œæ¯”å¦‚ `test.local` æˆ– `dev.myapp`ï¼Œæ–¹ä¾¿ç®¡ç†æ¸¬è©¦è³‡æºã€‚
    
    ---
    
    ### **4. å‘½åçš„æ³¨æ„äº‹é …**
    
    ### **(1) é¿å…ä½¿ç”¨çœŸå¯¦å…¬å…±åŸŸåä½œæ¸¬è©¦**
    
    - é›–ç„¶ä½ å¯ä»¥ä½¿ç”¨ä»»æ„åç¨±ï¼Œä½†å¦‚æœé¸æ“‡äº†çœŸå¯¦çš„å…¬å…±åŸŸåï¼ˆå¦‚ `amazon.com`ï¼‰ï¼Œå®¹æ˜“é€ æˆæ··æ·†ã€‚
    - **å»ºè­°**ï¼šå°æ–¼æ¸¬è©¦ç”¨é€”ï¼Œä½¿ç”¨éçœŸå¯¦çš„åŸŸåï¼Œä¾‹å¦‚ `.internal`ã€`.test` æˆ– `.local`ã€‚
    
    ### **(2) èˆ‡å…¬å…±åŸŸåçš„è§£æå„ªå…ˆç´š**
    
    - å¦‚æœ VPC å…§éƒ¨æ—¢æœ‰ Private Hosted Zoneï¼Œåˆéœ€è¦è¨ªå•å…¬å…±ç¶²è·¯çš„åŒååŸŸåï¼Œè§£æå„ªå…ˆé †åºå¦‚ä¸‹ï¼š
        1. **Private Hosted Zone** è¨˜éŒ„å„ªå…ˆã€‚
        2. å¦‚æœ Private Hosted Zone ä¸­æ²’æœ‰è©²è¨˜éŒ„ï¼Œæ‰æœƒæŸ¥è©¢å…¬å…± DNSã€‚
    
    ### **(3) é¿å…éå¤šçš„ Private Hosted Zone é‡å**
    
    - å¦‚æœå¤šå€‹ Private Hosted Zone ä½¿ç”¨ç›¸åŒçš„åŸŸåï¼Œä¸¦é—œè¯åˆ°åŒä¸€å€‹ VPCï¼Œå¯èƒ½æœƒå°è‡´è§£ææ··äº‚ã€‚
    - **å»ºè­°**ï¼šä¿æŒæ¯å€‹ Private Hosted Zone çš„å‘½åå”¯ä¸€ã€‚
    
    ---
    
    ### **5. èˆ‡å…¬å…± DNS çš„æ¯”è¼ƒ**
    
    | **ç‰¹æ€§** | **Public DNS** | **Private Hosted Zone** |
    | --- | --- | --- |
    | **å‘½åè‡ªç”±åº¦** | å¿…é ˆç¬¦åˆå…¬å…± DNS è¦ç¯„ | å¯ä»¥éš¨æ„å‘½åï¼Œä¸éœ€å…¬å…±æ‰€æœ‰æ¬Šé©—è­‰ |
    | **æ‰€æœ‰æ¬Šé©—è­‰** | éœ€è¦é©—è­‰åŸŸåçš„å…¬å…±æ‰€æœ‰æ¬Š | ä¸éœ€è¦é©—è­‰ |
    | **å½±éŸ¿ç¯„åœ** | å…¬å…±äº’è¯ç¶² | åªé™æ–¼é—œè¯çš„ VPC |
    | **é‡åå½±éŸ¿** | å¯èƒ½èˆ‡å…¨çƒå”¯ä¸€æ€§è¡çª | åƒ…å½±éŸ¿ VPC å…§éƒ¨è§£æ |
    
    ---
    
    ### **çµè«–ï¼šå¯ä»¥éš¨ä¾¿å–åå­—ï¼Œä½†éœ€è¬¹æ…**
    
    1. **å¯ä»¥éš¨ä¾¿å‘½å**ï¼šPrivate Hosted Zone çš„åç¨±ä¸éœ€è¦å…¬å…± DNS è¦ç¯„ï¼Œä¸”åƒ…åœ¨ VPC å…§éƒ¨ç”Ÿæ•ˆï¼Œåç¨±å¯ä»¥æ˜¯ä»»ä½•æ ¼å¼ã€‚
    2. **éœ€è¦æ³¨æ„çš„äº‹é …**ï¼š
        - é¿å…èˆ‡å…¬å…±åŸŸåç”¢ç”Ÿä¸å¿…è¦çš„è¡çªã€‚
        - å°æ–¼æ¸¬è©¦ç”¨é€”ï¼Œå»ºè­°ä½¿ç”¨ `.internal`ã€`.test` æˆ– `.local` ç­‰å°ˆå±¬å¾Œç¶´ã€‚
    3. **æ‡‰ç”¨ç¯„ä¾‹**ï¼š
        - `myapp.local` ç”¨æ–¼å…§éƒ¨æœå‹™ã€‚
        - `dev.mycompany.internal` ç”¨æ–¼æ¸¬è©¦æˆ–é–‹ç™¼ç’°å¢ƒã€‚
    
    å¦‚æœ‰å…¶ä»–å…·é«”å ´æ™¯æˆ–å•é¡Œï¼Œæ­¡è¿è¨è«–ï¼ ğŸ˜Š
    
- æ‰€ä»¥æˆ‘èº«ç‚º Service Provider ï¼Œåœ¨ VPC å‰µå»ºäº† Endpoint Serviceï¼Œä¸¦æ²’æœ‰é¡å¤–è²»ç”¨ï¼Ÿ
    
    æ ¹æ“š AWS å®˜æ–¹è³‡è¨Šï¼Œä½œç‚ºæœå‹™æä¾›è€…ï¼ˆService Providerï¼‰ï¼Œåœ¨ VPC ä¸­å‰µå»º **VPC Endpoint Service** æœ¬èº«ä¸¦ä¸æœƒç”¢ç”Ÿç›´æ¥è²»ç”¨ã€‚ç„¶è€Œï¼Œæ”¯æ’è©²æœå‹™çš„åŸºç¤è¨­æ–½ï¼ˆä¾‹å¦‚ **Network Load Balancer (NLB)**ï¼‰ä»¥åŠç›¸é—œçš„æ•¸æ“šå‚³è¼¸å¯èƒ½æœƒç”¢ç”Ÿè²»ç”¨ã€‚
    
    ä»¥ä¸‹æ˜¯è©³ç´°èªªæ˜ï¼š
    
    ### 1. **VPC Endpoint Service çš„å‰µå»ºè²»ç”¨**
    
    - **å…è²»**ï¼šåœ¨ VPC ä¸­å‰µå»º **Endpoint Service** æœ¬èº«æ˜¯å…è²»çš„ï¼ŒAWS ä¸æœƒç‚ºæ­¤ç›´æ¥æ”¶å–è²»ç”¨ã€‚
    
    ### 2. **æ”¯æ’åŸºç¤è¨­æ–½çš„è²»ç”¨**
    
    - **Network Load Balancer (NLB)**ï¼š
        - **æ¯å°æ™‚è²»ç”¨**ï¼šNLB çš„ä½¿ç”¨æœƒç”¢ç”Ÿæ¯å°æ™‚è²»ç”¨ï¼Œå…·é«”è²»ç”¨å› å€åŸŸè€Œç•°ã€‚
        - **æ•¸æ“šè™•ç†è²»ç”¨**ï¼šé€šé NLB çš„æ•¸æ“šå‚³è¼¸å¯èƒ½æœƒç”¢ç”Ÿè²»ç”¨ï¼Œè¦–æ•¸æ“šé‡å’Œå€åŸŸè€Œå®šã€‚
    - **å…¬æœ‰ IPv4 åœ°å€**ï¼š
        - **ä½¿ç”¨ä¸­çš„å…¬æœ‰ IPv4 åœ°å€**ï¼šèˆ‡æ‚¨çš„ AWS è³‡æºï¼ˆå¦‚ EC2 å¯¦ä¾‹ã€è² è¼‰å‡è¡¡å™¨ç­‰ï¼‰é—œè¯ä¸¦æ­£åœ¨ä½¿ç”¨çš„å…¬æœ‰ IPv4 åœ°å€ï¼Œæ¯å°æ™‚æ”¶è²» $0.005 ç¾å…ƒã€‚
        - **é–’ç½®çš„å…¬æœ‰ IPv4 åœ°å€**ï¼šåˆ†é…çµ¦æ‚¨çš„ AWS å¸³æˆ¶ä½†æœªèˆ‡ä»»ä½•è³‡æºé—œè¯çš„å…¬æœ‰ IPv4 åœ°å€ï¼Œæ¯å°æ™‚åŒæ¨£æ”¶è²» $0.005 ç¾å…ƒã€‚
    
    ### 3. **æ•¸æ“šå‚³è¼¸è²»ç”¨**
    
    - **è·¨å€åŸŸæµé‡**ï¼šå¦‚æœæ‚¨çš„æœå‹™æ¶‰åŠè·¨å€åŸŸçš„æ•¸æ“šå‚³è¼¸ï¼Œå¯èƒ½æœƒç”¢ç”Ÿé¡å¤–çš„æ•¸æ“šå‚³è¼¸è²»ç”¨ã€‚
    
    ### 4. **ç¸½çµ**
    
    - **ç›´æ¥è²»ç”¨**ï¼šå‰µå»º **VPC Endpoint Service** æœ¬èº«ä¸æœƒç”¢ç”Ÿç›´æ¥è²»ç”¨ã€‚
    - **é–“æ¥è²»ç”¨**ï¼šæ”¯æ’è©²æœå‹™çš„åŸºç¤è¨­æ–½ï¼ˆå¦‚ NLBï¼‰å’Œæ•¸æ“šå‚³è¼¸å¯èƒ½æœƒç”¢ç”Ÿè²»ç”¨ã€‚
    
    å»ºè­°æ‚¨åƒè€ƒ [Amazon VPC å®šåƒ¹é é¢](https://aws.amazon.com/tw/vpc/pricing/) ä»¥ç²å–æ›´è©³ç´°å’Œæœ€æ–°çš„å®šåƒ¹è³‡è¨Šã€‚
    
    å¦‚æœæ‚¨æœ‰å…¶ä»–ç–‘å•æˆ–éœ€è¦é€²ä¸€æ­¥çš„è³‡è¨Šï¼Œæ­¡è¿éš¨æ™‚æå•ï¼
    
- AWS PrivateLink å¯ä»¥è·¨ Region å—ï¼Ÿä¾‹å¦‚ Consumer çš„æ‡‰ç”¨éƒ½åœ¨ ap-northeast-1ï¼Œä½†æ˜¯ Service Provider æŠŠä»–çš„ NLB å’Œ Endpoint Service éƒ¨ç½²åœ¨ us-east-1
    
    æŠ±æ­‰ï¼Œä¹‹å‰çš„å›ç­”æœ‰èª¤ã€‚æ ¹æ“šæœ€æ–°è³‡è¨Šï¼ŒAWS PrivateLink ç¾å·²æ”¯æ´è·¨å€åŸŸé€£ç·šã€‚é€™è¡¨ç¤ºæ‚¨å¯ä»¥åœ¨ä¸€å€‹å€åŸŸçš„ VPC ä¸­ï¼Œé€éä»‹é¢ VPC ç«¯é»ï¼ˆInterface VPC Endpointï¼‰é€£æ¥åˆ°å¦ä¸€å€‹å€åŸŸçš„ VPC ç«¯é»æœå‹™ï¼ˆEndpoint Serviceï¼‰ã€‚
    
    å› æ­¤ï¼Œåœ¨æ‚¨çš„æƒ…å¢ƒä¸­ï¼Œä½æ–¼ ap-northeast-1ï¼ˆæ±äº¬ï¼‰çš„ Consumer æ‡‰ç”¨ç¨‹å¼å¯ä»¥é€é PrivateLinkï¼Œé€£æ¥åˆ°ä½æ–¼ us-east-1ï¼ˆç¾åœ‹æ±éƒ¨ï¼‰çš„ Service Provider çš„ NLB å’Œ Endpoint Serviceã€‚
    
    è«‹æ³¨æ„ï¼Œè·¨å€åŸŸé€£ç·šå¯èƒ½æ¶‰åŠé¡å¤–çš„è²»ç”¨ï¼Œå»ºè­°æ‚¨åƒè€ƒ AWS å®˜æ–¹æ–‡ä»¶ä»¥ç²å–æœ€æ–°çš„å®šåƒ¹è³‡è¨Šã€‚
    
    æ­¤å¤–ï¼Œè·¨å€åŸŸé€£ç·šçš„å¯ç”¨æ€§å¯èƒ½å› å€åŸŸè€Œç•°ï¼Œå»ºè­°æ‚¨ç¢ºèªæ‰€æ¶‰åŠçš„å€åŸŸæ˜¯å¦æ”¯æ´æ­¤åŠŸèƒ½ã€‚
    
    [AWS](https://aws.amazon.com/tw/about-aws/whats-new/2024/11/aws-privatelink-across-region-connectivity/?utm_source=chatgpt.com)
    

- ä¸€é–‹å§‹ï¼ŒAWS VPC Endpointï¼ˆä¹Ÿç¨±ç‚º PrivateLinkï¼‰çš„ä¸»è¦è¨­è¨ˆç›®çš„æ˜¯è®“ AWS VPC å…§çš„è³‡æºï¼Œå¯ä»¥é€é Private IP ç›´æ¥å­˜å–æŸäº› AWS æœå‹™ï¼Œè€Œä¸éœ€è¦ç¶“ç”±å…¬ç¶²ï¼ˆInternetï¼‰ã€‚
ä½ èƒ½å¤šèˆ‰ä¾‹ä¸€äº›å¯¦éš›å ´æ™¯å—ï¼Ÿä¾‹å¦‚å“ªå€‹æœå‹™ï¼Œåœ¨ PrivateLink å‡ºç¾å‰ï¼Œæˆ‘å€‘éƒ½åªèƒ½ç”¨ Internet å»å­˜å–åˆ°é‚£äº› AWS æœå‹™ï¼Œå…·é«”ç‹€æ³æ˜¯æ€æ¨£ï¼Ÿç•¢ç«Ÿæˆ‘ä»¥å‰æ²’æœ‰ç¶“æ­·é PrivateLink å‡ºç¾ä»¥å‰æ‰€é­é‡çš„å•é¡Œ
    
    åœ¨ AWS PrivateLink å‡ºç¾ä»¥å‰ï¼Œå°æ–¼ä¸€äº› AWS æœå‹™ï¼ŒVPC å…§çš„è³‡æºï¼ˆä¾‹å¦‚ EC2ã€Lambda ç­‰ï¼‰ç„¡æ³•ç›´æ¥é€é Private IP å­˜å–é€™äº›æœå‹™ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¯¦éš›çš„å ´æ™¯ï¼Œå¹«åŠ©ä½ ç†è§£åœ¨ PrivateLink å‡ºç¾å‰çš„å…·é«”ç‹€æ³åŠå…¶æŒ‘æˆ°ï¼š
    
    1. å­˜å– S3 æˆ– DynamoDB
    â€¢	ç‹€æ³ï¼š
    åœ¨ PrivateLink å‡ºç¾ä»¥å‰ï¼Œå¦‚æœä½ çš„ EC2 ä½æ–¼ VPC è£¡ï¼Œæƒ³å­˜å– S3 æˆ– DynamoDBï¼Œå¿…é ˆé€šéå…¬å…±ç¶²è·¯ï¼Œç”šè‡³éœ€è¦ç‚ºæ­¤é…ç½® NAT Gateway æˆ– NAT Instanceã€‚
    â€¢	æµé‡æµç¨‹ï¼š
    EC2ï¼ˆPrivate Subnetï¼‰ -> NAT Gatewayï¼ˆæˆ– NAT Instanceï¼‰ -> Internet Gateway -> AWS å…¬ç¶² Endpointï¼ˆS3/DynamoDBï¼‰
    â€¢	é›–ç„¶ S3 å’Œ DynamoDB æœ¬èº«æ”¯æ´ SSL åŠ å¯†ï¼Œä½†é€™ç¨®æ¶æ§‹ä¸­çš„æµé‡ä¾ç„¶æœƒç©¿è¶Šå…¬å…±ç¶²è·¯ï¼Œä¸¦ä¾è³´ Internet è·¯ç”±ï¼Œå¯èƒ½å¸¶ä¾†ï¼š
    â€¢	å®‰å…¨æ€§é¢¨éšªï¼šè³‡æ–™å¯èƒ½æš´éœ²æ–¼å…¬ç¶²ã€‚
    â€¢	å»¶é²å•é¡Œï¼šæµé‡éœ€ç¹è·¯åˆ°å…¬ç¶²å†å›åˆ° AWS å…§éƒ¨ã€‚
    â€¢	è§£æ±ºæ–¹æ¡ˆå¾Œçš„æƒ…æ³ï¼š
    ç¾åœ¨ï¼Œä½ å¯ä»¥é€é PrivateLink æˆ– Gateway Endpointï¼ˆS3/DynamoDB æ”¯æ´ Gateway Endpointï¼‰ç›´æ¥å»ºç«‹ç§æœ‰è·¯å¾‘ï¼Œå®Œå…¨é¿å…å…¬ç¶²ã€‚
    2. å­˜å– Kinesis æˆ– Systems Manager
    â€¢	ç‹€æ³ï¼š
    å‡è¨­ä½ çš„æ‡‰ç”¨ç¨‹å¼éœ€è¦å°‡æ•¸æ“šæµï¼ˆdata streamï¼‰å‚³é€åˆ° Amazon Kinesisï¼Œæˆ–éœ€è¦ä½¿ç”¨ AWS Systems Managerï¼ˆä¾‹å¦‚ Parameter Store æˆ– Session Managerï¼‰ï¼Œä»¥å‰éƒ½éœ€è¦é€é Internet å­˜å–ï¼š
    â€¢	æµé‡æµç¨‹ï¼š
    EC2ï¼ˆPrivate Subnetï¼‰ -> NAT Gateway -> Internet Gateway -> Kinesis æˆ– Systems Manager API
    â€¢	å•é¡Œï¼š
    â€¢	é¡å¤–æˆæœ¬ï¼šNAT Gateway æµé‡è²»ç”¨ï¼ˆOutbound æµé‡åˆ° Internetï¼‰ã€‚
    â€¢	ä¾è³´ Internetï¼šè‹¥ Internet å‡ºç¾å•é¡Œæˆ–å—åˆ°æ”»æ“Šï¼Œå¯èƒ½å½±éŸ¿å…§éƒ¨æ‡‰ç”¨èˆ‡ Kinesis çš„äº’å‹•ã€‚
    â€¢	è§£æ±ºæ–¹æ¡ˆå¾Œçš„æƒ…æ³ï¼š
    ä½¿ç”¨ PrivateLinkï¼ŒVPC å…§çš„è³‡æºå¯ä»¥é€é Private IP ç›´æ¥èˆ‡é€™äº›æœå‹™äº¤äº’ï¼Œä¸”æµé‡å§‹çµ‚ç•™åœ¨ AWS Backbone ç¶²è·¯ä¸­ã€‚
    3. ä½¿ç”¨ API Gateway æˆ– Elastic Load Balancer (ELB)
    â€¢	ç‹€æ³ï¼š
    å‡è¨­ä½ çš„æ‡‰ç”¨ç¨‹å¼éœ€è¦å­˜å–æŸäº› API Gateway çš„ REST API æˆ– ALB/ELB çš„æ‡‰ç”¨ç¨‹å¼å¾Œç«¯æœå‹™ï¼š
    â€¢	æµé‡æµç¨‹ï¼š
    EC2ï¼ˆPrivate Subnetï¼‰ -> NAT Gateway -> Internet Gateway -> API Gateway æˆ– ELB Public Endpoint
    â€¢	å•é¡Œï¼š
    â€¢	å®‰å…¨æ€§æŒ‘æˆ°ï¼šå³ä½¿ API Gateway æ”¯æ´ SSL åŠ å¯†ï¼Œä½†æµé‡ä¾ç„¶ç¶“é Internetã€‚
    â€¢	é¡å¤–çš„é…ç½®éœ€æ±‚ï¼šä¾‹å¦‚é˜²ç«ç‰†è¦å‰‡ã€IP éæ¿¾ç­‰ï¼Œä¾†é™åˆ¶å“ªäº›ä¾†æº IP èƒ½å­˜å–ã€‚
    â€¢	è§£æ±ºæ–¹æ¡ˆå¾Œçš„æƒ…æ³ï¼š
    API Gateway å’Œ ALB ç¾åœ¨å¯ä»¥é…ç½® PrivateLinkï¼Œè®“æµé‡å®Œå…¨ç•™åœ¨ VPC å…§ï¼Œæå‡å®‰å…¨æ€§ã€‚
    4. SaaS æ‡‰ç”¨ç¨‹å¼çš„å­˜å–
    â€¢	ç‹€æ³ï¼š
    å‡è¨­ä½ ä½¿ç”¨çš„æ˜¯æŸäº›æ‰˜ç®¡åœ¨ AWS ä¸Šçš„ç¬¬ä¸‰æ–¹ SaaS æœå‹™ï¼ˆä¾‹å¦‚ Splunkã€Snowflake ç­‰ï¼‰ï¼Œåœ¨ PrivateLink å‡ºç¾ä»¥å‰ï¼Œé€™äº› SaaS æœå‹™é€šå¸¸åªæä¾› Public Endpointã€‚
    â€¢	æµé‡æµç¨‹ï¼š
    EC2ï¼ˆPrivate Subnetï¼‰ -> NAT Gateway -> Internet Gateway -> SaaS Public Endpoint
    â€¢	å•é¡Œï¼š
    â€¢	å®‰å…¨æ€§é¢¨éšªï¼šä¼æ¥­æ•¸æ“šéœ€æš´éœ²æ–¼å…¬ç¶²ä¸­ï¼Œå¯èƒ½æˆç‚ºæ”»æ“Šç›®æ¨™ã€‚
    â€¢	åˆè¦æ€§æŒ‘æˆ°ï¼šæŸäº›é‡‘èæˆ–é†«ç™‚æ‡‰ç”¨å¯èƒ½é•ååˆè¦è¦æ±‚ï¼Œå› ç‚ºæ•æ„Ÿæ•¸æ“šæµé‡ç¶“éå…¬ç¶²ã€‚
    â€¢	è§£æ±ºæ–¹æ¡ˆå¾Œçš„æƒ…æ³ï¼š
    SaaS æä¾›å•†å¯é€šé PrivateLink å°‡æœå‹™ Endpoint æš´éœ²ç‚º Private IPï¼Œä½ çš„ VPC å¯ç›´æ¥å­˜å–ï¼Œé¿å…è³‡æ–™æµé‡ç¶“é Internetã€‚
    
    ç¸½çµ
    
    åœ¨ PrivateLink å‡ºç¾ä»¥å‰ï¼Œä¾è³´ NAT Gateway é€²è¡Œå…¬å…±ç¶²è·¯å­˜å–æ˜¯å¸¸æ…‹ï¼Œä½†é€™å¸¶ä¾†äº†å®‰å…¨æ€§ã€æˆæœ¬å’Œæ€§èƒ½ä¸Šçš„æŒ‘æˆ°ã€‚PrivateLink çš„æ¨å‡ºï¼Œè®“ VPC è³‡æºèƒ½å¤ ç›´æ¥é€é Private IP å­˜å– AWS å’Œç¬¬ä¸‰æ–¹æœå‹™ï¼Œå¤§å¹…æå‡äº†å®‰å…¨æ€§å’Œæ•ˆç‡ï¼ŒåŒæ™‚æ¸›å°‘äº†å° NAT Gateway çš„ä¾è³´åŠå…¶ç›¸é—œæˆæœ¬ã€‚
    
- ä»¥ S3 ç‚ºä¾‹ï¼Œåœ¨ PrivateLink å‡ºç¾å‰ï¼Œç‚ºä»€éº¼æˆ‘æ²’è¾¦æ³•èµ° AWS Backbone ç¶²è·¯ï¼Ÿæˆ‘å€‘ä¸æ˜¯æœ‰ AWS SDK? Get object é›£é“é€é SDK å…¶å¯¦ä¹Ÿæ˜¯éœ€è¦é€é internet?
    
    é€™æ˜¯ä¸€å€‹å¾ˆå¥½çš„å•é¡Œï¼é›–ç„¶æˆ‘å€‘åœ¨ AWS è£¡é¢é‹è¡Œç¨‹å¼ç¢¼ï¼ˆä¾‹å¦‚é€é EC2 ä½¿ç”¨ AWS SDK ä¾†æ“ä½œ S3ï¼‰ï¼Œç›´è§€ä¸Šæœƒèªç‚ºé€™æ‡‰è©²æ˜¯ç¶“é AWS çš„å…§éƒ¨ç¶²è·¯ï¼Œä½†å¯¦éš›ä¸Šï¼Œåœ¨ AWS PrivateLink æˆ– VPC Gateway Endpoint å‡ºç¾ä¹‹å‰ï¼Œä½¿ç”¨ AWS SDK å­˜å– S3 çš„æµé‡çš„ç¢ºæœƒç¶“é å…¬ç¶²ï¼ˆInternetï¼‰ã€‚ä»¥ä¸‹æ˜¯ç‚ºä»€éº¼æœƒæœ‰é€™ç¨®æƒ…æ³çš„åŸå› ï¼š
    
    ç‚ºä»€éº¼é€é AWS SDK æ“ä½œ S3 é ˆç¶“å…¬ç¶²ï¼Ÿ
    1.	S3 çš„ Public Endpoint è¨­è¨ˆ
    â€¢	åœ¨æ—©æœŸï¼ŒAmazon S3 çš„å­˜å–æ˜¯åŸºæ–¼ Public Endpoint æä¾›çš„ï¼Œæ¯”å¦‚ï¼š
    â€¢	https://<bucket-name>.s3.amazonaws.com
    â€¢	https://s3.<region>.amazonaws.com
    â€¢	é€™äº› Public Endpoint æ˜¯é€é å…¬å…± DNS åç¨±ï¼ˆå¦‚ [s3.amazonaws.com](http://s3.amazonaws.com/) æˆ– s3.<region>.amazonaws.comï¼‰è§£æçš„ï¼Œè€Œé€™äº› DNS åç¨±çš„ IP åœ°å€æŒ‡å‘çš„æ˜¯ AWS çš„å…¬ç¶² IPã€‚
    2.	AWS SDK èˆ‡ S3 é€šä¿¡çš„é»˜èªè¡Œç‚º
    â€¢	ä½¿ç”¨ AWS SDKï¼ˆä¾‹å¦‚ boto3 æˆ– AWS CLIï¼‰èˆ‡ S3 äº’å‹•æ™‚ï¼š
    â€¢	è«‹æ±‚æœƒç™¼é€åˆ°é€™äº›å…¬å…± DNS åç¨±ã€‚
    â€¢	å³ä½¿ç¨‹å¼ç¢¼æ˜¯åœ¨ AWS VPC è£¡åŸ·è¡Œï¼ŒDNS è§£æçš„çµæœé‚„æ˜¯æŒ‡å‘å…¬ç¶² IPã€‚
    â€¢	è«‹æ±‚ç¶“ç”± Internet Gateway æˆ– NAT Gateway åˆ°é” S3 çš„ Public Endpointã€‚
    3.	AWS S3 çš„æ¶æ§‹èˆ‡å®‰å…¨æ€§
    â€¢	é›–ç„¶æµé‡ç¶“éå…¬ç¶²ï¼Œä½† S3 çš„å‚³è¼¸å±¤å®‰å…¨æ€§ï¼ˆä¾‹å¦‚ HTTPS åŠ å¯†ï¼‰ç¢ºä¿äº†æ•¸æ“šçš„å®‰å…¨æ€§ã€‚é€™æ˜¯æ—©æœŸ AWS æä¾›çš„ä¸»è¦å®‰å…¨æªæ–½ã€‚
    â€¢	ä½†ç”±æ–¼æµé‡ç¶“éå…¬ç¶²ï¼Œä¾ç„¶å¯èƒ½é‡åˆ°ï¼š
    â€¢	é¡å¤–çš„å»¶é²ï¼šå› ç‚ºæµé‡ç¹é“åˆ°å…¬ç¶²å†å›åˆ° AWS å…§éƒ¨ã€‚
    â€¢	åˆè¦æ€§å•é¡Œï¼šæŸäº›åˆè¦æ€§è¦æ±‚ï¼ˆå¦‚é‡‘èæˆ–é†«ç™‚è¡Œæ¥­ï¼‰ç¦æ­¢æ•¸æ“šæµé‡ç¶“éå…¬ç¶²ã€‚
    
    ç‚ºä»€éº¼ç„¡æ³•ç›´æ¥èµ° AWS å…§éƒ¨ç¶²è·¯ï¼Ÿ
    1.	DNS åç¨±èˆ‡ IP åœ°å€çš„é™åˆ¶
    â€¢	åœ¨ PrivateLink æˆ– Gateway Endpoint å‡ºç¾ä¹‹å‰ï¼ŒS3 æ²’æœ‰ç‚º VPC æä¾›å…§éƒ¨çš„ç§æœ‰ DNS åç¨±æˆ–ç§æœ‰ IP åœ°å€ã€‚
    â€¢	å³ä½¿ä½ åœ¨ VPC ä¸­é‹è¡Œ EC2ï¼Œç•¶å®ƒå˜—è©¦è§£æ [s3.amazonaws.com](http://s3.amazonaws.com/) æ™‚ï¼Œä»ç„¶åªèƒ½ç²å¾—å…¬ç¶² IPã€‚
    2.	S3 æ˜¯å€åŸŸï¼ˆRegionï¼‰å…§çš„å…¨çƒæœå‹™
    â€¢	S3 çš„ Public Endpoint æ˜¯è¨­è¨ˆç‚ºä¸€ç¨®ã€Œè·¨ AWS å€åŸŸï¼ˆRegionï¼‰å…±äº«ã€çš„æœå‹™ã€‚é€™ä½¿å¾—å®ƒçš„ Public Endpoint å¿…é ˆæš´éœ²åœ¨å…¬ç¶²ï¼Œä»¥ä¾¿ç”¨æˆ¶èƒ½å¤ å¾ä»»ä½•åœ°æ–¹ï¼ˆç„¡è«–æ˜¯å¦åœ¨ AWS ä¸Šï¼‰å­˜å– S3ã€‚
    3.	VPC çš„ç¶²è·¯éš”é›¢æ€§
    â€¢	VPC çš„è¨­è¨ˆåˆè¡·æ˜¯æä¾›å®Œå…¨éš”é›¢çš„ç§æœ‰ç¶²è·¯ç’°å¢ƒã€‚VPC è£¡çš„è³‡æºèˆ‡å¤–éƒ¨æœå‹™é€šä¿¡æ™‚ï¼Œå¿…é ˆé€šé Internet Gateway æˆ– NAT Gatewayï¼Œé€™æ˜¯æ—©æœŸ AWS çš„åŸºæœ¬ç¶²è·¯æ¶æ§‹è¨­è¨ˆã€‚
    
    PrivateLink/Gateway Endpoint è§£æ±ºäº†ä»€éº¼å•é¡Œï¼Ÿ
    1.	VPC Gateway Endpointï¼ˆS3/DynamoDB ç‰¹åŒ–è§£æ³•ï¼‰
    â€¢	AWS ç‚ºåƒ S3 é€™æ¨£çš„æœå‹™æ¨å‡ºäº† Gateway Endpointï¼Œå…è¨±åœ¨ VPC è·¯ç”±è¡¨ä¸­ç›´æ¥æ·»åŠ ä¸€æ¢åˆ° S3 çš„å…§éƒ¨è·¯ç”±è¦å‰‡ã€‚
    â€¢	ç‰¹é»ï¼š
    â€¢	ä½ å¯ä»¥ç›´æ¥é€é Private IP å­˜å– S3ï¼Œæµé‡å®Œå…¨åœ¨ AWS Backbone ç¶²è·¯å…§å‚³è¼¸ã€‚
    â€¢	é©ç”¨æ–¼å¤§é‡è³‡æ–™å‚³è¼¸ï¼ˆä¾‹å¦‚ Data Lakeï¼‰ã€‚
    2.	PrivateLinkï¼ˆæ›´å»£æ³›çš„è§£æ³•ï¼‰
    â€¢	PrivateLink å‰‡æä¾›äº†ä¸€ç¨®æ›´é€šç”¨çš„æ–¹å¼ï¼Œé©ç”¨æ–¼æ›´å¤š AWS æœå‹™å’Œè‡ªæœ‰æ‡‰ç”¨ç¨‹å¼ã€‚
    â€¢	å®ƒé€šé Interface Endpointï¼ˆä¸€å€‹ Elastic Network Interfaceï¼ŒENIï¼‰å°‡æœå‹™å¼•å…¥ä½ çš„ VPC ä¸­ï¼Œæ‰€æœ‰æµé‡éƒ½ç•™åœ¨ AWS Backbone ç¶²è·¯å…§ã€‚
    
    ç¸½çµï¼šåœ¨ PrivateLink æˆ– Gateway Endpoint å‡ºç¾å‰çš„æŒ‘æˆ°
    â€¢	æµé‡èµ°å…¬ç¶²çš„æ ¹æœ¬åŸå› ï¼šS3 çš„ Public Endpoint è¨­è¨ˆå’Œ VPC çš„ç¶²è·¯éš”é›¢æ€§ï¼Œå°è‡´ VPC å…§çš„æµé‡ç„¡æ³•ç›´æ¥é€šé AWS å…§éƒ¨ç¶²è·¯è¨ªå• S3ã€‚
    â€¢	AWS SDK çš„è¡Œç‚ºï¼šå³ä½¿ä½¿ç”¨ AWS SDKï¼Œè«‹æ±‚ä»ç„¶é€éå…¬å…± DNSï¼Œç„¡æ³•ç¹é Internetã€‚
    â€¢	è§£æ±ºæ–¹æ¡ˆçš„æ”¹è®Šï¼šPrivateLink å’Œ Gateway Endpoint çš„å‡ºç¾ï¼Œè®“ VPC å…§çš„è³‡æºå¯ä»¥ä½¿ç”¨ Private IP å®‰å…¨ã€é«˜æ•ˆåœ°è¨ªå• S3 å’Œå…¶ä»– AWS æœå‹™ã€‚
    
- ä½ ç¢ºå®š AWS SDK é»˜èªæ˜¯ä½¿ç”¨ Public DNS åœ¨ internet å­˜å– S3? æˆ‘ä¸å¤ªç›¸ä¿¡è€¶ï¼Œå¦‚æœç…§ä½ é€™æ¨£èªªï¼Œé‚£æˆ‘çš„ S3 è±ˆä¸æ˜¯éƒ½è¦å…¬é–‹ï¼Ÿè«‹ä½ ä¸Šç¶²æŸ¥è­‰ï¼Œç¢ºä¿è³‡è¨Šæ­£ç¢º
    
    æ‚¨æå‡ºäº†ä¸€ä¸ªéå¸¸é‡è¦çš„é—®é¢˜ã€‚åœ¨ AWS ä¸­ï¼ŒAmazon S3 çš„é»˜è®¤ç«¯ç‚¹æ˜¯å…¬å¼€çš„ï¼Œä½†è¿™å¹¶ä¸æ„å‘³ç€æ‚¨çš„ S3 å­˜å‚¨æ¡¶æˆ–å¯¹è±¡é»˜è®¤æ˜¯å…¬å¼€å¯è®¿é—®çš„ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰ S3 å­˜å‚¨æ¡¶å’Œå¯¹è±¡éƒ½æ˜¯ç§æœ‰çš„ï¼Œåªæœ‰ç»è¿‡æˆæƒçš„ç”¨æˆ·æ‰èƒ½è®¿é—®ã€‚å³ä½¿é€šè¿‡å…¬å…± DNS åç§°è®¿é—® S3ï¼Œæœªç»é€‚å½“çš„æƒé™é…ç½®ï¼Œå¤–éƒ¨ç”¨æˆ·ä¹Ÿæ— æ³•è®¿é—®æ‚¨çš„æ•°æ®ã€‚
    
    åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒAWS SDKï¼ˆå¦‚ Boto3ã€AWS CLI ç­‰ï¼‰ä½¿ç”¨å…¬å…± DNS åç§°ï¼ˆå¦‚ [s3.amazonaws.com](http://s3.amazonaws.com/)ï¼‰æ¥è®¿é—® S3 æœåŠ¡ã€‚è¿™äº›å…¬å…± DNS åç§°è§£æä¸º Amazon S3 çš„å…¬å…± IP åœ°å€ã€‚ç„¶è€Œï¼Œå½“æ‚¨åœ¨ VPC ä¸­è¿è¡Œåº”ç”¨ç¨‹åºæ—¶ï¼ŒAWS ä¼šè‡ªåŠ¨ä¼˜åŒ–æµé‡è·¯å¾„ï¼Œä½¿å¾—è¿™äº›è¯·æ±‚é€šè¿‡ AWS çš„å†…éƒ¨ç½‘ç»œè¿›è¡Œä¼ è¾“ï¼Œè€Œä¸éœ€è¦ç»è¿‡äº’è”ç½‘ã€‚è¿™æ„å‘³ç€ï¼Œå³ä½¿ä½¿ç”¨å…¬å…± DNS åç§°ï¼Œæ‚¨çš„æ•°æ®ä¼ è¾“ä»ç„¶åœ¨ AWS çš„ç§æœ‰ç½‘ç»œä¸­è¿›è¡Œï¼Œç¡®ä¿äº†æ•°æ®çš„å®‰å…¨æ€§å’Œä½å»¶è¿Ÿã€‚
    
    æ­¤å¤–ï¼ŒAWS æä¾›äº† VPC ç«¯ç‚¹ï¼ˆå¦‚ Gateway Endpoint å’Œ Interface Endpointï¼‰ï¼Œå…è®¸æ‚¨åœ¨ VPC å†…éƒ¨é€šè¿‡ç§æœ‰ IP åœ°å€ç›´æ¥è®¿é—® S3ï¼Œè€Œæ— éœ€é€šè¿‡äº’è”ç½‘ã€‚è¿™è¿›ä¸€æ­¥å¢å¼ºäº†å®‰å…¨æ€§å’Œæ€§èƒ½ã€‚ä½¿ç”¨ VPC ç«¯ç‚¹æ—¶ï¼Œæ‚¨å¯ä»¥é…ç½®ç§æœ‰ DNSï¼Œä»¥ä¾¿åœ¨ VPC å†…è§£æ S3 çš„å…¬å…± DNS åç§°æ—¶ï¼Œè¿”å› VPC ç«¯ç‚¹çš„ç§æœ‰ IP åœ°å€ã€‚è¿™ä½¿å¾—æ‚¨çš„åº”ç”¨ç¨‹åºæ— éœ€ä¿®æ”¹ä»£ç å³å¯é€šè¿‡ç§æœ‰ç½‘ç»œè®¿é—® S3ã€‚
    
    å› æ­¤ï¼Œè™½ç„¶ AWS SDK é»˜è®¤ä½¿ç”¨å…¬å…± DNS åç§°è®¿é—® S3ï¼Œä½†åœ¨ VPC ç¯å¢ƒä¸­ï¼ŒAWS ä¼šè‡ªåŠ¨ä¼˜åŒ–æµé‡è·¯å¾„ï¼Œç¡®ä¿æ•°æ®ä¼ è¾“åœ¨å†…éƒ¨ç½‘ç»œä¸­è¿›è¡Œã€‚åŒæ—¶ï¼Œä½¿ç”¨ VPC ç«¯ç‚¹å’Œç§æœ‰ DNSï¼Œæ‚¨å¯ä»¥è¿›ä¸€æ­¥ç¡®ä¿æ•°æ®ä¼ è¾“çš„ç§å¯†æ€§å’Œå®‰å…¨æ€§ã€‚
    
    æœ‰å…³å¦‚ä½•é…ç½® VPC ç«¯ç‚¹å’Œç§æœ‰ DNS çš„è¯¦ç»†ä¿¡æ¯ï¼Œæ‚¨å¯ä»¥å‚è€ƒ AWS å®˜æ–¹æ–‡æ¡£ï¼š
    â€¢	AWS PrivateLinkï¼šè¡¨ç¤º Amazon S3
    
- é‚£è«‹å•ï¼Œæˆ‘åœ¨ Lambda é€é SDK å­˜å– S3ï¼Œé»˜èªæ˜¯èµ° AWS Backbone ç¶²è·¯å—ï¼Ÿä¸æœƒèµ°åˆ° internet ä¾†å­˜å– S3? è«‹ä¸Šç¶²æŸ¥è­‰ï¼Œä¸¦é™„ä¸Šåƒè€ƒè³‡æ–™ä¾†æº
    
    æ‚¨æå‡ºäº†ä¸€ä¸ªå…³é”®é—®é¢˜ï¼Œæ¶‰åŠåœ¨ AWS Lambda ä¸­é€šè¿‡ AWS SDK è®¿é—® Amazon S3 æ—¶ï¼Œæµé‡è·¯å¾„çš„å…·ä½“æƒ…å†µã€‚
    
    é»˜è®¤æƒ…å†µä¸‹ï¼š
    â€¢	Lambda å‡½æ•°æœªè¿æ¥åˆ° VPCï¼šå½“æ‚¨çš„ Lambda å‡½æ•°æœªé…ç½®åœ¨ VPC å†…è¿è¡Œæ—¶ï¼Œå®ƒä¼šä½¿ç”¨ AWS çš„æ‰˜ç®¡ç½‘ç»œç¯å¢ƒã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé€šè¿‡ AWS SDK è®¿é—® S3 çš„è¯·æ±‚ä¼šé€šè¿‡ AWS çš„å†…éƒ¨ç½‘ç»œï¼ˆAWS Backboneï¼‰è¿›è¡Œä¼ è¾“ï¼Œè€Œä¸ä¼šç»è¿‡å…¬å…±äº’è”ç½‘ã€‚è¿™ç¡®ä¿äº†æ•°æ®ä¼ è¾“çš„å®‰å…¨æ€§å’Œä½å»¶è¿Ÿã€‚
    â€¢	Lambda å‡½æ•°è¿æ¥åˆ° VPCï¼šå¦‚æœæ‚¨å°† Lambda å‡½æ•°é…ç½®ä¸ºåœ¨ VPC å†…è¿è¡Œï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥å‡½æ•°åªèƒ½è®¿é—® VPC å†…çš„èµ„æºã€‚ä¸ºäº†ä½¿å…¶èƒ½å¤Ÿè®¿é—®å…¬å…± AWS æœåŠ¡ï¼ˆå¦‚ S3ï¼‰ï¼Œæ‚¨éœ€è¦é…ç½®é€‚å½“çš„ç½‘ç»œè®¾ç½®ã€‚è¿™é€šå¸¸æ¶‰åŠä»¥ä¸‹ä¸¤ç§æ–¹æ³•ï¼š
    1.	NAT ç½‘å…³æˆ– NAT å®ä¾‹ï¼šé…ç½®ä¸€ä¸ª NAT ç½‘å…³æˆ– NAT å®ä¾‹ï¼Œå…è®¸æ‚¨çš„ Lambda å‡½æ•°é€šè¿‡å®ƒä»¬è®¿é—®äº’è”ç½‘ï¼Œä»è€Œè®¿é—® S3 çš„å…¬å…±ç«¯ç‚¹ã€‚ç„¶è€Œï¼Œè¿™å¯èƒ½ä¼šå¼•å…¥é¢å¤–çš„å»¶è¿Ÿå’Œæˆæœ¬ã€‚
    2.	VPC ç«¯ç‚¹ï¼ˆGateway Endpointï¼‰ï¼šä¸º S3 é…ç½®ä¸€ä¸ª VPC ç«¯ç‚¹ï¼Œä½¿æ‚¨çš„ Lambda å‡½æ•°èƒ½å¤Ÿé€šè¿‡ç§æœ‰ IP åœ°å€ç›´æ¥è®¿é—® S3ï¼Œè€Œæ— éœ€ç»è¿‡äº’è”ç½‘ã€‚è¿™ä¸ä»…æé«˜äº†å®‰å…¨æ€§ï¼Œè¿˜å‡å°‘äº†å»¶è¿Ÿå’Œæˆæœ¬ã€‚æ ¹æ® AWS æ–‡æ¡£ï¼Œæ‚¨å¯ä»¥åœ¨ VPC ä¸­åˆ›å»ºä¸€ä¸ª Gateway Endpointï¼Œä»¥ä¾¿åœ¨ä¸ä½¿ç”¨ NAT ç½‘å…³çš„æƒ…å†µä¸‹è®¿é—® S3ã€‚
    
    å‚è€ƒèµ„æ–™ï¼š
    â€¢	åœ¨ Lambda å‡½æ•°ä¸­é…ç½® VPC è®¿é—®è¯¦ç»†è¯´æ˜äº†å¦‚ä½•å°† Lambda å‡½æ•°è¿æ¥åˆ° VPCï¼Œä»¥åŠå¦‚ä½•é…ç½®ç½‘ç»œä»¥è®¿é—®æ‰€éœ€çš„ AWS æœåŠ¡ã€‚
    â€¢	ä¸º Amazon S3 è®¾ç½® VPC ç«¯ç‚¹æä¾›äº†æœ‰å…³å¦‚ä½•ä¸º S3 é…ç½® VPC Gateway Endpoint çš„æŒ‡å¯¼ï¼Œä»¥å®ç°ç§æœ‰ç½‘ç»œè®¿é—®ã€‚
    
    æ€»è€Œè¨€ä¹‹ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒAWS Lambda å‡½æ•°é€šè¿‡ AWS çš„å†…éƒ¨ç½‘ç»œè®¿é—® S3ï¼Œè€Œä¸ä¼šç»è¿‡å…¬å…±äº’è”ç½‘ã€‚ç„¶è€Œï¼Œå½“æ‚¨å°† Lambda å‡½æ•°è¿æ¥åˆ° VPC æ—¶ï¼Œéœ€è¦é€‚å½“é…ç½®ç½‘ç»œè®¾ç½®ï¼ˆå¦‚ VPC ç«¯ç‚¹æˆ– NAT ç½‘å…³ï¼‰ï¼Œä»¥ç¡®ä¿å¯¹ S3 çš„è®¿é—®ä»ç„¶ä¿æŒåœ¨ AWS çš„å†…éƒ¨ç½‘ç»œä¸­ã€‚
    

å»¶çºŒå‰ä¸€ç¯‡ [å¦‚ä½•å°‡ç¾æœ‰ NLB IPv4-only æ¶æ§‹å‡ç´šç‚º Dual-stack](https://www.notion.so/NLB-IPv4-only-Dual-stack-174ea7e0d9d080e5b0e2cbe31f721c6a?pvs=21) 

æˆ‘å€‘å·²ç¶“æœ‰ä¸€å€‹ Dual-stack çš„ NLB äº†ã€‚

å‡å¦‚ä»Šå¤©æœ‰ä¸€å€‹éœ€æ±‚æ˜¯ã€Œå®¢æˆ¶æœƒéœ€è¦èª¿ç”¨æˆ‘å€‘ APIï¼Œè€Œä¸”ä¹Ÿæ˜¯ç”¨ AWSã€ï¼Œæœ‰æ²’æœ‰ä»€éº¼è¾¦æ³•æ˜¯ä¸ç”¨èµ° Internetï¼Ÿæ˜¯ç›´æ¥èµ° AWS çš„éª¨å¹¹ç¶²è·¯ (Backbone) ç›´æ¥æ‰“ API åˆ°æˆ‘å€‘é€™è£¡çš„ NLB? è€Œä¸”ä¸éœ€è¦ VPC Peering æˆ–æ˜¯ Transit Gatewayï¼Œé¿å…ç¶²è·¯æ•´å€‹æ‰“é€šï¼Œæ±è¥¿è¢«çœ‹å…‰å…‰ï¼Œå¼•ä¾†ä¸å¿…è¦é¢¨éšª

ç­”æ¡ˆå°±æ˜¯ PrivateLink

![Private Link Architecture Diagram: [https://docs.aws.amazon.com/whitepapers/latest/aws-vpc-connectivity-options/aws-privatelink.html](https://docs.aws.amazon.com/whitepapers/latest/aws-vpc-connectivity-options/aws-privatelink.html)](image.png)

Private Link Architecture Diagram: [https://docs.aws.amazon.com/whitepapers/latest/aws-vpc-connectivity-options/aws-privatelink.html](https://docs.aws.amazon.com/whitepapers/latest/aws-vpc-connectivity-options/aws-privatelink.html)

## Terminology

- **Service Consumer**:
ä½¿ç”¨æœå‹™çš„ä¸€æ–¹ã€‚Consumer æœƒåœ¨è‡ªå·±çš„ VPC ä¸­å»ºç«‹ VPC Interface Endpoint ä¾†é€£æ¥åˆ° Provider çš„ Endpoint serviceã€‚Consumer å¿…é ˆç­‰å¾… Provider æ¥å—é€£æ¥è«‹æ±‚å¾Œï¼Œæ‰èƒ½é–‹å§‹ä½¿ç”¨æœå‹™ã€‚é€éé€™ç¨®æ–¹å¼ï¼Œ**Consumer å¯ä»¥å®‰å…¨åœ°å­˜å– Provider çš„æœå‹™ï¼Œè€Œç„¡éœ€ç¶“éå…¬æœ‰ç¶²è·¯ã€‚**
    - **Endpoint**:
    VPC Interface Endpoint (VPCE) æ˜¯ä¸€å€‹å½ˆæ€§ç¶²è·¯ä»‹é¢ï¼Œå…·æœ‰ç§æœ‰ IP ä½å€ã€‚å®ƒä½œç‚ºé€²å…¥ AWS æœå‹™çš„é€²å…¥é»ï¼Œè®“ VPC ä¸­çš„è³‡æºå¯ä»¥ç§å¯†åœ°å­˜å–é€™äº›æœå‹™ã€‚åœ¨ PrivateLink æ¶æ§‹ä¸­ï¼Œ**é€™æ˜¯ Consumer ç«¯å»ºç«‹çš„å…ƒä»¶ã€‚**
- **Service Provider**:
æä¾›æœå‹™çš„ä¸€æ–¹ã€‚Provider éœ€è¦å»ºç«‹ Endpoint service ä¸¦å°‡å…¶èˆ‡ NLB é—œè¯ï¼Œç„¶å¾Œå¯ä»¥é¸æ“‡æ€§åœ°å…è¨±å“ªäº› AWS å¸³æˆ¶å¯ä»¥é€£æ¥åˆ°æ­¤æœå‹™ã€‚Provider è² è²¬æ¥å—æˆ–æ‹’çµ•ä¾†è‡ª Consumer çš„é€£æ¥è«‹æ±‚ã€‚
    - **Endpoint service**:
    Endpoint service æ˜¯ç”± Service Provider å»ºç«‹çš„æœå‹™ï¼Œå¯ä»¥èˆ‡ Network Load Balancer (NLB) æˆ–æ˜¯ Gateway Load Balancer (GWLB) é—œè¯ã€‚é€™å€‹æœå‹™å…è¨±å…¶ä»– AWS å¸³æˆ¶ (Consumer) é€šé VPC Interface Endpoint é€£æ¥åˆ° Provider çš„æœå‹™ã€‚

## Section 1: é…ç½® PrivateLink

### Step 1: [Provider] å‰µå»º Endpoint service

åœ¨é€™å€‹æ­¥é©Ÿï¼Œæˆ‘å€‘å°‡æ‰®æ¼” Service Providerï¼Œæˆ‘å€‘æ˜¯æä¾› Service çš„äºº

**é€²å…¥ VPC é é¢ > å·¦å´æ¬„ Endpoint services:**

1. é»æ“Š **Create endpoint service**

![[Provider] Create endpoint service](image%201.png)

[Provider] Create endpoint service

é€²å…¥ Create endpoint service é é¢å¾Œï¼Œè«‹ä¾ç…§ä»¥ä¸‹å…§å®¹é€²è¡Œé…ç½®ï¼š

1. **Load balancer type:** Network
2. **Available load balancers:** é¸æ“‡ä½ çš„ NLB

å…¶ä»–éƒ¨åˆ†å¯ä»¥ä¿æŒé è¨­

![[Provider] Create Endpoint service configuration](715d637f-6b78-49cf-8ef2-b48e1cb53492.png)

[Provider] Create Endpoint service configuration

å‰µå»ºå¥½å¾Œï¼Œè¤‡è£½ **Service name**

![[Provider] Copy service name](image%202.png)

[Provider] Copy service name

### Step 2: [Consumer] å‰µå»º VPC Interface Endpoint (VPCE)

ç¾åœ¨æˆ‘å€‘çš„èº«ä»½åˆ‡æ›è‡³ **Consumer**

èº«ç‚º Consumerï¼Œæˆ‘å€‘éœ€è¦å»ºç«‹ä¸€å€‹ **VPC Interface Endpoint (VPCE)**ï¼Œé€é VPCE å­˜å–åˆ° Service Provider çš„æœå‹™ã€‚

é€²å…¥ VPC é é¢ > å·¦å´æ¬„ Endpoints:

1. é»æ“Š **Create endpoint**

![[Consumer] Create endpoint](image%203.png)

[Consumer] Create endpoint

å‰µå»º VPC Interface Endpointï¼Œè«‹ä¾ç…§ä»¥ä¸‹å…§å®¹é€²è¡Œé…ç½®ï¼š

- **Type:** Endpoint services that use NLBs and GWLBs
- **Service name:** è²¼ä¸Šå‰›æ‰åœ¨ Service Provider é‚£é‚Šæ‰€è¤‡è£½çš„ Service name

![[Consumer] Create VPC Interface Endpoint configuration](image%204.png)

[Consumer] Create VPC Interface Endpoint configuration

å‰µå»ºå¥½ VPC Interface Endpoint ä¹‹å¾Œï¼Œèº«ç‚º Consumerï¼Œ**å…¶å¯¦é‚„ä¸èƒ½é¦¬ä¸Šå­˜å– Serviceï¼Œå¿…é ˆç­‰å¾… Provider æ¥å—ä½ çš„é€£ç·šè«‹æ±‚æ‰å¯ä»¥ä½¿ç”¨ã€‚**

### Step 3: [Provider] æ¥å— Acceptance

èº«ä»½åˆ‡å› **Service Provider**

å›åˆ° VPC é é¢ > å·¦å´æ¬„ Endpoint services:

1. å‹¾é¸ **Endpoint service**
2. é€²å…¥ **Endpoint connections** é ç±¤
3. å‹¾é¸ **Endpoint connection** 
4. å±•é–‹ **Actions menu** 
5. é»æ“Š **Accept endpoint connection request**

![[Provider] Accept endpoint connection request](image%205.png)

[Provider] Accept endpoint connection request

### [Consumer] æ¸¬è©¦æ˜¯å¦å¯ä»¥é€é VPC Interface Endpoint èª¿ç”¨åˆ° NLB

èº«ä»½åˆ‡å› **Consumer**

å‰›æ‰ **Provider** å·²ç¶“æ¥å—é€£ç·šäº†ï¼Œå›åˆ° VPC > å·¦å´æ¬„ Endpoint é é¢ï¼Œæª¢æŸ¥ä¸€ä¸‹ç›®å‰ Endpoint çš„ Statusï¼š

- ä»–æœƒåœåœ¨ **Pending** ç‹€æ…‹ä¸€ä¸‹ä¸‹ï¼Œå¤§æ¦‚ 1~2 åˆ†é˜ï¼Œç­‰åˆ°è®Šæˆ **Available** å°± OK å›‰ï¼
    
    ![[Consumer] Waiting for endpoint status to be available](image%206.png)
    
    [Consumer] Waiting for endpoint status to be available
    

ç¾åœ¨ Endpoint Status å·²ç¶“æ˜¯ **Available** ç‹€æ…‹ï¼Œè¦æ¸¬è©¦æ˜¯å¦èƒ½é€é VPC Interface Endpoint èª¿ç”¨åˆ° Service Provider çš„ NLBï¼Œé¦–å…ˆè¦å…ˆè¤‡è£½ **VPC Interface Endpoint çš„ DNS name**

![[Consumer] Copy VPC Interface Endpoint DNS name](image%207.png)

[Consumer] Copy VPC Interface Endpoint DNS name

> ä½ æœƒæ³¨æ„åˆ° DNS names æä¾›äº†å…©å€‹ Domain nameï¼Œä¸‹é¢æ²’æœ‰è¢«ç´…æ¡†æ¡†èµ·ä¾†çš„ **Zonal DNS name**ï¼Œå¯ä»¥ä¿è­‰ä½ çš„æµé‡ä¸€å®šæ‰“åˆ°ä½ è¦çš„ AZ

é—œæ–¼ AZ é€™æ–¹é¢æœ‰ä¸€å€‹æ³¨æ„äº‹é …ï¼Œå¯ä»¥åƒè€ƒæˆ‘çš„ç­†è¨˜: [https://shiun.notion.site/AZ-AZ-95d15fb85b1a4eb2a3cc76e5b3e7bee1?pvs=4](https://www.notion.so/AZ-AZ-95d15fb85b1a4eb2a3cc76e5b3e7bee1?pvs=21)
> 

æˆ‘ç¾åœ¨åœ¨ **Consumer** å¸³è™Ÿï¼Œé€éä¸€å°è·³æ¿æ©Ÿ SSH é€£ç·šåˆ° Private subnet è£¡é¢çš„ä¸€å° Instance

æˆåŠŸé€£ç·šå¾Œï¼Œè¼¸å…¥ä»¥ä¸‹æŒ‡ä»¤ä¾†å­˜å– VPCEï¼Œéœ€è¦æ³¨æ„ï¼Œ **`curl` å¾Œé¢å¯¦éš›å€¼æ›æˆä½ å‰›æ‰è¤‡è£½çš„ VPC Interface Endpoint DNS nameï¼š**

```bash
$ curl vpce-0d3d9cfb73e4becfd-iiv45fgg.vpce-svc-0ceb593b3ba202634.us-west-2.vpce.amazonaws.com

<h1>Hello World from ip-10-0-138-176.us-west-2.compute.internal</h1>
```

é€éä¸Šé¢çš„è¼¸å‡ºï¼Œé€™æ¨£å°±é”æˆã€Œ**å®Œå…¨ä¸é€é Internet å°±æ‰“æµé‡åˆ° NLB**ã€çš„æ¶æ§‹å›‰ï¼æµé‡éƒ½æ˜¯åœ¨ AWS Backbone ç¶²è·¯ä¸­å…§å‚³è¼¸ã€‚

> **æ³¨æ„ï¼š**VPC Interface Endpoint å’Œ æˆ‘é€£ç·šé€²å»çš„ EC2 Instance éƒ½æ”¾åœ¨ Private subnetï¼Œ**æˆ‘ä¹Ÿæ²’é…ç½® NAT æˆ–æ˜¯ EIGW**ï¼Œæ‰€ä»¥ä»–å€‘æ˜¯ä¸å¯èƒ½æœ‰è¾¦æ³•é€£åˆ°ç¶²è·¯çš„
> 

ä»¥ä¸‹ç°¡å–®è­‰æ˜æ²’æœ‰é€£ç¶²èƒ½åŠ›ï¼Œæˆ‘å…ˆ `ping google.com` å† `curl` VPC Interface Endpoint

![[Consumer] This consumer instance doesnâ€™t have internet connectivity](image%208.png)

[Consumer] This consumer instance doesnâ€™t have internet connectivity

æ­å–œï¼æˆ‘å€‘å·²ç¶“æˆåŠŸé…ç½®å¥½ PrivateLink å›‰ï¼

## Section 2: Dual-stack

åœ¨ Section 2ï¼Œå°‡å¸¶å¤§å®¶å¯¦ç¾ Dual-stack PrivateLinkï¼Œè®“ Consumer ä»¥åŠ Providerï¼ŒåŒæ™‚éƒ½å¯ä»¥æ”¯æŒ IPv4 å’Œ IPv6

### [Provider] ç‚º Endpoint Service é–‹å•Ÿ IPv6 Support

ç›®å‰èº«ä»½æ˜¯ **Service Provider** 

å› ç‚ºç•¶åˆå‰µå»º Endpoint Service æ™‚ï¼Œæ²’å‹¾é¸ IPv6 supportï¼Œå¯ä»¥è§€å¯Ÿä¸‹åœ–çš„ **Supported IP address type ä¸­åƒ…é¡¯ç¤º IPv4** ï¼Œæ‰€ä»¥ç”¨ **IPv6 æµé‡æ‰“éå»æœƒç„¡æ³•è§£æ**ï¼š

![[Provider] This Endpoint service does not support IPv6 address type](image%209.png)

[Provider] This Endpoint service does not support IPv6 address type

ä»¥ä¸‹ç¯„ä¾‹æ˜¯ä»¥ **Consumer** èº«ä»½é€£ç·šé€²å» Private Instanceï¼Œåˆ©ç”¨ `curl -6` èª¿ç”¨ VPC Interface Endpoint æ‰€å¾—åˆ°çš„è¼¸å‡ºï¼š

```bash
$curl -6  vpce-0d3d9cfb73e4becfd-iiv45fgg.vpce-svc-0ceb593b3ba202634.us-west-2.vpce.amazonaws.com

curl: (6) Could not resolve host: vpce-0d3d9cfb73e4becfd-iiv45fgg.vpce-svc-0ceb593b3ba202634.us-west-2.vpce.amazonaws.com
```

é€²å…¥ VPC > å·¦å´æ¬„ Endpoint services:

1. é¸å– **Endpoint service** 
2. å±•é–‹ **Actions menu**
3. é»æ“Š **Modify supported IP address types**

![[Provider] Modify supported IP address types](image%2010.png)

[Provider] Modify supported IP address types

åœ¨ Supported IP address types ä¸‹æ–¹é¸é …æŠŠ IPv6 ä¹Ÿå‹¾é¸èµ·ä¾†ï¼š

![[Provider] Enable IPv6 address type](image%2011.png)

[Provider] Enable IPv6 address type

### [Consumer] ä½¿ VPC Interface Endpoint æ”¯æŒ Dual-stack

ç›®å‰èº«ä»½æ˜¯ **Consumer**

æ¥ä¸‹ä¾†æˆ‘å€‘ä¹Ÿè¦ç¢ºä¿ Consumer é€™è£¡çš„ VPC Interface Endpoint ä¹Ÿæ”¯æŒ Dual-stackï¼Œå› æ­¤è¦è¨˜ä½ï¼ä¸¦ä¸æ˜¯ Provider å°‡ Supported IP address types ä¸‹çš„ IPv4, IPv6 éƒ½å•Ÿç”¨ï¼ŒConsumer é€™è£¡å°±å¯ä»¥ä»€éº¼äº‹éƒ½ä¸ç”¨åšå°±å¯ä»¥ç”¨ IPv6 Client å»èª¿ç”¨å–”ï¼Œç•¢ç«Ÿåœ¨ Consumer é€™è£¡ï¼Œé¢å°çš„æ˜¯è‡ªå·±çš„ â€œVPC Interface Endpointâ€

é€²å…¥ VPC > å·¦å´æ¬„ Endpoints 

1. é¸å– **Endpoint**
2. å±•é–‹ **Actions menu**
3. é»æ“Š **Modify endpoint settings**

![[Consumer] Modify endpoint settings](image%2012.png)

[Consumer] Modify endpoint settings

é€²å…¥ Modify endpoint settings é é¢ï¼š

- **IP address type:** Dualstack
- **DNS options:** Dualstack

![[Consumer] Enable dual-stack support](image%2013.png)

[Consumer] Enable dual-stack support

Save ä¹‹å¾Œ Endpoint æœƒé€²å…¥ **Pending** ç‹€æ…‹ï¼Œè¦ç­‰ 1~2 åˆ†é˜ç›´åˆ°å®ƒè®Šæˆ **Available** ç‹€æ…‹

ç•¶ Endpoint ç‹€æ…‹è®Šæˆ **Available** å¾Œï¼ŒSSH é€£ç·š EC2 Instance å†ä¾†æ¸¬è©¦ä¸€æ¬¡å§ï¼š

```bash
$ curl -6  vpce-0d3d9cfb73e4becfd-iiv45fgg.vpce-svc-0ceb593b3ba202634.us-west-2.vpce.amazonaws.com

<h1>Hello World from ip-10-0-138-176.us-west-2.compute.internal</h1>
```

> è£œå……è³‡è¨Šï¼šæˆ‘é€™é‚Šå‰›å¥½æ²’ Clear CLIï¼Œæ‰€ä»¥å¯ä»¥çœ‹åˆ°è¨­å®šæˆ Dualstack çš„å‰å¾Œè®ŠåŒ–ï¼Œä¸€é–‹å§‹é‚„ç„¡æ³•è§£ææˆåŠŸï¼Œç¶“éä¸Šé¢çš„é‡æ–°è¨­å®šï¼Œå°±æˆåŠŸä½¿ç”¨ IPv6 Client å»æ‰“æµé‡åˆ° VPC Interface Endpoint ç¢°åˆ° NLB å”·
> 
> 
> ![image.png](image%2014.png)
> 

æ­å–œï¼Œæˆ‘å€‘é€™æ¨£å°±å®Œæˆ Dual-stack PrivateLink!

---

## Section 3:  Private DNS name

[Manage DNS names for VPC endpoint services - Amazon Virtual Private Cloud](https://docs.aws.amazon.com/vpc/latest/privatelink/manage-dns-names.html)

Private DNS name æ˜¯ä¸€å€‹å¾ˆæ–¹ä¾¿çš„åŠŸèƒ½ï¼Œå¦‚æœä½ æ˜¯ Service Providerï¼Œæƒ³è¦é…ç½® Private DNS Name ä½ å¿…é ˆæ“æœ‰**åŸŸå**ï¼Œä¾‹å¦‚: Private DNS name è¨­å®šç‚º [example.com](http://example.com/) çš„è©±ï¼Œç¶“é DNS é©—è­‰ä¹‹å¾Œï¼ŒConsumer ç«¯ä¹‹å¾Œå°±å¯ä»¥ç›´æ¥ç”¨ [example.com](http://example.com/) ä¾†å­˜å–é€™å€‹ Endpoint Service

å› ç‚ºæˆ‘è‡ªå·±æœ‰åŸŸåï¼Œé€™è£¡æˆ‘å°±ç”¨æˆ‘è‡ªå·±çš„åŸŸå(shiun.me)ä¾†ç¤ºç¯„

### [Provider] Endpoint Service è¨­å®š Private DNS name

![[Provider] The endpoint service does not support Private DNS name](image%2015.png)

[Provider] The endpoint service does not support Private DNS name

é€²å…¥ VPC > å·¦å´æ¬„ Endpoint services:

1. é¸å– **Endpoint service**
2. å±•é–‹ **Actions menu**
3. é»æ“Š **Modify private DNS name**

![[Provider] Modify private DNS name](image%2016.png)

[Provider] Modify private DNS name

é…ç½® Private DNS name:

1. å‹¾é¸ **Associate a private DNS name with the service**
2. è¼¸å…¥ **Private DNS name:** æˆ‘è¼¸å…¥ `demoprivatelink.shiun.me` (è«‹ä¾ç…§ä½ è‡ªå·±æ“æœ‰çš„åŸŸåè‡ªç”±ä¿®æ”¹é€™é‚Šçš„å€¼)

![[Provider] Set up Private DNS name](image%2017.png)

[Provider] Set up Private DNS name

### [Provider] åŸŸåé©—è­‰

å‰µå»ºå¥½ä¹‹å¾Œï¼Œ**Domain verification status** æœƒé¡¯ç¤º Pending verificationï¼Œ é€™æ™‚å€™æˆ‘å°±è¦æ ¹æ“šæŒ‡ç¤ºå‰µå»ºä¸€å€‹ TXT Record è­‰æ˜é€™å€‹ [shiun.me](http://shiun.me) åŸŸåæ­¸ä½ æ‰€ç®¡ï¼Œæˆ‘å€‘å¯ä»¥å¾ **Endpoint service detail** æ‰¾åˆ° å‰µå»º **Record æ™‚**æ‰€éœ€è¦è¨­å®šçš„å€¼ï¼Œå¦‚ä¸‹åœ–ç´…æ¡†æ‰€ç¤º

![[Provider] DNS verification details](image%2018.png)

[Provider] DNS verification details

æ‰€ä»¥æˆ‘æ‰“é–‹æˆ‘çš„ DNS æœå‹™é…ç½® TXT Record 

> æ³¨æ„ï¼šä¸‹é¢æˆªåœ–çš„ç•«é¢ï¼Œä½ ä¸è¦‹å¾—æœƒè·Ÿæˆ‘ä¸€æ¨£
ä¹Ÿè¨±ä½ æ˜¯ç”¨ Route53 ä¹Ÿè¨±ä½ æ˜¯ç”¨å…¶ä»–åŸŸåè¨»å†Šå•†æœ¬èº«è‡ªå·±æä¾›çš„ DNS æœå‹™
> 

![[Provider] Create a TXT Record for DNS verification](image%2019.png)

[Provider] Create a TXT Record for DNS verification

å‰µå»ºå®Œ TXT Record ä¹‹å¾Œï¼Œå¯èƒ½è¦ç¨å¾…å¹¾åˆ†é˜ (ä¾‹å¦‚ 5 mins)ï¼Œç­‰å¾… DNS Propagationã€‚

æˆ‘ç­‰äº†å¤§æ¦‚ 5 minsï¼Œå›åˆ° VPC é é¢ > å·¦å´æ¬„ Endpoint services:

1. é¸å– **Endpoint Service** 
2. å±•é–‹ **Actions menu**
3. é»æ“Š **Verify domain ownership for private DNS name**

![[Provider] Verify domain ownership for private DNS name](image%2020.png)

[Provider] Verify domain ownership for private DNS name

é€™æ™‚å€™å†ç­‰ä¸€ä¸‹ä¸‹ï¼Œç´„ä¸€åˆ†é˜ï¼Œé‡æ–°æ•´ç†ä¸€ä¸‹é é¢ï¼Œå°±æœƒçœ‹åˆ° **Domain verification status è®Šæˆ Verifiedï¼Œå¦‚æœç™¼ç¾é‚„æ²’ Verifiedçš„è©±ï¼Œè«‹ä½ ï¼š**

1. å†æ¬¡æª¢æŸ¥ **DNS Record æ˜¯å¦æœ‰é…ç½®éŒ¯èª¤** (Type, valueâ€¦ ç­‰)
2. å†æ¬¡ç¨ç­‰ä¸€ä¸‹ä¸‹ï¼Œå¯ä»¥ç”¨ `dig TXT <domain>` ä¾†æª¢æŸ¥çœ‹çœ‹ Answer æ˜¯å¦é…ç½®æ­£ç¢º
3. é‡æ–° **Verify domain ownership for private DNS name**

![[Provider] Checking the Domain Verification status shows it is verified](image%2021.png)

[Provider] Checking the Domain Verification status shows it is verified

### [Consumer] VPC Interface Endpoint å•Ÿç”¨ Private DNS name

ç›®å‰èº«ä»½æ˜¯ **Consumer**

åŒç†ï¼Œèº«ç‚º Consumer é€™æ–¹ï¼ŒVPC Interface Endpoint é€™è£¡ä¹Ÿéœ€è¦**å•Ÿç”¨ Private DNS name çš„æ”¯æŒ**ï¼Œå¯ä»¥çœ‹åˆ°ä¸‹åœ–ç´…æ¡†è™•ï¼Œ**Private DNS name enabled** é¡¯ç¤º **Noï¼Œ**è¡¨ç¤ºç›®å‰é‚„å°šæœªå•Ÿç”¨æ­¤åŠŸèƒ½

![[Consumer] The VPC Interface endpoint does not support Private DNS name](image%2022.png)

[Consumer] The VPC Interface endpoint does not support Private DNS name

é€²å…¥ VPC > å·¦å´æ¬„ Endpoints:

1. é¸å– **Endpoint**
2. å±•é–‹ **Actions menu**
3. é»æ“Š **Modify private DNS name**

![[Consumer] Modify private DNS name](image%2023.png)

[Consumer] Modify private DNS name

åœ¨ **Modify private DNS name settings** section ä¸­ï¼Œå‹¾é¸ **Enable for this endpoint**

![[Consumer] Enable private DNS name for this endpoint](image%2024.png)

[Consumer] Enable private DNS name for this endpoint

Save ä¹‹å¾Œï¼Œæœƒè®Šæˆ **Pending** ç‹€æ…‹

ç›´åˆ°å®ƒè®Šæˆ **Available** å¾Œï¼Œæˆ‘å€‘å†æ¬¡ SSH é€£ç·šåˆ° Private Subnet çš„ EC2 Instance

`curl -4` ç¯„ä¾‹è¼¸å‡ºï¼š

```bash
$ curl -4 demoprivatelink.shiun.me

<h1>Hello World from ip-10-0-138-176.us-west-2.compute.internal</h1>
```

`curl -6` ç¯„ä¾‹è¼¸å‡ºï¼š

```bash
$ curl -6 demoprivatelink.shiun.me

<h1>Hello World from ip-10-0-138-176.us-west-2.compute.internal</h1>
```

æˆªåœ– Private Instance ä½¿ç”¨ `curl` æŒ‡ä»¤åˆ†åˆ¥ç”¨ IPv4 å’Œ IPv6 Client èª¿ç”¨ Private DNS name çš„åŸ·è¡Œçµæœï¼š

![[Consumer] The responses from curl -4 and curl -6 were observed in the consumer's private instance](4e1afe75-3cef-46b2-a2b8-7b6152f88d6e.png)

[Consumer] The responses from curl -4 and curl -6 were observed in the consumer's private instance

å¾ä¸Šé¢çš„çµæœå¯ä»¥çœ‹åˆ°ï¼Œæˆ‘å€‘æˆåŠŸä½¿ç”¨ Private DNS name ä¾†å­˜å– Service Provider çš„ NLB å›‰

é€™è£¡é‚„å¯ä»¥åšä¸€å€‹å°å¯¦é©—ï¼Œæˆ‘ç”¨è‡ªå·±çš„ç­†é›»æ‰“é–‹ Terminal (ä¸æ˜¯ AWS ä¸Š Consumer VPC è£¡é¢çš„ EC2 instance å”·)ï¼Œèª¿ç”¨ `curl` çœ‹çœ‹:

```bash
$ curl -4 demoprivatelink.shiun.me

curl: (6) Could not resolve host: demoprivatelink.shiun.me
```

```bash
$ curl -6 demoprivatelink.shiun.me

curl: (6) Could not resolve host: demoprivatelink.shiun.me
```

![My Macbook curl -4 and curl -6 responses](image%2025.png)

My Macbook curl -4 and curl -6 responses

æˆ‘ç”¨è‡ªå·±ç­†é›»åŸ·è¡Œçš„çµæœæ˜¯æƒ³å‘Šè¨´è®€è€…ï¼ŒPrivateLink å¾ˆå®‰å…¨åˆå¥½ç”¨ï¼æˆ‘å€‘åœ¨ AWS ç’°å¢ƒå¤–é¢æ˜¯çœŸçš„æ²’è¾¦æ³•èª¿ç”¨åˆ° Endpoint service å”·

---

## è£œå…… - é€é PrivateLink è¨ªå• NLBï¼Œé‚£ Service Provider çœ‹å¾—åˆ° Client åŸå§‹ IP åœ°å€å—ï¼Ÿ

é¦–å…ˆï¼Œ**èº«ç‚º Consumer** æ˜¯é€é VPC Interface Endpoint å»è¨ªå•åˆ° NLB çš„ï¼Œæˆ‘å·²ç¶“æ‰¾åˆ° VPC Interface Endpoint çš„ IP åœ°å€å¦‚ä¸‹:

- **IPv4:** `10.0.133.54`
- **IPv6:** `2600:1f14:3231:3002:d93:b5b3:d78c:2e0a`

![[Consumer] VPC Interface Endpoint IPv4 and IPv6 addresses](image%2026.png)

[Consumer] VPC Interface Endpoint IPv4 and IPv6 addresses

ç¾åœ¨æˆ‘å€‘å°±ä¾†æ‰“æµé‡çœ‹çœ‹å§

**åœ¨ Consumer é€™æ–¹**ï¼Œæˆ‘ç¸½å…±è¼¸å…¥äº†ä»¥ä¸‹æŒ‡ä»¤ï¼Œä¹Ÿå¾—åˆ°ç›¸æ‡‰çš„ Response:

```bash
[ec2-user@ip-10-0-137-213 ~]$ curl -4  vpce-0d3d9cfb73e4becfd-iiv45fgg.vpce-svc-0ceb593b3ba202634.us-west-2.vpce.amazonaws.com
<h1>Hello World from ip-10-0-138-176.us-west-2.compute.internal</h1>
[ec2-user@ip-10-0-137-213 ~]$ curl -6  vpce-0d3d9cfb73e4becfd-iiv45fgg.vpce-svc-0ceb593b3ba202634.us-west-2.vpce.amazonaws.com
<h1>Hello World from ip-10-0-138-176.us-west-2.compute.internal</h1>
[ec2-user@ip-10-0-137-213 ~]$ curl -4 demoprivatelink.shiun.me
<h1>Hello World from ip-10-0-138-176.us-west-2.compute.internal</h1>
[ec2-user@ip-10-0-137-213 ~]$ curl -6 demoprivatelink.shiun.me
<h1>Hello World from ip-10-0-138-176.us-west-2.compute.internal</h1>
```

**å›åˆ° Service Provider é‚£é‚Š**ï¼Œæˆ‘å·²ç¶“æœ‰å»æ‰¾åˆ° NLB ENIï¼Œå…¶ IPv6 åœ°å€ç‚º: `2600:1f14:2549:300:17c1:6c5d:ba29:ce1`

æˆ‘åœ¨ Provider é€™é‚Šï¼Œé€éè·³æ¿æ©Ÿ SSH é€£ç·šåˆ° NLB èƒŒå¾Œçš„ Target Instance ä¾†è§€å¯Ÿ Httpd access logs:

```bash
2600:1f14:2549:300:17c1:6c5d:ba29:ce1 - - [08/Jan/2025:04:31:12 +0000] "GET / HTTP/1.1" 200 69 "-" "curl/8.5.0"
2600:1f14:2549:300:17c1:6c5d:ba29:ce1 - - [08/Jan/2025:04:31:12 +0000] "GET / HTTP/1.0" 200 69 "-" "curl/7.88.1"
2600:1f14:2549:300:17c1:6c5d:ba29:ce1 - - [08/Jan/2025:04:31:13 +0000] "GET / HTTP/1.1" 200 69 "-" "curl/8.5.0"
2600:1f14:2549:300:7935:fbac:a7b4:84d5 - - [08/Jan/2025:04:31:16 +0000] "GET / HTTP/1.1" 200 69 "-" "ELB-HealthChecker/2.0"
2600:1f14:2549:300:17c1:6c5d:ba29:ce1 - - [08/Jan/2025:04:31:18 +0000] "GET / HTTP/1.1" 200 69 "-" "curl/8.5.0"
2600:1f14:2549:300:17c1:6c5d:ba29:ce1 - - [08/Jan/2025:04:31:24 +0000] "GET / HTTP/1.1" 200 69 "-" "curl/8.5.0"
```

**å¯ä»¥æ³¨æ„åˆ°ä¾†æºåœ°å€éƒ½æ˜¯ NLB çš„ IPv6 addressï¼**

**ä¹Ÿå°±æ˜¯èªªï¼ŒProvider çœ‹ä¸åˆ°çœŸå¯¦ä¾†æº IP åœ°å€ï¼**

é‚£æ€éº¼è¾¦ï¼Ÿæˆ‘å°±æ˜¯æœ‰ä¸€äº›éœ€æ±‚éœ€è¦çœ‹åˆ°çœŸå¯¦ä¾†æº IP åœ°å€â€¦ é‚£è«‹ç¹¼çºŒå¾€ä¸‹çœ‹ï¼Œæˆ‘å€‘æœƒéœ€è¦ Proxy Protocol çš„å¹«åŠ©

### é‚£å¦‚æœæˆ‘ç¾åœ¨é…ç½®äº† Proxy protocol å‘¢ï¼Ÿ

é—œæ–¼é…ç½® Httpd Proxy Protocol æ”¯æŒï¼Œé€™è£¡å…ˆçœç•¥ï¼Œä¸æ˜¯æœ¬æ–‡é‡é»ï¼Œç¸½ä¹‹æˆ‘å·²ç¶“é–‹å•Ÿ Proxy Protocol  æ”¯æŒäº†

æ–¼æ˜¯æˆ‘å†æ¬¡**å›åˆ° Consumer** çš„ EC2 Instance å° VPC Interface Endpoint ç™¼å‡ºè«‹æ±‚

```bash
[ec2-user@ip-10-0-137-213 ~]$ curl -4  vpce-0d3d9cfb73e4becfd-iiv45fgg.vpce-svc-0ceb593b3ba202634.us-west-2.vpce.amazonaws.com
<h1>Hello World from ip-10-0-138-176.us-west-2.compute.internal</h1>
[ec2-user@ip-10-0-137-213 ~]$ curl -6  vpce-0d3d9cfb73e4becfd-iiv45fgg.vpce-svc-0ceb593b3ba202634.us-west-2.vpce.amazonaws.com
<h1>Hello World from ip-10-0-138-176.us-west-2.compute.internal</h1>
[ec2-user@ip-10-0-137-213 ~]$ curl -4 demoprivatelink.shiun.me
<h1>Hello World from ip-10-0-138-176.us-west-2.compute.internal</h1>
[ec2-user@ip-10-0-137-213 ~]$ curl -6 demoprivatelink.shiun.me
<h1>Hello World from ip-10-0-138-176.us-west-2.compute.internal</h1>
```

**å›åˆ° Service Provider é‚£é‚Šï¼Œ**è§€å¯Ÿ NLB Target instance ä¸­çš„ Httpd access logs:

```bash
10.0.137.213 - - [08/Jan/2025:04:37:43 +0000] "GET / HTTP/1.1" 200 69 "-" "curl/8.5.0"
2600:1f14:3231:3002:5b88:e457:66c1:43ad - - [08/Jan/2025:04:37:46 +0000] "GET / HTTP/1.1" 200 69 "-" "curl/8.5.0"
10.0.137.213 - - [08/Jan/2025:04:37:50 +0000] "GET / HTTP/1.1" 200 69 "-" "curl/8.5.0"
2600:1f14:3231:3002:5b88:e457:66c1:43ad - - [08/Jan/2025:04:37:52 +0000] "GET / HTTP/1.1" 200 69 "-" "curl/8.5.0"
```

ä¸‹åœ–ç‚º Provider é‚£é‚Šçš„ NLB Target instance æˆªåœ–ç•«é¢ï¼š

![[Provider] The Httpd access log from the Target instance](image%2027.png)

[Provider] The Httpd access log from the Target instance

æ ¹æ“šä¸Šè¿°è§€å¯Ÿ

- `10.0.137.213` ç¢ºå¯¦æ˜¯ Consumer Private Instance çš„ Private IPv4 address
- `2600:1f14:3231:3002:5b88:e457:66c1:43ad` ä¹Ÿç¢ºå¯¦æ˜¯ Consumer Private Instance çš„ IPv6 address
- è«‹è¦‹ä¸‹åœ–ï¼Œé€™æ˜¯ Consumer é‚£é‚Šçš„ Private instanceï¼Œç´…æ¡†è™•å°±æ˜¯è©² Instance çš„ IP åœ°å€
    
    ![[Consumer] Here are the IPv4 and IPv6 addresses for the consumerâ€™s private instance.](image%2028.png)
    
    [Consumer] Here are the IPv4 and IPv6 addresses for the consumerâ€™s private instance.
    

**æ‰€ä»¥å¦‚æœæœ‰å•Ÿç”¨ Proxy Protocol çš„è©±ï¼Œæ˜¯å¯ä»¥çœ‹åˆ°åŸå§‹ä¾†æº IP çš„å–”ï¼ï¼**

---

## Troubleshooting - [Consumer] é…ç½® VPC Interface Endpoint çš„ SG

å¦‚æœä½ æ²’æ”¶åˆ°å›æ‡‰ï¼Œä½ å¯ä»¥æª¢æŸ¥ä¸€ä¸‹ VPC Interface Endpoint çš„ SG æ˜¯å¦é…ç½®æ­£ç¢ºï¼Œæˆ‘åªæœ‰é…ç½®ä¸€å€‹ Inbound rule å…è¨± EC2 SG çš„æµé‡æ‰“é€²ä¾†ï¼Œè‡³æ–¼ Outbound rule å°±ä¸éœ€è¦é…ç½®ï¼Œå› ç‚º SG æ˜¯ Stateful

![[Consumer] VPC Interface Endpoint Security Group inbound rules](image%2029.png)

[Consumer] VPC Interface Endpoint Security Group inbound rules

## Resources

[AWS PrivateLink Pricing â€“ AWS](https://aws.amazon.com/privatelink/pricing/)

[Manage DNS names for VPC endpoint services - Amazon Virtual Private Cloud](https://docs.aws.amazon.com/vpc/latest/privatelink/manage-dns-names.html)

[AWS PrivateLink ç¾åœ¨æ”¯æ´è·¨å€åŸŸé€£ç·šåŠŸèƒ½ - AWS](https://aws.amazon.com/tw/about-aws/whats-new/2024/11/aws-privatelink-across-region-connectivity/?utm_source=chatgpt.com)