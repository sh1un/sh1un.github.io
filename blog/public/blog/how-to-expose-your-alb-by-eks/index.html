<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta
  name="viewport"
  content="width=device-width, initial-scale=1, shrink-to-fit=no"
/>
<meta name="robots" content="index, follow" />
<title>
  How to Expose Your ALB by EKS | Shiun
</title>
<meta
  name="keywords"
  content="ALB, EKS, Kubernetes"
/> <meta name="description" content="如何使用 ALB 暴露你的 EKS"> <meta name="author" content=""> <link rel="canonical" href="https://shiun.me/blog/how-to-expose-your-alb-by-eks/">
<link
  crossorigin="anonymous"
  href="/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css"
  integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z&#43;V9&#43;cO1A="
  rel="preload stylesheet"
  as="style"
/> <link rel="icon" href="https://github.com/sh1un/sh1un.github.io/assets/85695943/12a1e84f-ed17-4e38-8165-f67783c7f047"> <link
rel="icon" type="image/png" sizes="16x16" href="https://shiun.me/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://shiun.me/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://shiun.me/apple-touch-icon.png"> <link rel="mask-icon" href="https://shiun.me/safari-pinned-tab.svg"> <meta name="theme-color" content="#2e2e33"> <meta name="msapplication-TileColor" content="#2e2e33"> <link rel="alternate" hreflang="en" href="https://shiun.me/blog/how-to-expose-your-alb-by-eks/" />


      <script async src="https://www.googletagmanager.com/gtag/js?id=G-RZR8D4ERKG"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-RZR8D4ERKG');
        }
      </script>


<meta property="og:url" content="https://shiun.me/blog/how-to-expose-your-alb-by-eks/">
  <meta property="og:site_name" content="Shiun">
  <meta property="og:title" content="How to Expose Your ALB by EKS">
  <meta property="og:description" content="如何使用 ALB 暴露你的 EKS">
  <meta property="og:locale" content="zh_tw">
  <meta property="og:type" content="article">
    <meta property="article:section" content="blog">
    <meta property="article:published_time" content="2025-05-19T20:09:29+08:00">
    <meta property="article:modified_time" content="2025-05-19T20:09:29+08:00">
    <meta property="article:tag" content="AWS">
    <meta property="article:tag" content="Kubernetes">
    <meta property="og:image" content="https://github.com/sh1un/sh1un.github.io/assets/85695943/42e903b9-06db-4cd8-b937-590a3cb26aea">




  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://github.com/sh1un/sh1un.github.io/assets/85695943/42e903b9-06db-4cd8-b937-590a3cb26aea">
  <meta name="twitter:title" content="How to Expose Your ALB by EKS">
  <meta name="twitter:description" content="如何使用 ALB 暴露你的 EKS">


<noscript>
  <style>
    #theme-toggle,
    .top-link {
      display: none;
    }
  </style>
  <style>
    @media (prefers-color-scheme: dark) {
      :root {
        --theme: rgb(29, 30, 32);
        --entry: rgb(46, 46, 51);
        --primary: rgb(218, 218, 219);
        --secondary: rgb(155, 156, 157);
        --tertiary: rgb(65, 66, 68);
        --content: rgb(196, 196, 197);
        --code-block-bg: rgb(46, 46, 51);
        --code-bg: rgb(55, 56, 62);
        --border: rgb(51, 51, 51);
      }

      .list {
        background: var(--theme);
      }

      .list:not(.dark)::-webkit-scrollbar-track {
        background: 0 0;
      }

      .list:not(.dark)::-webkit-scrollbar-thumb {
        border-color: var(--theme);
      }
    }
  </style>
</noscript>
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-RZR8D4ERKG"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-RZR8D4ERKG');
        }
      </script><meta property="og:title" content="How to Expose Your ALB by EKS" />
<meta property="og:description" content="如何使用 ALB 暴露你的 EKS" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://shiun.me/blog/how-to-expose-your-alb-by-eks/" /><meta property="og:image" content="https://github.com/sh1un/sh1un.github.io/assets/85695943/42e903b9-06db-4cd8-b937-590a3cb26aea"/><meta property="article:section" content="blog" />
<meta property="article:published_time" content="2025-05-19T20:09:29+08:00" />
<meta property="article:modified_time" content="2025-05-19T20:09:29+08:00" /><meta property="og:site_name" content="Shiun&#39;s Blog" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://github.com/sh1un/sh1un.github.io/assets/85695943/42e903b9-06db-4cd8-b937-590a3cb26aea"/>

<meta name="twitter:title" content="How to Expose Your ALB by EKS"/>
<meta name="twitter:description" content="如何使用 ALB 暴露你的 EKS"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Blogs",
      "item": "https://shiun.me/blog/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "How to Expose Your ALB by EKS",
      "item": "https://shiun.me/blog/how-to-expose-your-alb-by-eks/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "How to Expose Your ALB by EKS",
  "name": "How to Expose Your ALB by EKS",
  "description": "如何使用 ALB 暴露你的 EKS",
  "keywords": [
    "ALB", "EKS", "Kubernetes"
  ],
  "articleBody": "如何使用 ALB 暴露你的 EKS Tags: AWS ALB, AWS EKS, AWS ELB, Kubernetes Category: AWS, Kubernetes Created time: March 17, 2025 4:17 PM Last edited time: March 18, 2025 10:22 AM\naws-load-balancer-controller 1.11.0 · helm/aws\nRoute application and HTTP traffic with Application Load Balancers - Amazon EKS\nWhen you create a Kubernetes ingress, an AWS Application Load Balancer (ALB) is provisioned that load balances application traffic.\nQ\u0026A AWS Load Balancer Controller 會以什麼樣的形式存在在 K8s Cluster?\nClaude 3.7 Sonnet\nAWS Load Balancer Controller 在 Kubernetes (K8s) 叢集中是以 Deployment 的形式存在，具體來說它有以下特點：\n它作為一個 Deployment 資源部署在 K8s 叢集中 通常部署在 kube-system 或專門的命名空間（如 aws-load-balancer-controller） 以 Pod 的形式運行，Pod 內包含 AWS Load Balancer Controller 的容器 使用 ServiceAccount 與相應的 RBAC 權限來管理 K8s 資源 監聽特定的 K8s 資源（如 Ingress, Service）並自動在 AWS 中創建和配置相應的負載均衡器 AWS Load Balancer Controller 的主要功能是監聽 Kubernetes 中的變化，特別是 Ingress 和 Service 類型為 LoadBalancer 的資源，然後在 AWS 中自動創建和配置相應的 Application Load Balancer (ALB) 或 Network Load Balancer (NLB)，確保外部流量能夠正確路由到 K8s 叢集中的應用。\nalb.ingress.kubernetes.io/healthcheck-path: 老實說我不知道 Nginx 的健康檢查路徑\nClaude 3.7 Sonnet\n對於 Nginx，預設的健康檢查路徑可以简单设为 /，但这可能會導致每次健康檢查都載入完整頁面，這並不是最理想的方法。\n更好的做法是在你的 Nginx 配置中創建一個專門用於健康檢查的輕量級端點。例如，你可以在 Nginx 配置中添加：\nlocation /health { access_log off; return 200 \"healthy\\n\"; } 然後在 Ingress 中設置:\nalb.ingress.kubernetes.io/healthcheck-path: /health 這樣 AWS ALB 就會檢查這個輕量級路徑，而不會加重你的應用負擔。\n如果你使用的是標準的 Nginx 映像而沒有自定義配置，那麼使用 / 路徑應該可以工作，但效率不是最佳。ALB 健康檢查會向這個路徑發送請求，如果收到 2xx 或 3xx 響應碼，就會認為服務是健康的。\n注意：如果你的 Nginx 設置了複雜的路由或認證，確保健康檢查路徑是可以無認證訪問的，否則健康檢查會失敗。\n我很好奇，我在 ingress 那邊呀根本沒指定什麼 region，那 kubectl apply -f ingress.yaml 後，k8s 怎那麼聰明知道要建立 ALB 在哪個 AWS Region?\nClaude 3.7 Sonnt 這是個很好的問題！Kubernetes 本身並不知道要在哪個 AWS 區域建立 ALB，這個邏輯是由 AWS Load Balancer Controller 處理的。這裡是它如何工作的：\n當你部署 AWS Load Balancer Controller 到你的 Kubernetes 叢集時，你需要為它提供 AWS 憑證和配置。Controller 會在啟動時確定它需要操作的 AWS 區域，通常是通過以下幾種方式之一：\n從 EC2 實例元數據獲取：如果你的 Kubernetes 叢集運行在 EKS 或自管理的 EC2 實例上，Controller 會使用 EC2 實例元數據服務來確定當前的 AWS 區域。 從環境變數獲取：部署 Controller 時可能設置了 AWS_REGION 或 AWS_DEFAULT_REGION 環境變數。 從 AWS SDK 配置獲取：Controller 使用 AWS SDK，可能會從 ~/.aws/config 或其他 AWS 配置來源獲取區域信息。 從 Controller 的部署配置獲取：在 Helm chart 或 YAML 部署文件中，可能會明確設置 AWS 區域。 基本原則是：AWS Load Balancer Controller 會在部署和配置時已經知道它應該操作哪個 AWS 區域，這樣當你應用 Ingress 資源時，它就已經知道應該在哪個區域創建 ALB。\n這正是 Kubernetes 運營商模式（Operator Pattern）的魅力所在 - 你只需要聲明你想要什麼（在這個例子中是一個 Ingress 資源），而專門的 Controller 會處理如何在特定的雲環境中實現它的所有細節。\nChatGPT 4o 在 Kubernetes (k8s) 的 Ingress 設定中，你的 ingress.yaml 並不會直接指定 AWS Region，但 Kubernetes 之所以知道該在哪個 AWS Region 建立 ALB (Application Load Balancer)，是因為 你的 EKS Cluster (或 Kubernetes cluster) 是建立在某個 AWS Region 上的。\n為什麼 Kubernetes 知道要在哪個 AWS Region 建立 ALB？ EKS Cluster 已經綁定 AWS Region 當你建立 EKS (Amazon Elastic Kubernetes Service) Cluster 時，你已經指定了 AWS Region。例如：\naws eks create-cluster --region us-west-2 --name my-cluster ... 這個 EKS Cluster 內的所有 AWS 相關資源 (像是 Load Balancer, EBS, IAM Policies) 都會在這個 Region 內建立。\nKubernetes 透過 AWS Load Balancer Controller 自動查詢 Region 當你在 kubectl apply -f ingress.yaml 時，EKS 內部的 AWS Load Balancer Controller 會自動解析該 Ingress 資訊，然後： 查詢該 EKS Cluster 所在的 AWS Region 在該 Region 自動建立對應的 ALB 你可以透過 kubectl get deployment -n kube-system aws-load-balancer-controller 確認 AWS Load Balancer Controller 是否有運行。 透過 EKS Cluster 的 IAM Role 來存取 AWS 資源 EKS Cluster 會使用指定的 IAM Role，這個 Role 的權限通常允許它管理 ELB/ALB。 當 Ingress Controller 偵測到新的 Ingress 資源時，它會使用這個 IAM Role 來呼叫 AWS API，在 EKS Cluster 所在的 Region 建立 ALB。 你可以在哪裡看到 Region 設定？ 如果你想確認你的 Kubernetes Cluster 是在哪個 AWS Region，可以：\naws eks describe-cluster --name my-cluster --query \"cluster.resourcesVpcConfig.clusterSecurityGroupId\" --region us-west-2 或直接查詢 Cluster 的 Region：\nkubectl get nodes -o wide 你會看到 Node (EC2) 是在哪個 AWS 可用區 (AZ)，也可以推斷出 Region。\n結論 當你 kubectl apply -f ingress.yaml，Kubernetes 之所以知道 ALB 要建在哪個 Region，是因為：\nEKS Cluster 本身已經是 Region-Specific，所有 AWS 資源都會在這個 Region 內建立。 AWS Load Balancer Controller 會自動偵測 EKS Cluster 的 Region，並在相應的 Region 內建立 ALB。 EKS Cluster 的 IAM Role 已經有權限存取該 Region 內的 AWS 資源，讓 Controller 可以透過 AWS API 建立 ALB。 你不需要手動指定 Region，因為 EKS Cluster 本身已經決定了一切 🚀\n前情提要 剛經歷了一波苦海 踩坑紀錄 - 更新了 resources request，無法調度 pod Karpenter 和 Pod 要怎麼設置，才可以讓 WorkerNode 開在不同 AZ，Pod 配在不同 Node\n接下來我要用 ALB 暴露我的應用啦\n其實之前在做 [Workshop] Amazon EKS Workshop - Fundamental 有做到一點點，大概有個基本概念了，但是我希望我自己能夠去理解透徹這邊的原理深入一點\n安裝 AWS Load Banlancer Controller 到集群 取自 Helm TL;DR:\nhelm repo add eks https://aws.github.io/eks-charts # If using IAM Roles for service account install as follows - NOTE: you need to specify both of the chart values `serviceAccount.create=false` and `serviceAccount.name=aws-load-balancer-controller` helm install aws-load-balancer-controller eks/aws-load-balancer-controller --set clusterName=my-cluster -n kube-system --set serviceAccount.create=false --set serviceAccount.name=aws-load-balancer-controller # If not using IAM Roles for service account helm install aws-load-balancer-controller eks/aws-load-balancer-controller --set clusterName=my-cluster -n kube-system 我是沒安裝啦，因為我目前所在 Cluster 已經有前人安裝過了：\n$ kubectl get deploy -n kube-system | grep aws-load aws-load-balancer-controller 2/2 2 2 2y152d 建立 Ingress 這邊我會需要先拿到 Nginx 的 Service name\n$ kubectl get svc NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE shiun-nginx ClusterIP 172.20.235.205 80/TCP,443/TCP 3d2h 然後來撰寫 ingress.yaml\napiVersion: networking.k8s.io/v1 kind: Ingress metadata: name: shiun-onboarding-alb namespace: shiun-onboarding annotations: alb.ingress.kubernetes.io/scheme: internet-facing alb.ingress.kubernetes.io/target-type: ip alb.ingress.kubernetes.io/healthcheck-path: / spec: ingressClassName: alb rules: - http: paths: - path: / pathType: Prefix backend: service: name: shiun-nginx port: number: 80 kubectl apply -f ingress.yaml 接著上去看 ALB Console，就會看到他正在創建了：\n然後拿到 ALB 的 DNS Name，看到畫面！！\n",
  "wordCount" : "719",
  "inLanguage": "en",
  "datePublished": "2025-05-19T20:09:29+08:00",
  "dateModified": "2025-05-19T20:09:29+08:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://shiun.me/blog/how-to-expose-your-alb-by-eks/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Shiun",
    "logo": {
      "@type": "ImageObject",
      "url": "https://github.com/sh1un/sh1un.github.io/assets/85695943/12a1e84f-ed17-4e38-8165-f67783c7f047"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://shiun.me/" accesskey="h" title="Shiun (Alt + H)">Shiun</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                <ul class="lang-switch"><li>|</li>
                </ul>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://shiun.me/blog/" title="Blog">
                    <span>Blog</span>
                </a>
            </li>
            <li>
                <a href="https://shiun.me/archives/" title="Archives">
                    <span>Archives</span>
                </a>
            </li>
            <li>
                <a href="https://shiun.me/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="https://shiun.me/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="https://shiun.notion.site/Shiun-s-Learning-Journal-ded4cd4a3efd47b2805f2f99dee8f9a1?pvs=4" title="Notion">
                    <span>Notion</span>&nbsp;
                    <svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12">
                        <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"></path>
                        <path d="M15 3h6v6"></path>
                        <path d="M10 14L21 3"></path>
                    </svg>
                </a>
            </li>
            <li>
                <a href="https://www.linkedin.com/in/shiunchiu" title="About me">
                    <span>About me</span>&nbsp;
                    <svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12">
                        <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"></path>
                        <path d="M15 3h6v6"></path>
                        <path d="M10 14L21 3"></path>
                    </svg>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://shiun.me/">Home</a>&nbsp;»&nbsp;<a href="https://shiun.me/blog/">Blogs</a></div>
    <h1 class="post-title entry-hint-parent">
      How to Expose Your ALB by EKS
    </h1>
    <div class="post-description">
      如何使用 ALB 暴露你的 EKS
    </div>
    <div class="post-meta"><span title='2025-05-19 20:09:29 +0800 CST'>May 19, 2025</span>&nbsp;·&nbsp;4 min

</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e5%a6%82%e4%bd%95%e4%bd%bf%e7%94%a8-alb-%e6%9a%b4%e9%9c%b2%e4%bd%a0%e7%9a%84-eks" aria-label="如何使用 ALB 暴露你的 EKS">如何使用 ALB 暴露你的 EKS</a><ul>
                        
                <li>
                    <a href="#qa" aria-label="Q&amp;A">Q&amp;A</a></li></ul>
                </li>
                <li>
                    <a href="#claude-37-sonnt" aria-label="Claude 3.7 Sonnt">Claude 3.7 Sonnt</a></li>
                <li>
                    <a href="#chatgpt-4o" aria-label="ChatGPT 4o">ChatGPT 4o</a><ul>
                        <ul>
                        
                <li>
                    <a href="#%e7%82%ba%e4%bb%80%e9%ba%bc-kubernetes-%e7%9f%a5%e9%81%93%e8%a6%81%e5%9c%a8%e5%93%aa%e5%80%8b-aws-region-%e5%bb%ba%e7%ab%8b-alb" aria-label="為什麼 Kubernetes 知道要在哪個 AWS Region 建立 ALB？">為什麼 Kubernetes 知道要在哪個 AWS Region 建立 ALB？</a></li>
                <li>
                    <a href="#%e4%bd%a0%e5%8f%af%e4%bb%a5%e5%9c%a8%e5%93%aa%e8%a3%a1%e7%9c%8b%e5%88%b0-region-%e8%a8%ad%e5%ae%9a" aria-label="你可以在哪裡看到 Region 設定？">你可以在哪裡看到 Region 設定？</a></li>
                <li>
                    <a href="#%e7%b5%90%e8%ab%96" aria-label="結論">結論</a></li></ul>
                    
                <li>
                    <a href="#%e5%89%8d%e6%83%85%e6%8f%90%e8%a6%81" aria-label="前情提要">前情提要</a></li>
                <li>
                    <a href="#%e5%ae%89%e8%a3%9d-aws-load-banlancer-controller-%e5%88%b0%e9%9b%86%e7%be%a4" aria-label="安裝 AWS Load Banlancer Controller 到集群">安裝 AWS Load Banlancer Controller 到集群</a></li>
                <li>
                    <a href="#%e5%bb%ba%e7%ab%8b-ingress" aria-label="建立 Ingress">建立 Ingress</a>
                </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h1 id="如何使用-alb-暴露你的-eks">如何使用 ALB 暴露你的 EKS<a hidden class="anchor" aria-hidden="true" href="#如何使用-alb-暴露你的-eks">#</a></h1>
<p>Tags: AWS ALB, AWS EKS, AWS ELB, Kubernetes
Category: AWS, Kubernetes
Created time: March 17, 2025 4:17 PM
Last edited time: March 18, 2025 10:22 AM</p>
<p><a href="https://artifacthub.io/packages/helm/aws/aws-load-balancer-controller">aws-load-balancer-controller 1.11.0 · helm/aws</a></p>
<p><a href="https://docs.aws.amazon.com/eks/latest/userguide/alb-ingress.html">Route application and HTTP traffic with Application Load Balancers - Amazon EKS</a></p>
<blockquote>
<p>When you create a Kubernetes <code>ingress</code>, an AWS Application Load Balancer (ALB) is provisioned that load balances application traffic.</p>
</blockquote>
<h2 id="qa">Q&amp;A<a hidden class="anchor" aria-hidden="true" href="#qa">#</a></h2>
<ul>
<li>
<p>AWS Load Balancer Controller 會以什麼樣的形式存在在 K8s Cluster?</p>
<p>Claude 3.7 Sonnet</p>
<p>AWS Load Balancer Controller 在 Kubernetes (K8s) 叢集中是以 Deployment 的形式存在，具體來說它有以下特點：</p>
<ol>
<li>它作為一個 Deployment 資源部署在 K8s 叢集中</li>
<li>通常部署在 kube-system 或專門的命名空間（如 aws-load-balancer-controller）</li>
<li>以 Pod 的形式運行，Pod 內包含 AWS Load Balancer Controller 的容器</li>
<li>使用 ServiceAccount 與相應的 RBAC 權限來管理 K8s 資源</li>
<li>監聽特定的 K8s 資源（如 Ingress, Service）並自動在 AWS 中創建和配置相應的負載均衡器</li>
</ol>
<p>AWS Load Balancer Controller 的主要功能是監聽 Kubernetes 中的變化，特別是 Ingress 和 Service 類型為 LoadBalancer 的資源，然後在 AWS 中自動創建和配置相應的 Application Load Balancer (ALB) 或 Network Load Balancer (NLB)，確保外部流量能夠正確路由到 K8s 叢集中的應用。</p>
</li>
<li>
<p><a href="http://alb.ingress.kubernetes.io/healthcheck-path:">alb.ingress.kubernetes.io/healthcheck-path:</a> 老實說我不知道 Nginx 的健康檢查路徑</p>
<p>Claude 3.7 Sonnet</p>
<p>對於 Nginx，預設的健康檢查路徑可以简单设为 <code>/</code>，但这可能會導致每次健康檢查都載入完整頁面，這並不是最理想的方法。</p>
<p>更好的做法是在你的 Nginx 配置中創建一個專門用於健康檢查的輕量級端點。例如，你可以在 Nginx 配置中添加：</p>
<pre tabindex="0"><code>location /health {
    access_log off;
    return 200 &#34;healthy\n&#34;;
}
</code></pre><p>然後在 Ingress 中設置:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">alb.ingress.kubernetes.io/healthcheck-path</span>: <span style="color:#ae81ff">/health</span>
</span></span></code></pre></div><p>這樣 AWS ALB 就會檢查這個輕量級路徑，而不會加重你的應用負擔。</p>
<p>如果你使用的是標準的 Nginx 映像而沒有自定義配置，那麼使用 <code>/</code> 路徑應該可以工作，但效率不是最佳。ALB 健康檢查會向這個路徑發送請求，如果收到 2xx 或 3xx 響應碼，就會認為服務是健康的。</p>
<p>注意：如果你的 Nginx 設置了複雜的路由或認證，確保健康檢查路徑是可以無認證訪問的，否則健康檢查會失敗。</p>
</li>
<li>
<p>我很好奇，我在 ingress 那邊呀根本沒指定什麼 region，那 kubectl apply -f ingress.yaml 後，k8s 怎那麼聰明知道要建立 ALB 在哪個 AWS Region?</p>
<h1 id="claude-37-sonnt">Claude 3.7 Sonnt<a hidden class="anchor" aria-hidden="true" href="#claude-37-sonnt">#</a></h1>
<p>這是個很好的問題！Kubernetes 本身並不知道要在哪個 AWS 區域建立 ALB，這個邏輯是由 AWS Load Balancer Controller 處理的。這裡是它如何工作的：</p>
<p>當你部署 AWS Load Balancer Controller 到你的 Kubernetes 叢集時，你需要為它提供 AWS 憑證和配置。Controller 會在啟動時確定它需要操作的 AWS 區域，通常是通過以下幾種方式之一：</p>
<ol>
<li><strong>從 EC2 實例元數據獲取</strong>：如果你的 Kubernetes 叢集運行在 EKS 或自管理的 EC2 實例上，Controller 會使用 EC2 實例元數據服務來確定當前的 AWS 區域。</li>
<li><strong>從環境變數獲取</strong>：部署 Controller 時可能設置了 <code>AWS_REGION</code> 或 <code>AWS_DEFAULT_REGION</code> 環境變數。</li>
<li><strong>從 AWS SDK 配置獲取</strong>：Controller 使用 AWS SDK，可能會從 <code>~/.aws/config</code> 或其他 AWS 配置來源獲取區域信息。</li>
<li><strong>從 Controller 的部署配置獲取</strong>：在 Helm chart 或 YAML 部署文件中，可能會明確設置 AWS 區域。</li>
</ol>
<p>基本原則是：AWS Load Balancer Controller 會在部署和配置時已經知道它應該操作哪個 AWS 區域，這樣當你應用 Ingress 資源時，它就已經知道應該在哪個區域創建 ALB。</p>
<p>這正是 Kubernetes 運營商模式（Operator Pattern）的魅力所在 - 你只需要聲明你想要什麼（在這個例子中是一個 Ingress 資源），而專門的 Controller 會處理如何在特定的雲環境中實現它的所有細節。</p>
<h1 id="chatgpt-4o">ChatGPT 4o<a hidden class="anchor" aria-hidden="true" href="#chatgpt-4o">#</a></h1>
<p>在 Kubernetes (k8s) 的 Ingress 設定中，你的 <code>ingress.yaml</code> 並不會直接指定 AWS Region，但 Kubernetes 之所以知道該在哪個 AWS Region 建立 ALB (Application Load Balancer)，是因為 <strong>你的 EKS Cluster (或 Kubernetes cluster) 是建立在某個 AWS Region 上的</strong>。</p>
<h3 id="為什麼-kubernetes-知道要在哪個-aws-region-建立-alb">為什麼 Kubernetes 知道要在哪個 AWS Region 建立 ALB？<a hidden class="anchor" aria-hidden="true" href="#為什麼-kubernetes-知道要在哪個-aws-region-建立-alb">#</a></h3>
<ol>
<li><strong>EKS Cluster 已經綁定 AWS Region</strong>
<ul>
<li>
<p>當你建立 EKS (Amazon Elastic Kubernetes Service) Cluster 時，你已經指定了 AWS Region。例如：</p>
<pre tabindex="0"><code>aws eks create-cluster --region us-west-2 --name my-cluster ...
</code></pre></li>
<li>
<p>這個 EKS Cluster 內的所有 AWS 相關資源 (像是 Load Balancer, EBS, IAM Policies) 都會在這個 Region 內建立。</p>
</li>
</ul>
</li>
<li><strong>Kubernetes 透過 AWS Load Balancer Controller 自動查詢 Region</strong>
<ul>
<li>當你在 <code>kubectl apply -f ingress.yaml</code> 時，EKS 內部的 <strong>AWS Load Balancer Controller</strong> 會自動解析該 Ingress 資訊，然後：
<ol>
<li>查詢該 EKS Cluster 所在的 AWS Region</li>
<li>在該 Region 自動建立對應的 ALB</li>
</ol>
</li>
<li>你可以透過 <code>kubectl get deployment -n kube-system aws-load-balancer-controller</code> 確認 AWS Load Balancer Controller 是否有運行。</li>
</ul>
</li>
<li><strong>透過 EKS Cluster 的 IAM Role 來存取 AWS 資源</strong>
<ul>
<li>EKS Cluster 會使用指定的 IAM Role，這個 Role 的權限通常允許它管理 ELB/ALB。</li>
<li>當 Ingress Controller 偵測到新的 Ingress 資源時，它會使用這個 IAM Role 來呼叫 AWS API，在 EKS Cluster 所在的 Region 建立 ALB。</li>
</ul>
</li>
</ol>
<h3 id="你可以在哪裡看到-region-設定">你可以在哪裡看到 Region 設定？<a hidden class="anchor" aria-hidden="true" href="#你可以在哪裡看到-region-設定">#</a></h3>
<p>如果你想確認你的 Kubernetes Cluster 是在哪個 AWS Region，可以：</p>
<pre tabindex="0"><code>aws eks describe-cluster --name my-cluster --query &#34;cluster.resourcesVpcConfig.clusterSecurityGroupId&#34; --region us-west-2
</code></pre><p>或直接查詢 Cluster 的 Region：</p>
<pre tabindex="0"><code>kubectl get nodes -o wide
</code></pre><p>你會看到 Node (EC2) 是在哪個 AWS 可用區 (AZ)，也可以推斷出 Region。</p>
<hr>
<h3 id="結論">結論<a hidden class="anchor" aria-hidden="true" href="#結論">#</a></h3>
<p>當你 <code>kubectl apply -f ingress.yaml</code>，Kubernetes 之所以知道 ALB 要建在哪個 Region，是因為：</p>
<ol>
<li><strong>EKS Cluster 本身已經是 Region-Specific</strong>，所有 AWS 資源都會在這個 Region 內建立。</li>
<li><strong>AWS Load Balancer Controller 會自動偵測 EKS Cluster 的 Region，並在相應的 Region 內建立 ALB。</strong></li>
<li><strong>EKS Cluster 的 IAM Role 已經有權限存取該 Region 內的 AWS 資源，讓 Controller 可以透過 AWS API 建立 ALB。</strong></li>
</ol>
<p>你不需要手動指定 Region，因為 EKS Cluster 本身已經決定了一切 🚀</p>
</li>
</ul>
<h2 id="前情提要">前情提要<a hidden class="anchor" aria-hidden="true" href="#前情提要">#</a></h2>
<p>剛經歷了一波苦海 <a href="https://www.notion.so/resources-request-pod-1b9ea7e0d9d08068aec7df5f90a14fbf?pvs=21">踩坑紀錄 - 更新了 resources request，無法調度 pod</a> <a href="https://www.notion.so/Karpenter-Pod-WorkerNode-AZ-Pod-Node-1b9ea7e0d9d080fdb166c32a09044301?pvs=21">Karpenter 和 Pod 要怎麼設置，才可以讓 WorkerNode 開在不同 AZ，Pod 配在不同 Node</a></p>
<p>接下來我要用 ALB 暴露我的應用啦</p>
<p>其實之前在做 <a href="https://www.notion.so/Workshop-Amazon-EKS-Workshop-Fundamental-1a1ea7e0d9d0805582acccbd4e3430c6?pvs=21">[Workshop] <strong>Amazon EKS Workshop - Fundamental</strong></a> 有做到一點點，大概有個基本概念了，但是我希望我自己能夠去理解透徹這邊的原理深入一點</p>
<h2 id="安裝-aws-load-banlancer-controller-到集群">安裝 AWS Load Banlancer Controller 到集群<a hidden class="anchor" aria-hidden="true" href="#安裝-aws-load-banlancer-controller-到集群">#</a></h2>
<p>取自 Helm TL;DR:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>helm repo add eks https://aws.github.io/eks-charts
</span></span><span style="display:flex;"><span><span style="color:#75715e"># If using IAM Roles for service account install as follows -  NOTE: you need to specify both of the chart values `serviceAccount.create=false` and `serviceAccount.name=aws-load-balancer-controller`</span>
</span></span><span style="display:flex;"><span>helm install aws-load-balancer-controller eks/aws-load-balancer-controller --set clusterName<span style="color:#f92672">=</span>my-cluster -n kube-system --set serviceAccount.create<span style="color:#f92672">=</span>false --set serviceAccount.name<span style="color:#f92672">=</span>aws-load-balancer-controller
</span></span><span style="display:flex;"><span><span style="color:#75715e"># If not using IAM Roles for service account</span>
</span></span><span style="display:flex;"><span>helm install aws-load-balancer-controller eks/aws-load-balancer-controller --set clusterName<span style="color:#f92672">=</span>my-cluster -n kube-system
</span></span></code></pre></div><p>我是沒安裝啦，因為我目前所在 Cluster 已經有前人安裝過了：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ kubectl get deploy -n kube-system | grep aws-load
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>aws-load-balancer-controller             2/2     <span style="color:#ae81ff">2</span>            <span style="color:#ae81ff">2</span>           2y152d
</span></span></code></pre></div><h2 id="建立-ingress">建立 Ingress<a hidden class="anchor" aria-hidden="true" href="#建立-ingress">#</a></h2>
<p>這邊我會需要先拿到 Nginx 的 Service name</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ kubectl get svc
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>NAME          TYPE        CLUSTER-IP       EXTERNAL-IP   PORT<span style="color:#f92672">(</span>S<span style="color:#f92672">)</span>          AGE
</span></span><span style="display:flex;"><span>shiun-nginx   ClusterIP   172.20.235.205   &lt;none&gt;        80/TCP,443/TCP   3d2h
</span></span></code></pre></div><p>然後來撰寫 <code>ingress.yaml</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">networking.k8s.io/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Ingress</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">shiun-onboarding-alb</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">shiun-onboarding</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">annotations</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">alb.ingress.kubernetes.io/scheme</span>: <span style="color:#ae81ff">internet-facing</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">alb.ingress.kubernetes.io/target-type</span>: <span style="color:#ae81ff">ip</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">alb.ingress.kubernetes.io/healthcheck-path</span>: <span style="color:#ae81ff">/</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">ingressClassName</span>: <span style="color:#ae81ff">alb</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">rules</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">http</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">paths</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">pathType</span>: <span style="color:#ae81ff">Prefix</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">backend</span>:
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">service</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">name</span>: <span style="color:#ae81ff">shiun-nginx</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">port</span>:
</span></span><span style="display:flex;"><span>                  <span style="color:#f92672">number</span>: <span style="color:#ae81ff">80</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl apply -f ingress.yaml
</span></span></code></pre></div><p>接著上去看 ALB Console，就會看到他正在創建了：</p>
<p><img loading="lazy" src="image.png" alt="image.png"  />
</p>
<p>然後拿到 ALB 的 DNS Name，看到畫面！！</p>
<p><img loading="lazy" src="image%201.png" alt="image.png"  />
</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://shiun.me/tags/aws/">AWS</a></li>
      <li><a href="https://shiun.me/tags/kubernetes/">Kubernetes</a></li>
    </ul>
<nav class="paginav">
  <a class="next" href="https://shiun.me/blog/what-is-the-purpose-of-last-applied-configuration-in-kubectl-apply/">
    <span class="title">Next »</span>
    <br>
    <span>Kubernetes 常見問題：kubectl apply 的 Last applied configuration 用途是什麼？</span>
  </a>
</nav>


<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share How to Expose Your ALB by EKS on x"
            href="https://x.com/intent/tweet/?text=How%20to%20Expose%20Your%20ALB%20by%20EKS&amp;url=https%3a%2f%2fshiun.me%2fblog%2fhow-to-expose-your-alb-by-eks%2f&amp;hashtags=AWS%2cKubernetes">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share How to Expose Your ALB by EKS on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fshiun.me%2fblog%2fhow-to-expose-your-alb-by-eks%2f&amp;title=How%20to%20Expose%20Your%20ALB%20by%20EKS&amp;summary=How%20to%20Expose%20Your%20ALB%20by%20EKS&amp;source=https%3a%2f%2fshiun.me%2fblog%2fhow-to-expose-your-alb-by-eks%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share How to Expose Your ALB by EKS on facebook"
            href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fshiun.me%2fblog%2fhow-to-expose-your-alb-by-eks%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share How to Expose Your ALB by EKS on telegram"
            href="https://telegram.me/share/url?text=How%20to%20Expose%20Your%20ALB%20by%20EKS&amp;url=https%3a%2f%2fshiun.me%2fblog%2fhow-to-expose-your-alb-by-eks%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
</ul>

  </footer><div class="disqus markdown"><div id="disqus_thread"></div>
<script>
  

  

  (function () {
    
    var d = document,
      s = d.createElement("script");
    s.src = "https://shiun-me.disqus.com/embed.js";
    s.setAttribute("data-timestamp", +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>
<noscript
  >Please enable JavaScript to view the
  <a href="https://disqus.com/?ref_noscript"
    >comments powered by Disqus.</a
  ></noscript
>
</div>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2025 <a href="https://shiun.me/">Shiun</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
