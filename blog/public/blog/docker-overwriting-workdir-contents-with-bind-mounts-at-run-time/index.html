<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta
  name="viewport"
  content="width=device-width, initial-scale=1, shrink-to-fit=no"
/>
<meta name="robots" content="index, follow" />
<title>
  Docker 踩坑紀錄 - 運行階段 Bind Mount 覆蓋 WORKDIR 的內容 | Shiun
</title>
<meta
  name="keywords"
  content="Docker, Docker Volume, Bind Mount, Docker Compose"
/> <meta name="description" content="目前經手的專案會需要針對不同環境或是測試 Build 不同的 Image，之前在本地 Debug 程式時，docker-compose 使用到 Bind Mount，導致運行階段 Host 目錄下的內容直接覆蓋 WORKDIR 的內容，引發指定檔案找不到的錯誤"> <meta name="author" content=""> <link rel="canonical" href="https://shiun.me/blog/docker-overwriting-workdir-contents-with-bind-mounts-at-run-time/">
<link
  crossorigin="anonymous"
  href="/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css"
  integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z&#43;V9&#43;cO1A="
  rel="preload stylesheet"
  as="style"
/> <link rel="icon" href="https://github.com/sh1un/sh1un.github.io/assets/85695943/12a1e84f-ed17-4e38-8165-f67783c7f047"> <link
rel="icon" type="image/png" sizes="16x16" href="https://shiun.me/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://shiun.me/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://shiun.me/apple-touch-icon.png"> <link rel="mask-icon" href="https://shiun.me/safari-pinned-tab.svg"> <meta name="theme-color" content="#2e2e33"> <meta name="msapplication-TileColor" content="#2e2e33"> <link rel="alternate" hreflang="en" href="https://shiun.me/blog/docker-overwriting-workdir-contents-with-bind-mounts-at-run-time/" />


<script async src="https://www.googletagmanager.com/gtag/js?id=G-RZR8D4ERKG"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-RZR8D4ERKG', { 'anonymize_ip': false });
}
</script>



<meta property="og:title" content="Docker 踩坑紀錄 - 運行階段 Bind Mount 覆蓋 WORKDIR 的內容" />
<meta property="og:description" content="目前經手的專案會需要針對不同環境或是測試 Build 不同的 Image，之前在本地 Debug 程式時，docker-compose 使用到 Bind Mount，導致運行階段 Host 目錄下的內容直接覆蓋 WORKDIR 的內容，引發指定檔案找不到的錯誤" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://shiun.me/blog/docker-overwriting-workdir-contents-with-bind-mounts-at-run-time/" /><meta property="og:image" content="https://github.com/sh1un/sh1un.github.io/assets/85695943/42e903b9-06db-4cd8-b937-590a3cb26aea" /><meta property="article:section" content="blog" />
<meta property="article:published_time" content="2024-01-28T22:07:38+08:00" />
<meta property="article:modified_time" content="2024-01-28T22:07:38+08:00" /><meta property="og:site_name" content="Shiun&#39;s Blog" />



<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://github.com/sh1un/sh1un.github.io/assets/85695943/42e903b9-06db-4cd8-b937-590a3cb26aea" /><meta name="twitter:title" content="Docker 踩坑紀錄 - 運行階段 Bind Mount 覆蓋 WORKDIR 的內容"/>
<meta name="twitter:description" content="目前經手的專案會需要針對不同環境或是測試 Build 不同的 Image，之前在本地 Debug 程式時，docker-compose 使用到 Bind Mount，導致運行階段 Host 目錄下的內容直接覆蓋 WORKDIR 的內容，引發指定檔案找不到的錯誤"/>


<noscript>
  <style>
    #theme-toggle,
    .top-link {
      display: none;
    }
  </style>
  <style>
    @media (prefers-color-scheme: dark) {
      :root {
        --theme: rgb(29, 30, 32);
        --entry: rgb(46, 46, 51);
        --primary: rgb(218, 218, 219);
        --secondary: rgb(155, 156, 157);
        --tertiary: rgb(65, 66, 68);
        --content: rgb(196, 196, 197);
        --code-block-bg: rgb(46, 46, 51);
        --code-bg: rgb(55, 56, 62);
        --border: rgb(51, 51, 51);
      }

      .list {
        background: var(--theme);
      }

      .list:not(.dark)::-webkit-scrollbar-track {
        background: 0 0;
      }

      .list:not(.dark)::-webkit-scrollbar-thumb {
        border-color: var(--theme);
      }
    }
  </style>
</noscript>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-RZR8D4ERKG"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-RZR8D4ERKG', { 'anonymize_ip': false });
}
</script>
<meta property="og:title" content="Docker 踩坑紀錄 - 運行階段 Bind Mount 覆蓋 WORKDIR 的內容" />
<meta property="og:description" content="目前經手的專案會需要針對不同環境或是測試 Build 不同的 Image，之前在本地 Debug 程式時，docker-compose 使用到 Bind Mount，導致運行階段 Host 目錄下的內容直接覆蓋 WORKDIR 的內容，引發指定檔案找不到的錯誤" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://shiun.me/blog/docker-overwriting-workdir-contents-with-bind-mounts-at-run-time/" /><meta property="og:image" content="https://github.com/sh1un/sh1un.github.io/assets/85695943/42e903b9-06db-4cd8-b937-590a3cb26aea"/><meta property="article:section" content="blog" />
<meta property="article:published_time" content="2024-01-28T22:07:38+08:00" />
<meta property="article:modified_time" content="2024-01-28T22:07:38+08:00" /><meta property="og:site_name" content="Shiun&#39;s Blog" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://github.com/sh1un/sh1un.github.io/assets/85695943/42e903b9-06db-4cd8-b937-590a3cb26aea"/>

<meta name="twitter:title" content="Docker 踩坑紀錄 - 運行階段 Bind Mount 覆蓋 WORKDIR 的內容"/>
<meta name="twitter:description" content="目前經手的專案會需要針對不同環境或是測試 Build 不同的 Image，之前在本地 Debug 程式時，docker-compose 使用到 Bind Mount，導致運行階段 Host 目錄下的內容直接覆蓋 WORKDIR 的內容，引發指定檔案找不到的錯誤"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Blogs",
      "item": "https://shiun.me/blog/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Docker 踩坑紀錄 - 運行階段 Bind Mount 覆蓋 WORKDIR 的內容",
      "item": "https://shiun.me/blog/docker-overwriting-workdir-contents-with-bind-mounts-at-run-time/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Docker 踩坑紀錄 - 運行階段 Bind Mount 覆蓋 WORKDIR 的內容",
  "name": "Docker 踩坑紀錄 - 運行階段 Bind Mount 覆蓋 WORKDIR 的內容",
  "description": "目前經手的專案會需要針對不同環境或是測試 Build 不同的 Image，之前在本地 Debug 程式時，docker-compose 使用到 Bind Mount，導致運行階段 Host 目錄下的內容直接覆蓋 WORKDIR 的內容，引發指定檔案找不到的錯誤",
  "keywords": [
    "Docker", "Docker Volume", "Bind Mount", "Docker Compose"
  ],
  "articleBody": "我踩到了什麼坑 本文的背景延續自我之前的文章《一個專案需要多個 Dockerfile - 淺談建構上下文 (build context)》\n因為我們目前經手的專案會需要針對不同環境或是測試 Build 不同的 Image，為了讓目錄架構更具組織性且容易理解，我們根據不同的環境把各個環境的 Dockerfile, docker-compose.yaml, .sh 等等放在各個環境的目錄下，現在的目錄架構大概像這樣 ↓：\nE2Eproject/\r├── testenvironment1/\r│ └── Dockerfile\r├── testenvironment2/\r│ ├── docker-compose.yaml\r│ └── Dockerfile\r├── start-headless-tests.sh\r└── requirements.txt 由於我正在本地 Debug 這個專案，需要在本地運行 Docker-compose，我便很自然的執行 docker-compose -f ./cicd/headless/docker-compose.yaml up，結果 Docker 容器運行起來時，遇了一個錯誤：/bin/bash: /usr/src/app/cicd/headless/start-headless-tests.sh: No such file or directory。\n這個錯誤讓我想也想不透哪邊出錯，我一開始都是針對 Dockerfile 去做動作，但完全沒有用\n這邊就附上當時錯誤發生時的 Dockerfile 和 docker-compose.yaml，大家可以試著猜猜看是哪個環節導致錯誤！\nE2Eproject/cicd/headless/Dockerfile ↓\n# Dockerfile # Use the official Python base image from the DockerHub. FROM python:3.12 # Set the working directory within the container. WORKDIR /usr/src/app # 略..... # 略..... # 略..... # Copy all files from the current directory on the host to the working directory in the container. # This includes the application source code and any additional required files. COPY . /usr/src/app/ # Copy the start-tests.sh script into the container's work directory. RUN chmod +x /usr/src/app/start-headless-tests.sh # The command to run the application. CMD [\"/bin/bash\", \"/usr/src/app/cicd/headless/start-headless-tests.sh\"] E2Eproject/cicd/headless/docker-compose.yaml ↓\n# docker-compose.yaml version: '3' services: selenium-hub: # 略 ... chrome-node: # 略 ... E2Eproject: container_name: E2Eproject build: context: ../../ dockerfile: ./cicd/headless/Dockerfile args: NO_CACHE: ${NO_CACHE:-false} depends_on: - selenium-hub networks: - network-grid volumes: - .:/usr/src/app networks: network-grid: Docker Volume 介紹 (Bind Mount vs Volume) 圖片取自：https://docs.docker.com/storage/volumes/\n要解掉這個坑，會牽扯到 Docker Volume 的概念，但本篇踩坑紀錄不會做太深入的講解，就簡單介紹一下\n在 Docker 中，Volume 是用來持久化和共享數據的重要機制。大致上，我們可以將其分為兩類：Bind Mount 和 Volume。今天，我們不打算討論第三種類型，tmpfs mount，因為它與今天的話題不太相關。\nBind Mount 使用時機 Bind Mount 是一種將宿主機(Host)的文件或目錄掛載到容器中的方法。適合以下情況：\n開發階段：當你需要對程式碼進行快速迭代時，使用 Bind Mount 可以即時反映宿主機上的更改。 這也是為何我 Debug 時，使用 Bind Mount 的原因，因為我在 Host 上的改動可以立即顯現出來 但這不意味著 Bind Mount 不適合用在 Production 環境，只是 Bind Mount 會依賴宿主機(Host)目錄系統的結構，在安全和一致性上讓你更難處理 日誌文件的處理：將日誌文件直接掛載到宿主機，方便進行日誌的收集和分析。 Volume 使用時機 Volume 則是由 Docker 管理的一種更加隔離和安全的數據持久化方法，官方也推薦使用 Volumes，我這邊就節錄一小段 Docker 官方列舉的優點，詳細可以去看一下官方文件(連結)：\nVolumes are the preferred mechanism for persisting data generated by and used by Docker containers. While bind mounts are dependent on the directory structure and OS of the host machine, volumes are completely managed by Docker. Volumes have several advantages over bind mounts:\nVolumes are easier to back up or migrate than bind mounts. Volumes work on both Linux and Windows containers. You can manage volumes using Docker CLI commands or the Docker API. Volumes can be more safely shared among multiple containers. Volume drivers let you store volumes on remote hosts or cloud p -roviders, encrypt the contents of volumes, or add other functionality. New volumes can have their content pre-populated by a container. Volumes on Docker Desktop have much higher performance than bind mounts from Mac and Windows hosts. 然後我也列舉一些 Volume 適合的情境：\n生產環境：在生產環境中，我們更關注數據的持久化和安全，Volume 提供了更好的隔離。 不希望與宿主機的文件系統直接交互：當需要對數據進行持久化存儲，並且不希望與宿主機的文件系統直接交互時。 相比 Bind Mount，Volume 就不用擔心宿主機因為不同作業系統表示路徑的方式不太一樣，因為 Volume 由 Docker 完全管理，例如： Windows: C:/Users/shiun/Documents/my_folder Mac: C:/Users/shiun/Documents/my_folder Linux: /home/shiun/my_folder 為什麼會發生錯誤 首先一定要了解在 docker-compose.yaml 中，Bind Mount 在指定宿主機的目錄路徑時，路徑的相對路徑是基於 docker-compose.yaml 的所在目錄:\n# 略... volumes: - .:/usr/src/app # : \u003c容器目標目錄路徑\u003e 再回到我遇到的問題，原因其實很簡單：\n在我使用的 Dockerfile 中，我使用了 COPY . /usr/src/app/ 指令將文件從建構上下文中複製到容器內。 但是，當容器啟動時，docker-compose.yaml 中定義的 volume 又將我本地的 E2Eproject/cicd/headless 目錄掛載到了同一位置。 這導致了容器中的 /usr/src/app 目錄內容被覆蓋，而且 start-headless-tests.sh 腳本並不存在於 E2Eproject/cicd/headless 中，因此容器找不到這個文件，進而出現 /bin/bash: /usr/src/app/cicd/headless/start-headless-tests.sh: No such file or directory 解決方法 解決這個問題其實很簡單：\n註解掉或移除 docker-compose.yaml 的 volume 指令，每一次有 code 改動都重新 Build Image 這樣就不會有掛載覆蓋的問題，畢竟我再 Dockerfile 裡面就有把整個專案目錄 COPY 到 WORKDIR 修改 volumes 設定：將它改為 ../../，這樣就會掛載 E2Eproject 目錄，而不是僅僅掛載 E2Eproject/cicd/headless。 再次提醒，這邊的相對路徑是基於 docker-compose.yaml 的所在目錄 改好的樣子會像這樣：\nE2Eproject/cicd/headless/docker-compose.yaml ↓\n# docker-compose.yaml version: '3' services: # 略... # 略... # 略... E2Eproject: container_name: E2Eproject build: context: ../../ dockerfile: ./cicd/headless/Dockerfile args: NO_CACHE: ${NO_CACHE:-false} depends_on: - selenium-hub networks: - network-grid volumes: - ../../:/usr/src/app # 關鍵修改的地方 networks: network-grid: 當然後續我還有做一些簡單的細節調整，但就不多加贅述，也不影響本篇踩坑紀錄的內容\n若文章內容有誤，歡迎隨時連絡我！你們的回饋對我來說相當重要！\n也歡迎跟我交流或是分享你的想法\n",
  "wordCount" : "504",
  "inLanguage": "en",
  "datePublished": "2024-01-28T22:07:38+08:00",
  "dateModified": "2024-01-28T22:07:38+08:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://shiun.me/blog/docker-overwriting-workdir-contents-with-bind-mounts-at-run-time/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Shiun",
    "logo": {
      "@type": "ImageObject",
      "url": "https://github.com/sh1un/sh1un.github.io/assets/85695943/12a1e84f-ed17-4e38-8165-f67783c7f047"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://shiun.me/" accesskey="h" title="Shiun (Alt + H)">Shiun</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                <ul class="lang-switch"><li>|</li>
                </ul>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://shiun.me/blog/" title="Blog">
                    <span>Blog</span>
                </a>
            </li>
            <li>
                <a href="https://shiun.me/archives/" title="Archives">
                    <span>Archives</span>
                </a>
            </li>
            <li>
                <a href="https://shiun.me/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="https://shiun.me/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="https://shiun.notion.site/Shiun-s-Learning-Journal-ded4cd4a3efd47b2805f2f99dee8f9a1?pvs=4" title="Notion">
                    <span>Notion</span>&nbsp;
                    <svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12">
                        <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"></path>
                        <path d="M15 3h6v6"></path>
                        <path d="M10 14L21 3"></path>
                    </svg>
                </a>
            </li>
            <li>
                <a href="https://www.linkedin.com/in/shiunchiu" title="About me">
                    <span>About me</span>&nbsp;
                    <svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12">
                        <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"></path>
                        <path d="M15 3h6v6"></path>
                        <path d="M10 14L21 3"></path>
                    </svg>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://shiun.me/">Home</a>&nbsp;»&nbsp;<a href="https://shiun.me/blog/">Blogs</a></div>
    <h1 class="post-title entry-hint-parent">
      Docker 踩坑紀錄 - 運行階段 Bind Mount 覆蓋 WORKDIR 的內容
    </h1>
    <div class="post-description">
      目前經手的專案會需要針對不同環境或是測試 Build 不同的 Image，之前在本地 Debug 程式時，docker-compose 使用到 Bind Mount，導致運行階段 Host 目錄下的內容直接覆蓋 WORKDIR 的內容，引發指定檔案找不到的錯誤
    </div>
    <div class="post-meta"><span title='2024-01-28 22:07:38 +0800 CST'>January 28, 2024</span>&nbsp;·&nbsp;3 min

</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e6%88%91%e8%b8%a9%e5%88%b0%e4%ba%86%e4%bb%80%e9%ba%bc%e5%9d%91" aria-label="我踩到了什麼坑">我踩到了什麼坑</a></li>
                <li>
                    <a href="#docker-volume-%e4%bb%8b%e7%b4%b9-bind-mount-vs-volume" aria-label="Docker Volume 介紹 (Bind Mount vs Volume)">Docker Volume 介紹 (Bind Mount vs Volume)</a><ul>
                        
                <li>
                    <a href="#bind-mount-%e4%bd%bf%e7%94%a8%e6%99%82%e6%a9%9f" aria-label="Bind Mount 使用時機">Bind Mount 使用時機</a></li>
                <li>
                    <a href="#volume-%e4%bd%bf%e7%94%a8%e6%99%82%e6%a9%9f" aria-label="Volume 使用時機">Volume 使用時機</a></li></ul>
                </li>
                <li>
                    <a href="#%e7%82%ba%e4%bb%80%e9%ba%bc%e6%9c%83%e7%99%bc%e7%94%9f%e9%8c%af%e8%aa%a4" aria-label="為什麼會發生錯誤">為什麼會發生錯誤</a></li>
                <li>
                    <a href="#%e8%a7%a3%e6%b1%ba%e6%96%b9%e6%b3%95" aria-label="解決方法">解決方法</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="我踩到了什麼坑">我踩到了什麼坑<a hidden class="anchor" aria-hidden="true" href="#我踩到了什麼坑">#</a></h2>
<p>本文的背景延續自我之前的文章《<a href="https://shiun.me/blog/a-project-with-multiple-dockerfiles---an-introduction-to-build-context/">一個專案需要多個 Dockerfile - 淺談建構上下文 (build context)</a>》</p>
<p>因為我們目前經手的專案會需要針對不同環境或是測試 Build 不同的 Image，為了讓目錄架構更具組織性且容易理解，我們根據不同的環境把各個環境的 <code>Dockerfile</code>, <code>docker-compose.yaml</code>, <code>.sh</code> 等等放在各個環境的目錄下，現在的目錄架構大概像這樣 ↓：</p>
<pre tabindex="0"><code>E2Eproject/
├── testenvironment1/
│   └── Dockerfile
├── testenvironment2/
│   ├── docker-compose.yaml
│   └── Dockerfile
├── start-headless-tests.sh
└── requirements.txt
</code></pre><p>由於我正在本地 Debug 這個專案，需要在本地運行 Docker-compose，我便很自然的執行 <code>docker-compose -f ./cicd/headless/docker-compose.yaml up</code>，結果 Docker 容器運行起來時，遇了一個錯誤：<code>/bin/bash: /usr/src/app/cicd/headless/start-headless-tests.sh: No such file or directory</code>。</p>
<!-- raw HTML omitted -->
<p>這個錯誤讓我想也想不透哪邊出錯，我一開始都是針對 Dockerfile 去做動作，但完全沒有用</p>
<p>這邊就附上當時錯誤發生時的 <code>Dockerfile</code> 和 <code>docker-compose.yaml</code>，大家可以試著猜猜看是哪個環節導致錯誤！</p>
<p>E2Eproject/cicd/headless/Dockerfile ↓</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Dockerfile" data-lang="Dockerfile"><span style="display:flex;"><span><span style="color:#75715e"># Dockerfile</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Use the official Python base image from the DockerHub.</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">FROM</span><span style="color:#e6db74"> python:3.12</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Set the working directory within the container.</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">WORKDIR</span><span style="color:#e6db74"> /usr/src/app</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># 略.....</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># 略.....</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># 略.....</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Copy all files from the current directory on the host to the working directory in the container.</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># This includes the application source code and any additional required files.</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">COPY</span> . /usr/src/app/<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Copy the start-tests.sh script into the container&#39;s work directory.</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> chmod +x /usr/src/app/start-headless-tests.sh<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># The command to run the application.</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">CMD</span> [<span style="color:#e6db74">&#34;/bin/bash&#34;</span>, <span style="color:#e6db74">&#34;/usr/src/app/cicd/headless/start-headless-tests.sh&#34;</span>]<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>E2Eproject/cicd/headless/docker-compose.yaml ↓</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Dockerfile" data-lang="Dockerfile"><span style="display:flex;"><span><span style="color:#75715e"># docker-compose.yaml</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>version: <span style="color:#e6db74">&#39;3&#39;</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>services:<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  selenium-hub:<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    <span style="color:#75715e"># 略 ...</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  chrome-node:<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    <span style="color:#75715e"># 略 ...</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  E2Eproject:<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    container_name: E2Eproject<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    build:<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>      context: ../../<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>      dockerfile: ./cicd/headless/Dockerfile<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>      args:<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>        NO_CACHE: <span style="color:#e6db74">${</span>NO_CACHE<span style="color:#66d9ef">:-</span>false<span style="color:#e6db74">}</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    depends_on:<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>      - selenium-hub<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    networks:<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>      - network-grid<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    volumes:<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>      - .:/usr/src/app<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>networks:<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  network-grid:<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><hr>
<h2 id="docker-volume-介紹-bind-mount-vs-volume">Docker Volume 介紹 (Bind Mount vs Volume)<a hidden class="anchor" aria-hidden="true" href="#docker-volume-介紹-bind-mount-vs-volume">#</a></h2>
<p><img loading="lazy" src="https://github.com/sh1un/sh1un.github.io/assets/85695943/bec7c92f-dde7-45ab-836d-09bfe851206a" alt="types-of-mounts-volume (1)"  />

<em>圖片取自：<a href="https://docs.docker.com/storage/volumes/">https://docs.docker.com/storage/volumes/</a></em></p>
<p>要解掉這個坑，會牽扯到 Docker Volume 的概念，但本篇踩坑紀錄不會做太深入的講解，就簡單介紹一下</p>
<p>在 Docker 中，Volume 是用來持久化和共享數據的重要機制。大致上，我們可以將其分為兩類：Bind Mount 和 Volume。今天，我們不打算討論第三種類型，tmpfs mount，因為它與今天的話題不太相關。</p>
<h3 id="bind-mount-使用時機">Bind Mount 使用時機<a hidden class="anchor" aria-hidden="true" href="#bind-mount-使用時機">#</a></h3>
<p>Bind Mount 是一種將宿主機(Host)的文件或目錄掛載到容器中的方法。適合以下情況：</p>
<ol>
<li><strong>開發階段</strong>：當你需要對程式碼進行快速迭代時，使用 Bind Mount 可以即時反映宿主機上的更改。
<ul>
<li>這也是為何我 Debug 時，使用 Bind Mount 的原因，因為我在 Host 上的改動可以立即顯現出來</li>
<li>但這不意味著 Bind Mount 不適合用在 Production 環境，只是 Bind Mount 會依賴宿主機(Host)目錄系統的結構，在安全和一致性上讓你更難處理</li>
</ul>
</li>
<li><strong>日誌文件的處理</strong>：將日誌文件直接掛載到宿主機，方便進行日誌的收集和分析。</li>
</ol>
<h3 id="volume-使用時機">Volume 使用時機<a hidden class="anchor" aria-hidden="true" href="#volume-使用時機">#</a></h3>
<p>Volume 則是由 Docker 管理的一種更加隔離和安全的數據持久化方法，官方也推薦使用 Volumes，我這邊就節錄一小段 Docker 官方列舉的優點，詳細可以去看一下官方文件(<a href="https://docs.docker.com/storage/volumes/">連結</a>)：</p>
<blockquote>
<p>Volumes are the preferred mechanism for persisting data generated by and used by Docker containers. While <a href="https://docs.docker.com/storage/bind-mounts/">bind mounts</a> are dependent on the directory structure and OS of the host machine, volumes are completely managed by Docker. Volumes have several advantages over bind mounts:</p>
<ul>
<li>Volumes are easier to back up or migrate than bind mounts.</li>
<li>Volumes work on both Linux and Windows containers.</li>
<li>You can manage volumes using Docker CLI commands or the Docker API.</li>
<li>Volumes can be more safely shared among multiple containers.</li>
<li>Volume drivers let you store volumes on remote hosts or cloud p -roviders, encrypt the contents of volumes, or add other functionality.</li>
<li>New volumes can have their content pre-populated by a container.</li>
<li>Volumes on Docker Desktop have much higher performance than bind mounts from Mac and Windows hosts.</li>
</ul>
</blockquote>
<p>然後我也列舉一些 Volume 適合的情境：</p>
<ol>
<li><strong>生產環境</strong>：在生產環境中，我們更關注數據的持久化和安全，Volume 提供了更好的隔離。</li>
<li><strong>不希望與宿主機的文件系統直接交互</strong>：當需要對數據進行持久化存儲，並且不希望與宿主機的文件系統直接交互時。
<ul>
<li>相比 Bind Mount，Volume 就不用擔心宿主機因為不同作業系統表示路徑的方式不太一樣，因為 Volume 由 Docker 完全管理，例如：
<ul>
<li>Windows: <code>C:/Users/shiun/Documents/my_folder</code></li>
<li>Mac: <code>C:/Users/shiun/Documents/my_folder</code></li>
<li>Linux: <code>/home/shiun/my_folder</code></li>
</ul>
</li>
</ul>
</li>
</ol>
<hr>
<h2 id="為什麼會發生錯誤">為什麼會發生錯誤<a hidden class="anchor" aria-hidden="true" href="#為什麼會發生錯誤">#</a></h2>
<p>首先一定要了解在 <code>docker-compose.yaml</code> 中，Bind Mount 在指定宿主機的目錄路徑時，路徑的相對路徑是基於 <code>docker-compose.yaml</code> 的所在目錄:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Dockerfile" data-lang="Dockerfile"><span style="display:flex;"><span>    <span style="color:#75715e"># 略...</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    volumes:<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>      - .:/usr/src/app <span style="color:#75715e"># &lt;docker-compose.yaml 所處當前目錄路徑&gt;: &lt;容器目標目錄路徑&gt;</span><span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>再回到我遇到的問題，原因其實很簡單：</p>
<ul>
<li>在我使用的 <code>Dockerfile</code> 中，我使用了 <code>COPY . /usr/src/app/</code> 指令將文件從建構上下文中複製到容器內。</li>
<li>但是，當容器啟動時，<code>docker-compose.yaml</code> 中定義的 <code>volume</code> 又將我本地的 <code>E2Eproject/cicd/headless</code> 目錄掛載到了同一位置。
<ul>
<li>這導致了容器中的 <code>/usr/src/app</code> 目錄內容被覆蓋，而且 <code>start-headless-tests.sh</code> 腳本並不存在於 <code>E2Eproject/cicd/headless</code> 中，因此容器找不到這個文件，進而出現 <code>/bin/bash: /usr/src/app/cicd/headless/start-headless-tests.sh: No such file or directory</code></li>
</ul>
</li>
</ul>
<hr>
<h2 id="解決方法">解決方法<a hidden class="anchor" aria-hidden="true" href="#解決方法">#</a></h2>
<p>解決這個問題其實很簡單：</p>
<ol>
<li><strong>註解掉或移除 docker-compose.yaml 的 volume 指令</strong>，每一次有 code 改動都重新 Build Image
<ul>
<li>這樣就不會有掛載覆蓋的問題，畢竟我再 Dockerfile 裡面就有把整個專案目錄 COPY 到 WORKDIR</li>
</ul>
</li>
<li><strong>修改 volumes 設定</strong>：將它改為 <code>../../</code>，這樣就會掛載 <code>E2Eproject</code> 目錄，而不是僅僅掛載 <code>E2Eproject/cicd/headless</code>。
<ul>
<li>再次提醒，這邊的相對路徑是基於 <code>docker-compose.yaml</code> 的所在目錄</li>
</ul>
</li>
</ol>
<p>改好的樣子會像這樣：</p>
<p>E2Eproject/cicd/headless/docker-compose.yaml ↓</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Dockerfile" data-lang="Dockerfile"><span style="display:flex;"><span><span style="color:#75715e"># docker-compose.yaml</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>version: <span style="color:#e6db74">&#39;3&#39;</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>services:<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#75715e"># 略...</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#75715e"># 略...</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#75715e"># 略...</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  E2Eproject:<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    container_name: E2Eproject<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    build:<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>      context: ../../<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>      dockerfile: ./cicd/headless/Dockerfile<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>      args:<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>        NO_CACHE: <span style="color:#e6db74">${</span>NO_CACHE<span style="color:#66d9ef">:-</span>false<span style="color:#e6db74">}</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    depends_on:<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>      - selenium-hub<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    networks:<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>      - network-grid<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    volumes:<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>      - ../../:/usr/src/app <span style="color:#75715e"># 關鍵修改的地方</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>networks:<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>  network-grid:<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>當然後續我還有做一些簡單的細節調整，但就不多加贅述，也不影響本篇踩坑紀錄的內容</p>
<p>若文章內容有誤，歡迎隨時連絡我！你們的回饋對我來說相當重要！</p>
<p>也歡迎跟我交流或是分享你的想法</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://shiun.me/tags/docker/">Docker</a></li>
      <li><a href="https://shiun.me/tags/docker-compose/">Docker Compose</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://shiun.me/blog/dockerfile-cmd-vs-entrypoint/">
    <span class="title">« Prev</span>
    <br>
    <span>Docker 初學常見問題 - CMD vs ENTRYPOINT 兩者的差異與範例</span>
  </a>
  <a class="next" href="https://shiun.me/blog/aws-educate-6th-cloud-ambassador-resume-and-interview-preparation/">
    <span class="title">Next »</span>
    <br>
    <span>如何成為 AWS Educate 雲端大使？履歷準備、面試技巧大公開</span>
  </a>
</nav>


<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Docker 踩坑紀錄 - 運行階段 Bind Mount 覆蓋 WORKDIR 的內容 on x"
            href="https://x.com/intent/tweet/?text=Docker%20%e8%b8%a9%e5%9d%91%e7%b4%80%e9%8c%84%20-%20%e9%81%8b%e8%a1%8c%e9%9a%8e%e6%ae%b5%20Bind%20Mount%20%e8%a6%86%e8%93%8b%20WORKDIR%20%e7%9a%84%e5%85%a7%e5%ae%b9&amp;url=https%3a%2f%2fshiun.me%2fblog%2fdocker-overwriting-workdir-contents-with-bind-mounts-at-run-time%2f&amp;hashtags=Docker%2cDockerCompose">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Docker 踩坑紀錄 - 運行階段 Bind Mount 覆蓋 WORKDIR 的內容 on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fshiun.me%2fblog%2fdocker-overwriting-workdir-contents-with-bind-mounts-at-run-time%2f&amp;title=Docker%20%e8%b8%a9%e5%9d%91%e7%b4%80%e9%8c%84%20-%20%e9%81%8b%e8%a1%8c%e9%9a%8e%e6%ae%b5%20Bind%20Mount%20%e8%a6%86%e8%93%8b%20WORKDIR%20%e7%9a%84%e5%85%a7%e5%ae%b9&amp;summary=Docker%20%e8%b8%a9%e5%9d%91%e7%b4%80%e9%8c%84%20-%20%e9%81%8b%e8%a1%8c%e9%9a%8e%e6%ae%b5%20Bind%20Mount%20%e8%a6%86%e8%93%8b%20WORKDIR%20%e7%9a%84%e5%85%a7%e5%ae%b9&amp;source=https%3a%2f%2fshiun.me%2fblog%2fdocker-overwriting-workdir-contents-with-bind-mounts-at-run-time%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Docker 踩坑紀錄 - 運行階段 Bind Mount 覆蓋 WORKDIR 的內容 on facebook"
            href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fshiun.me%2fblog%2fdocker-overwriting-workdir-contents-with-bind-mounts-at-run-time%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Docker 踩坑紀錄 - 運行階段 Bind Mount 覆蓋 WORKDIR 的內容 on telegram"
            href="https://telegram.me/share/url?text=Docker%20%e8%b8%a9%e5%9d%91%e7%b4%80%e9%8c%84%20-%20%e9%81%8b%e8%a1%8c%e9%9a%8e%e6%ae%b5%20Bind%20Mount%20%e8%a6%86%e8%93%8b%20WORKDIR%20%e7%9a%84%e5%85%a7%e5%ae%b9&amp;url=https%3a%2f%2fshiun.me%2fblog%2fdocker-overwriting-workdir-contents-with-bind-mounts-at-run-time%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
</ul>

  </footer><div class="disqus markdown"><div id="disqus_thread"></div>
<script>
  

  

  (function () {
    
    var d = document,
      s = d.createElement("script");
    s.src = "https://shiun-me.disqus.com/embed.js";
    s.setAttribute("data-timestamp", +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>
<noscript
  >Please enable JavaScript to view the
  <a href="https://disqus.com/?ref_noscript"
    >comments powered by Disqus.</a
  ></noscript
>
</div>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2024 <a href="https://shiun.me/">Shiun</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
